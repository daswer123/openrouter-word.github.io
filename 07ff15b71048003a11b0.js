/*! For license information please see 07ff15b71048003a11b0.js.LICENSE.txt */
function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:t+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},c=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",i=o.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function m(e,t,n,r){var o=t&&t.prototype instanceof y?t:y,c=Object.create(o.prototype),l=new T(r||[]);return a(c,"_invoke",{value:B(e,n,l)}),c}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var u="suspendedStart",p="suspendedYield",g="executing",h="completed",f={};function y(){}function v(){}function x(){}var b={};s(b,c,(function(){return this}));var k=Object.getPrototypeOf,S=k&&k(k(O([])));S&&S!==n&&r.call(S,c)&&(b=S);var I=x.prototype=y.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function G(e,t){function n(a,o,c,l){var i=d(e[a],e,o);if("throw"!==i.type){var s=i.arg,m=s.value;return m&&"object"==_typeof(m)&&r.call(m,"__await")?t.resolve(m.__await).then((function(e){n("next",e,c,l)}),(function(e){n("throw",e,c,l)})):t.resolve(m).then((function(e){s.value=e,c(s)}),(function(e){return n("throw",e,c,l)}))}l(i.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function B(t,n,r){var a=u;return function(o,c){if(a===g)throw Error("Generator is already running");if(a===h){if("throw"===o)throw c;return{value:e,done:!0}}for(r.method=o,r.arg=c;;){var l=r.delegate;if(l){var i=P(l,r);if(i){if(i===f)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===u)throw a=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=g;var s=d(t,n,r);if("normal"===s.type){if(a=r.done?h:p,s.arg===f)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=h,r.method="throw",r.arg=s.arg)}}}function P(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,P(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=d(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,f;var c=o.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[c];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(_typeof(t)+" is not iterable")}return v.prototype=x,a(I,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:v,configurable:!0}),v.displayName=s(x,i,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,s(e,i,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},E(G.prototype),s(G.prototype,l,(function(){return this})),t.AsyncIterator=G,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var c=new G(m(e,n,r,a),o);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},E(I),s(I,i,"Generator"),s(I,c,(function(){return this})),s(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(w),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return l.type="throw",l.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],l=c.completion;if("root"===c.tryLoc)return a("end");if(c.tryLoc<=this.prev){var i=r.call(c,"catchLoc"),s=r.call(c,"finallyLoc");if(i&&s){if(this.prev<c.catchLoc)return a(c.catchLoc,!0);if(this.prev<c.finallyLoc)return a(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return a(c.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return a(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}function asyncGeneratorStep(e,t,n,r,a,o,c){try{var l=e[o](c),i=l.value}catch(e){return void n(e)}l.done?t(i):Promise.resolve(i).then(r,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){asyncGeneratorStep(o,r,a,c,l,"next",e)}function l(e){asyncGeneratorStep(o,r,a,c,l,"throw",e)}c(void 0)}))}}function getPrompts(){return JSON.parse(localStorage.getItem("prompts")||"[]")}function savePrompts(e){localStorage.setItem("prompts",JSON.stringify(e))}function getLastSelectedPromptIndex(){return parseInt(localStorage.getItem("lastSelectedPromptIndex")||"-1",10)}function saveLastSelectedPromptIndex(e){localStorage.setItem("lastSelectedPromptIndex",e.toString())}function initSettings(){document.getElementById("settings").innerHTML='\n        <div class="mt-3">\n            <label for="api-key" class="form-label">API Ключ:</label>\n            <input type="password" id="api-key" class="form-control">\n        </div>\n        <div class="mt-3">\n            <label for="formatting-model" class="form-label">Модель для форматирования:</label>\n            <select id="formatting-model" class="form-select"></select>\n        </div>\n        <div class="mt-3 form-check">\n            <input type="checkbox" class="form-check-input" id="apply-formatting">\n            <label class="form-check-label" for="apply-formatting">Применять форматирование</label>\n        </div>\n    ',document.getElementById("api-key").onchange=saveApiKey,document.getElementById("formatting-model").onchange=saveFormattingModel,document.getElementById("apply-formatting").onchange=saveApplyFormatting,loadModels(),loadSettings(),$("#formatting-model").select2({width:"100%",placeholder:"Выберите модель для форматирования"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)}))}function saveFormattingModel(){var e=document.getElementById("formatting-model").value;localStorage.setItem("formattingModel",e)}function saveApplyFormatting(){var e=document.getElementById("apply-formatting").checked;localStorage.setItem("applyFormatting",e)}function loadSettings(){var e=localStorage.getItem("apiKey")||"",t=localStorage.getItem("formattingModel")||"openai/gpt-4-mini",n="true"===localStorage.getItem("applyFormatting");document.getElementById("api-key").value=e,$("#formatting-model").val(t).trigger("change"),document.getElementById("apply-formatting").checked=n}function populateModelSelectt(e){var t=$("#prompt-model"),n=$("#formatting-model");[t,n].forEach((function(t){t.empty(),e.forEach((function(e){var n=new Option(e.name,e.id,!1,!1);t.append(n)})),t.trigger("change")}));var r=e.find((function(e){return"openai/gpt-4-mini"===e.id}))||e[0];r&&n.val(r.id).trigger("change");var a=localStorage.getItem("formattingModel");a&&e.some((function(e){return e.id===a}))&&n.val(a).trigger("change")}function saveApiKey(){var e=document.getElementById("api-key").value;localStorage.setItem("apiKey",e)}var OPENROUTER_BASE_URL="https://openrouter.ai/api/v1";function loadModels(){return _loadModels.apply(this,arguments)}function _loadModels(){return(_loadModels=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("".concat(OPENROUTER_BASE_URL,"/models"));case 3:t=e.sent,n=t.data.data,localStorage.setItem("models",JSON.stringify(n)),populateModelSelectt(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error loading models:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function generateTextWithAI(e,t,n,r){return _generateTextWithAI.apply(this,arguments)}function _generateTextWithAI(){return(_generateTextWithAI=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r,a){var o,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=localStorage.getItem("apiKey"),e.prev=1,e.next=4,fetch("".concat(OPENROUTER_BASE_URL,"/chat/completions"),{method:"POST",signal:a,headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word AI Assistant"},body:JSON.stringify({model:r,messages:[{role:"system",content:t},{role:"user",content:n}]})});case 4:if((c=e.sent).ok){e.next=7;break}throw new Error("HTTP error! status: ".concat(c.status));case 7:return e.next=9,c.json();case 9:return l=e.sent,e.abrupt("return",l.choices[0].message.content.trim());case 13:throw e.prev=13,e.t0=e.catch(1),console.error("Error in generateTextWithAI:",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function generateTextWithAIFormat(e,t,n,r){return _generateTextWithAIFormat.apply(this,arguments)}function _generateTextWithAIFormat(){return(_generateTextWithAIFormat=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r,a){var o,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=localStorage.getItem("apiKey"),e.prev=1,e.next=4,fetch("".concat(OPENROUTER_BASE_URL,"/chat/completions"),{method:"POST",signal:a,headers:{Authorization:"Bearer ".concat(o),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word AI Assistant"},body:JSON.stringify({model:r,messages:[{role:"system",content:t},{role:"user",content:n}]})});case 4:if((c=e.sent).ok){e.next=7;break}throw new Error("HTTP error! status: ".concat(c.status));case 7:return e.next=9,c.json();case 9:return l=e.sent,e.abrupt("return",l.choices[0].message.content.trim());case 13:throw e.prev=13,e.t0=e.catch(1),console.error("Error in generateTextWithAI:",e.t0),e.t0;case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}var originalText="",currentController=null,lastSelectedPrompt=null;function initHome(){document.getElementById("home").innerHTML='\n      <select id="prompt-select" class="form-select mt-3"></select>\n      <div id="selected-model" class="mt-2"></div>\n      <button id="replace-text" class="btn btn-primary mt-3" disabled>Заменить выделенный текст</button>\n      <button id="cancel-request" class="btn btn-secondary mt-3" style="display: none;">Отменить запрос</button>\n      <button id="show-selected-text" class="btn btn-info mt-3">Показать информацию о выделенном тексте</button>\n      \x3c!-- <button id="apply-tricks" class="btn btn-warning mt-3">Применить приколы</button>\n      <button id="repeat-styles" class="btn btn-primary mt-3">Повтор стилей</button> --\x3e\n      <div id="selected-text-info" class="mt-3"></div>\n  ',$("#prompt-select").select2({width:"100%",placeholder:"Выберите промпт",templateResult:formatPrompt,templateSelection:formatPromptSelection}),document.getElementById("replace-text").onclick=replaceSelectedText,document.getElementById("cancel-request").onclick=cancelRequest,document.getElementById("show-selected-text").onclick=showSelectedText,updatePromptSelect(),setInterval(checkSelection,1e3)}function formatPrompt(e){if(!e.id)return e.text;var t=getPrompts()[e.id];return $("<span>".concat(t.name," (").concat(t.model,")</span>"))}function formatPromptSelection(e){return e.id?getPrompts()[e.id].name:e.text}function updatePromptSelect(){var e=$("#prompt-select"),t=document.getElementById("selected-model"),n=getPrompts();e.empty(),e.append(new Option("Выберите промпт","",!0,!0));var r=getLastSelectedPromptIndex();n.forEach((function(t,n){var a=new Option(t.name,n,!1,n===r);e.append(a)})),e.trigger("change");var a=r>=0&&r<n.length?r:null;lastSelectedPrompt=null!==a?n[a]:null,t.textContent=lastSelectedPrompt?"Модель: ".concat(lastSelectedPrompt.model):"",document.getElementById("replace-text").disabled=!lastSelectedPrompt,e.on("change",(function(){var e=$(this).val();lastSelectedPrompt=e?n[e]:null,saveLastSelectedPromptIndex(e||-1),t.textContent=lastSelectedPrompt?"Модель: ".concat(lastSelectedPrompt.model):"",document.getElementById("replace-text").disabled=!lastSelectedPrompt}))}function checkSelection(){Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:r=document.getElementById("replace-text"),n.text.trim().length>0?r.disabled=!1:r.disabled=!0;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function replaceSelectedText(){return _replaceSelectedText.apply(this,arguments)}function _replaceSelectedText(){return _replaceSelectedText=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,c,l,i,s,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:if(originalText=n.text,lastSelectedPrompt){e.next=7;break}return e.abrupt("return");case 7:if(document.getElementById("replace-text").style.display="none",document.getElementById("cancel-request").style.display="inline-block",e.prev=9,currentController=new AbortController,r="true"===localStorage.getItem("applyFormatting"),a=localStorage.getItem("formattingModel")||"openai/gpt-4-mini",o=[],!r){e.next=18;break}return e.next=17,getWordsInfo(t,n);case 17:o=e.sent;case 18:return c="".concat(lastSelectedPrompt.text,'\n\nUser provided the following text: "').concat(originalText,'"').concat(r?"\n\nFormatting information: ".concat(JSON.stringify(o)):""),e.next=22,generateTextWithAI("You are an AI assistant specialized in text processing and formatting. Your task is to generate text based on user prompts and, when required, update formatting information for the generated text. Always provide responses in the requested format.",c,lastSelectedPrompt.model,currentController.signal);case 22:if(l=e.sent,!r){e.next=44;break}return i='\nOriginal text: "'.concat(originalText,'"\nModified text: "').concat(l,'"\nOriginal formatting information: ').concat(JSON.stringify(o),'\n\nTask: Update the formatting information to match the new text while preserving the original styles and formats. Return ONLY the updated formatting information array in valid JSON format.\n\nInstructions:\n1. Analyze the original and modified texts.\n2. Create a new array of formatting information for the modified text.\n3. Preserve the original formatting styles as much as possible.\n4. Ensure the number of elements in the array matches the number of words in the modified text.\n5. Return ONLY the JSON array, without any additional text or explanation.\n\nThe JSON array should contain objects with the following possible properties:\n- text: string (required) - the word from the modified text\n- bold: boolean\n- italic: boolean\n- underline: boolean\n- color: string (e.g., "#FF0000" for red)\n- highlightColor: string (e.g., "yellow")\n- size: number\n- fontName: string\n- hyperlink: string (URL)\n- footnoteText: string\n\nExample of a valid response:\n[\n{"text": "This", "bold": true, "color": "#0000FF"},\n{"text": "is", "italic": true},\n{"text": "an", "underline": true},\n{"text": "example", "size": 14, "fontName": "Arial"},\n{"text": "with", "highlightColor": "yellow"},\n{"text": "formatting", "hyperlink": "https://example.com"},\n{"text": "applied", "footnoteText": "This is a footnote example"}\n]\n\nEnsure your response is a valid JSON array and includes formatting information for all words in the modified text.'),e.prev=26,e.next=29,generateTextWithAIFormat("You are an AI assistant specialized in text formatting. Your task is to update formatting information for modified text while preserving the original styles as much as possible. Always return your response as a valid JSON array.",i,a,currentController.signal);case 29:if(m=e.sent,s=JSON.parse(m),Array.isArray(s)){e.next=33;break}throw new Error("Response is not an array");case 33:e.next=40;break;case 35:return e.prev=35,e.t0=e.catch(26),console.error("Error parsing formatting information:",e.t0),n.insertText(l,Word.InsertLocation.replace),e.abrupt("return");case 40:return e.next=42,applyFormattedText(t,n,l,s);case 42:e.next=45;break;case 44:n.insertText(l,Word.InsertLocation.replace);case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(9),"AbortError"!==e.t1.name&&console.error("Error:",e.t1);case 50:return e.prev=50,document.getElementById("cancel-request").style.display="none",document.getElementById("replace-text").style.display="inline-block",currentController=null,e.finish(50);case 55:case"end":return e.stop()}}),e,null,[[9,47,50,55],[26,35]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))),_replaceSelectedText.apply(this,arguments)}function applyFormattedText(e,t,n,r){return _applyFormattedText.apply(this,arguments)}function _applyFormattedText(){return(_applyFormattedText=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r,a){var o,c,l,i,s,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.clear(),e.next=3,t.sync();case 3:o=r.split(/\s+/),c=0,l=0;case 6:if(!(l<o.length)){e.next=16;break}return i=o[l],s=n.insertText(i,Word.InsertLocation.end),c<a.length&&(void 0!==(m=a[c]).bold&&(s.font.bold=m.bold),void 0!==m.italic&&(s.font.italic=m.italic),m.color&&(s.font.color=m.color),m.highlightColor&&(s.font.highlightColor=m.highlightColor),m.size&&(s.font.size=m.size),m.hyperlink&&(s.hyperlink=m.hyperlink),m.footnoteText&&s.insertFootnote().body.insertText(m.footnoteText,Word.InsertLocation.start),c++),l<o.length-1&&n.insertText(" ",Word.InsertLocation.end),e.next=13,t.sync();case 13:l++,e.next=6;break;case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cancelRequest(){currentController&&(currentController.abort(),document.getElementById("cancel-request").style.display="none",document.getElementById("replace-text").style.display="inline-block")}function applyTricks(){return _applyTricks.apply(this,arguments)}function _applyTricks(){return _applyTricks=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,c,l;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:if(!((r=n.text.trim().split(/\s+/)).length<4)){e.next=8;break}return console.log("Выделите минимум 4 слова"),e.abrupt("return");case 8:return(a=n.getRange()).clear(),e.next=12,t.sync();case 12:o=0;case 13:if(!(o<r.length)){e.next=33;break}return c=r[o],(l=a.insertText(c+" ",Word.InsertLocation.end)).font.bold=!1,l.font.italic=!1,l.font.color="black",l.font.highlightColor="white",l.font.size=11,0===o&&(l.font.bold=!0),1===o&&(l.font.italic=!0),2===o&&(l.hyperlink="https://www.example.com"),3===o&&(l.font.color="red"),4===o&&(l.font.highlightColor="yellow"),5===o&&(l.font.size=16),o===r.length-1&&l.insertFootnote().body.insertText("Это пример сноски",Word.InsertLocation.start),e.next=30,t.sync();case 30:o++,e.next=13;break;case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),_applyTricks.apply(this,arguments)}function formatSpecialWords(e,t,n,r){var a=[],o=[];return e.forEach((function(e,c){var l={text:e.text},i=!1,s={};!0!==e.bold&&null!==e.bold||(s.bold=!0,i=!0),e.italic&&(s.italic=!0,i=!0),e.underline&&(s.underline=!0,i=!0),e.color!==t&&""!==e.color&&(s.color=e.color,i=!0),e.highlightColor&&null!==e.highlightColor&&(s.highlight=e.highlightColor,i=!0),e.fontName!==n&&""!==e.fontName&&(s.font=e.fontName,i=!0),e.fontSize!=r&&""!==e.fontSize&&null!==e.fontSize&&(s.size=e.fontSize,i=!0),e.hyperlink&&(s.hyperlink=e.hyperlink,i=!0),Object.keys(s).length>0&&(l.formatting=s),e.hasFootnote&&(l.footnoteId=c+1,o.push({id:c+1,text:e.footnoteText,relatedWordIndex:a.length}),i=!0),i&&a.push(l)})),{formattedText:a,footnotes:o,baseFormatting:{color:t,font:n,size:r}}}function showSelectedText(){return _showSelectedText.apply(this,arguments)}function _showSelectedText(){return _showSelectedText=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,c,l,i,s,m,d,u,p,g,h,f,y,v,x;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.getSelection(),(r=n.getTextRanges([" "],!1)).load("items"),e.next=5,t.sync();case 5:a=[],o={},c={},l={},i=0;case 10:if(!(i<r.items.length)){e.next=36;break}return(s=r.items[i]).load("text, hyperlink"),s.font.load("bold, italic, underline, color, highlightColor, name, size"),(m=s.footnotes).load("items"),e.next=18,t.sync();case 18:if(!s.text.trim()){e.next=33;break}if(d=s.font.color||"default",u=s.font.name||"default",p=s.font.size||"default",o[d]=(o[d]||0)+1,c[u]=(c[u]||0)+1,l[p]=(l[p]||0)+1,g="",!(m.items.length>0)){e.next=32;break}return(h=m.items[0]).body.load("text"),e.next=31,t.sync();case 31:g=h.body.text;case 32:a.push({text:s.text.trim(),bold:s.font.bold,italic:s.font.italic,underline:"None"!==s.font.underline,color:d,highlightColor:s.font.highlightColor,hasFootnote:m.items.length>0,footnoteText:g,fontName:u,fontSize:p,hyperlink:s.hyperlink?s.hyperlink.address:null,isFirstWord:0===i,isSecondWord:1===i,isThirdWord:2===i,isLastWord:i===r.items.length-1});case 33:i++,e.next=10;break;case 36:f=Object.entries(o).reduce((function(e,t){return e[1]>t[1]?e:t}))[0],y=Object.entries(c).reduce((function(e,t){return e[1]>t[1]?e:t}))[0],v=Object.entries(l).reduce((function(e,t){return e[1]>t[1]?e:t}))[0],displayWordsInfo(a,f,y,v),x=formatSpecialWords(a,f,y,v),console.log(x);case 42:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),_showSelectedText.apply(this,arguments)}function displayWordsInfo(e,t,n,r){var a=document.getElementById("selected-text-info"),o="<h3>Анализ выделенного текста:</h3>";e.forEach((function(e,a){o+="<h4>Слово ".concat(a+1,": ").concat(e.text,"</h4>"),o+="<p>\n      ".concat(e.bold?"✅":"❌"," Жирный").concat(e.isFirstWord?" (Первое слово)":"","<br>\n      ").concat(e.italic?"✅":"❌"," Курсив").concat(e.isSecondWord?" (Второе слово)":"","<br>\n      ").concat(e.underline?"✅":"❌"," Подчеркнутый<br>\n      ").concat(e.color!==t&&"default"!==e.color?"✅ Особый цвет: ".concat(e.color):"❌ Основной цвет","<br>\n      ").concat(e.highlightColor?"✅ Выделение: ".concat(e.highlightColor):"❌ Без выделения","<br>\n      ").concat(e.hasFootnote?"✅ Есть сноска: ".concat(e.footnoteText).concat(e.isLastWord?" (Последнее слово)":""):"❌ Без сноски","<br>\n      ").concat(e.fontName!==n&&"default"!==e.fontName?"✅ Особый шрифт: ".concat(e.fontName):"❌ Основной шрифт: ".concat(n),"<br>\n      ").concat(e.fontSize!=r&&"default"!==e.fontSize?"✅ Особый размер: ".concat(e.fontSize):"❌ Основной размер: ".concat(r),"<br>\n      ").concat(e.hyperlink?"✅ Ссылка: ".concat(e.hyperlink).concat(e.isThirdWord?" (Третье слово)":""):"❌ Без ссылки","\n    </p>")})),a.innerHTML=o}function repeatStyles(){return _repeatStyles.apply(this,arguments)}function _repeatStyles(){return _repeatStyles=_asyncToGenerator(_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r,a,o,c,l,i,s,m,d;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:return r=n.text,e.next=7,getWordsInfo(t,n);case 7:return a=e.sent,o=getBaseFormatting(a),a=(a=optimizeWordsInfo(a,o)).filter((function(e){return Object.keys(e).length>1})),console.log(a),console.log("Base formatting:",o),n.clear(),e.next=16,t.sync();case 16:c=r.split(/\s+/),l=0,i=0;case 19:if(!(i<c.length)){e.next=34;break}return s=c[i],(m=n.insertText(s,Word.InsertLocation.end)).font.bold=o.bold,m.font.italic=o.italic,m.font.color=o.color,m.font.highlightColor=o.highlightColor,m.font.size=o.size,l<a.length&&a[l].text===s&&(void 0!==(d=a[l]).bold&&(m.font.bold=d.bold),void 0!==d.italic&&(m.font.italic=d.italic),d.color&&(m.font.color=d.color),d.highlightColor&&(m.font.highlightColor=d.highlightColor),d.size&&(m.font.size=d.size),d.hyperlink&&(m.hyperlink=d.hyperlink),d.footnoteText&&(m.insertFootnote(d.footnoteText.replace(""," "),Word.InsertLocation.start),s=s.replace(""," ")),l++),i<c.length-1&&n.insertText(" ",Word.InsertLocation.end),e.next=31,t.sync();case 31:i++,e.next=19;break;case 34:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),_repeatStyles.apply(this,arguments)}function getBaseFormatting(e){return{bold:getMostCommonValue(e,"bold"),italic:getMostCommonValue(e,"italic"),color:getMostCommonValue(e,"color"),highlightColor:getMostCommonValue(e,"highlightColor"),size:getMostCommonValue(e,"size")}}function optimizeWordsInfo(e,t){return e.map((function(e){var n={text:e.text};return e.bold!==t.bold&&(n.bold=e.bold),e.italic!==t.italic&&(n.italic=e.italic),e.color!==t.color&&(n.color=e.color),e.highlightColor!==t.highlightColor&&(n.highlightColor=e.highlightColor),e.size!==t.size&&(n.size=e.size),e.hasFootnote&&(n.footnoteText=e.footnoteText),e.hyperlink&&(n.hyperlink=e.hyperlink),n}))}function getWordsInfo(e,t){return _getWordsInfo.apply(this,arguments)}function _getWordsInfo(){return(_getWordsInfo=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n){var r,a,o,c,l,i,s,m;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=n.getTextRanges([" "],!1)).load("items"),e.next=4,t.sync();case 4:a=[],o=_createForOfIteratorHelper(r.items),e.prev=6,o.s();case 8:if((c=o.n()).done){e.next=27;break}return(l=c.value).load("text, hyperlink"),l.font.load("bold, italic, color, highlightColor, size"),(i=l.footnotes).load("items"),e.next=16,t.sync();case 16:if(!l.text.trim()){e.next=25;break}if(s="",!(i.items.length>0)){e.next=24;break}return(m=i.items[0]).body.load("text"),e.next=23,t.sync();case 23:s=m.body.text;case 24:a.push({text:l.text.trim(),bold:l.font.bold,italic:l.font.italic,color:l.font.color||"black",highlightColor:l.font.highlightColor||"white",size:l.font.size||"11",hasFootnote:i.items.length>0,footnoteText:s,hyperlink:l.hyperlink?l.hyperlink:null});case 25:e.next=8;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),o.e(e.t0);case 32:return e.prev=32,o.f(),e.finish(32);case 35:return e.abrupt("return",a);case 36:case"end":return e.stop()}}),e,null,[[6,29,32,35]])})))).apply(this,arguments)}function getMostCommonValue(e,t){var n,r={},a=0;return e.forEach((function(e){var o=e[t];r[o]=(r[o]||0)+1,r[o]>a&&(a=r[o],n=o)})),n}function initPrompts(){document.getElementById("prompts").innerHTML='\n        <div class="mt-3">\n            <input type="text" id="prompt-name" class="form-control" placeholder="Название промпта">\n            <select id="prompt-model" class="form-select mt-2"></select>\n            <textarea id="prompt-text" class="form-control mt-2" rows="5" placeholder="Текст промпта"></textarea>\n            <button id="save-prompt" class="btn btn-primary mt-2">Сохранить промпт</button>\n        </div>\n        <div id="prompt-list" class="mt-3"></div>\n    ',$("#prompt-model").select2({width:"100%",placeholder:"Выберите модель"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)})),document.getElementById("save-prompt").onclick=savePrompt,updatePromptList(),populateModelSelect()}function populateModelSelect(){var e=$("#prompt-model");JSON.parse(localStorage.getItem("models")||"[]").forEach((function(t){var n=new Option(t.name,t.id,!1,!1);e.append(n)})),e.trigger("change")}function savePrompt(){var e=document.getElementById("prompt-name").value,t=$("#prompt-model").val(),n=document.getElementById("prompt-text").value;if(e&&t&&n){var r=getPrompts();r.push({name:e,model:t,text:n}),savePrompts(r),updatePromptList(),updatePromptSelect(),document.getElementById("prompt-name").value="",$("#prompt-model").val(null).trigger("change"),document.getElementById("prompt-text").value=""}}function updatePromptList(){var e=document.getElementById("prompt-list"),t=getPrompts();e.innerHTML="",t.forEach((function(t,n){var r=document.createElement("div");r.className="mt-2",r.innerHTML="\n            <strong>".concat(t.name,"</strong> (").concat(t.model,')\n            <button class="btn btn-sm btn-primary edit-prompt" data-index="').concat(n,'">Редактировать</button>\n            <button class="btn btn-sm btn-info duplicate-prompt" data-index="').concat(n,'">Дубликат</button>\n            <button class="btn btn-sm btn-danger delete-prompt" data-index="').concat(n,'">Удалить</button>\n        '),e.appendChild(r)})),e.querySelectorAll(".delete-prompt").forEach((function(e){e.onclick=function(){return deletePrompt(e.dataset.index)}})),e.querySelectorAll(".edit-prompt").forEach((function(e){e.onclick=function(){return editPrompt(e.dataset.index)}})),e.querySelectorAll(".duplicate-prompt").forEach((function(e){e.onclick=function(){return duplicatePrompt(e.dataset.index)}}))}function deletePrompt(e){var t=getPrompts();t.splice(e,1),savePrompts(t),updatePromptList(),updatePromptSelect()}function editPrompt(e){var t=getPrompts()[e];document.getElementById("prompt-name").value=t.name,$("#prompt-model").val(t.model).trigger("change"),document.getElementById("prompt-text").value=t.text,document.getElementById("save-prompt").textContent="Обновить промпт",document.getElementById("save-prompt").onclick=function(){updatePrompt(e),document.getElementById("save-prompt").textContent="Сохранить промпт",document.getElementById("save-prompt").onclick=savePrompt}}function updatePrompt(e){var t=document.getElementById("prompt-name").value,n=$("#prompt-model").val(),r=document.getElementById("prompt-text").value;if(t&&n&&r){var a=getPrompts();a[e]={name:t,model:n,text:r},savePrompts(a),updatePromptList(),updatePromptSelect(),document.getElementById("prompt-name").value="",$("#prompt-model").val(null).trigger("change"),document.getElementById("prompt-text").value=""}}function duplicatePrompt(e){var t=getPrompts()[e];document.getElementById("prompt-name").value=t.name+" (копия)",$("#prompt-model").val(null).trigger("change"),document.getElementById("prompt-text").value=t.text,document.getElementById("save-prompt").textContent="Сохранить промпт",document.getElementById("save-prompt").onclick=savePrompt}function initGrammar(){document.getElementById("grammar").innerHTML='\n        <div class="mt-3">\n            \x3c!-- Инструкция по использованию --\x3e\n            <div class="alert alert-info">\n                <strong>Инструкция:</strong>\n                <ul>\n                    <li>В основных настройках выберите модель и тип проверок, которые вы хотите применить к тексту.</li>\n                    <li>Выделите текст, который хотите проверить (от 1 до 4 абзацев).</li>\n                    <li>Нажмите кнопку "Проверить".</li>\n                </ul>\n            </div>\n            \x3c!-- Настройки --\x3e\n            <div class="accordion" id="mainAccordion">\n                \x3c!-- Основные настройки --\x3e\n                <div class="card">\n                    <div class="card-header" id="settingsHeading">\n                        <h2 class="mb-0">\n                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#settingsCollapse" aria-expanded="true" aria-controls="settingsCollapse">\n                                Основные настройки\n                            </button>\n                        </h2>\n                    </div>\n                    <div id="settingsCollapse" class="collapse show" aria-labelledby="settingsHeading" data-parent="#mainAccordion">\n                        <div class="card-body">\n                            \x3c!-- Модель для проверки --\x3e\n                            <div class="form-group">\n                                <label for="grammar-model">Модель для проверки:</label>\n                                <select id="grammar-model" class="form-control" title="Выберите модель нейросети для проверки текста"></select>\n                            </div>\n                            \x3c!-- Типы проверок --\x3e\n                            <div class="form-group">\n                                <label>Типы проверок:</label>\n                                <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="check-grammatical">\n                                    <label class="form-check-label" for="check-grammatical" title="Проверка на грамматические ошибки">\n                                        Грамматические (Beta)\n                                    </label>\n                                </div>\n                                <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="check-syntactic">\n                                    <label class="form-check-label" for="check-syntactic" title="Проверка на синтаксические ошибки">\n                                        Синтаксические (Beta)\n                                    </label>\n                                </div>\n                                <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="check-stylistic" checked>\n                                    <label class="form-check-label" for="check-stylistic" title="Проверка на стилистические ошибки">\n                                        Стилистические\n                                    </label>\n                                </div>\n                                <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="check-logical" checked>\n                                    <label class="form-check-label" for="check-logical" title="Проверка на логические ошибки">\n                                        Логические\n                                    </label>\n                                </div>\n                            </div>\n                            \x3c!-- Дополнительные опции --\x3e\n                            <div class="form-group">\n                                <label>Дополнительные опции:</label>\n                                <div class="form-check">\n                                    <input class="form-check-input" type="checkbox" id="highlight-checkbox" checked>\n                                    <label class="form-check-label" for="highlight-checkbox" title="Выделить проблемный текст в документе">\n                                        Выделять проблемный текст\n                                    </label>\n                                </div>\n                                <div class="form-check mt-2">\n                                    <input class="form-check-input" type="checkbox" id="comment-checkbox">\n                                    <label class="form-check-label" for="comment-checkbox" title="Добавить комментарии к проблемному тексту">\n                                        Добавлять комментарии к проблемному тексту\n                                    </label>\n                                </div>\n                                \x3c!-- Опция изменения цвета исправленного текста --\x3e\n                                <div class="form-check mt-2">\n                                    <input class="form-check-input" type="checkbox" id="highlight-corrected-checkbox" checked>\n                                    <label class="form-check-label" for="highlight-corrected-checkbox" title="Изменять цвет исправленного текста">\n                                        Изменять цвет исправленного текста\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \x3c!-- Дополнительные настройки --\x3e\n                <div class="card">\n                    <div class="card-header" id="advancedSettingsHeading">\n                        <h2 class="mb-0">\n                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#advancedSettingsCollapse" aria-expanded="false" aria-controls="advancedSettingsCollapse">\n                                Дополнительные настройки\n                            </button>\n                        </h2>\n                    </div>\n                    <div id="advancedSettingsCollapse" class="collapse" aria-labelledby="advancedSettingsHeading" data-parent="#mainAccordion">\n                        <div class="card-body">\n                            \x3c!-- Подаккордеон для категорий настроек --\x3e\n                            <div class="accordion" id="advancedSettingsSubAccordion">\n                                \x3c!-- Настройки обработки текста --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="textProcessingSettingsHeading">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#textProcessingSettingsCollapse" aria-expanded="true" aria-controls="textProcessingSettingsCollapse">\n                                                Настройки обработки текста\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="textProcessingSettingsCollapse" class="collapse show" aria-labelledby="textProcessingSettingsHeading" data-parent="#advancedSettingsSubAccordion">\n                                        <div class="card-body">\n                                            \x3c!-- Максимальное количество символов --\x3e\n                                            <div class="form-group">\n                                                <label for="max-chars">Максимальное количество символов для проверки (0 для без лимита):</label>\n                                                <input type="number" id="max-chars" class="form-control" value="2000" min="0">\n                                            </div>\n                                            \x3c!-- Опция разбивать текст на чанки --\x3e\n                                            <div class="form-check mt-2">\n                                                <input class="form-check-input" type="checkbox" id="split-into-chunks-checkbox">\n                                                <label class="form-check-label" for="split-into-chunks-checkbox">\n                                                    Разбивать текст на чанки\n                                                </label>\n                                            </div>\n                                            \x3c!-- Размер чанка --\x3e\n                                            <div class="form-group mt-2">\n                                                <label for="chunk-size">Размер чанка (в предложениях):</label>\n                                                <input type="number" id="chunk-size" class="form-control" value="8" min="1">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Настройки модели --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="modelSettingsHeading">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#modelSettingsCollapse" aria-expanded="false" aria-controls="modelSettingsCollapse">\n                                                Настройки модели\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="modelSettingsCollapse" class="collapse" aria-labelledby="modelSettingsHeading" data-parent="#advancedSettingsSubAccordion">\n                                        <div class="card-body">\n                                            \x3c!-- Температура --\x3e\n                                            <div class="form-group">\n                                                <label for="temperature">Температура (0.0 - 1.0):</label>\n                                                <input type="number" id="temperature" class="form-control" value="0.1" min="0.0" max="1.0" step="0.1">\n                                            </div>\n                                            \x3c!-- Максимальное количество токенов --\x3e\n                                            <div class="form-group">\n                                                <label for="max-tokens">Максимальное количество токенов:</label>\n                                                <input type="number" id="max-tokens" class="form-control" value="4000" min="1">\n                                            </div>\n                                            \x3c!-- Опция включения response_format --\x3e\n                                            <div class="form-check mt-2">\n                                                <input class="form-check-input" type="checkbox" id="response-format-checkbox">\n                                                <label class="form-check-label" for="response-format-checkbox">\n                                                    Использовать response_format: {"type": "json_object"}\n                                                </label>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Настройки ошибок --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="errorSettingsHeading">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#errorSettingsCollapse" aria-expanded="false" aria-controls="errorSettingsCollapse">\n                                                Настройки ошибок\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="errorSettingsCollapse" class="collapse" aria-labelledby="errorSettingsHeading" data-parent="#advancedSettingsSubAccordion">\n                                        <div class="card-body">\n                                            \x3c!-- Повторить в случае ошибки --\x3e\n                                            <div class="form-check mt-2">\n                                                <input class="form-check-input" type="checkbox" id="retry-on-error-checkbox" checked>\n                                                <label class="form-check-label" for="retry-on-error-checkbox">\n                                                    Повторить в случае ошибки\n                                                </label>\n                                            </div>\n                                            \x3c!-- Количество повторов --\x3e\n                                            <div class="form-group mt-2">\n                                                <label for="retry-count">Количество повторов при ошибке:</label>\n                                                <input type="number" id="retry-count" class="form-control" value="3" min="1">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Настройки промптов --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="promptSettingsHeading">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#promptSettingsCollapse" aria-expanded="false" aria-controls="promptSettingsCollapse">\n                                                Настройки промптов\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="promptSettingsCollapse" class="collapse" aria-labelledby="promptSettingsHeading" data-parent="#advancedSettingsSubAccordion">\n                                        <div class="card-body">\n                                            \x3c!-- Опция редактирования промптов --\x3e\n                                            <div class="form-check mt-3">\n                                                <input class="form-check-input" type="checkbox" id="edit-prompts-checkbox" checked>\n                                                <label class="form-check-label" for="edit-prompts-checkbox">\n                                                    Редактировать системные промпты\n                                                </label>\n                                            </div>\n                                            \x3c!-- Аккордеон для редактирования промптов --\x3e\n                                            <div id="prompts-accordion" class="mt-3">\n                                                <div class="accordion" id="promptsAccordion">\n                                                    \x3c!-- Промпт роли --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingRolePrompt">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseRolePrompt" aria-expanded="true" aria-controls="collapseRolePrompt">\n                                                                    Промпт роли\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseRolePrompt" class="collapse" aria-labelledby="headingRolePrompt" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-role" class="form-control" rows="3" placeholder="Например: Ты - опытный редактор и лингвист."></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \x3c!-- Грамматические ошибки --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingGrammar">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseGrammar" aria-expanded="false" aria-controls="collapseGrammar">\n                                                                    Грамматические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseGrammar" class="collapse" aria-labelledby="headingGrammar" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-grammatical" class="form-control" rows="5"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \x3c!-- Синтаксические ошибки --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingSyntactic">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseSyntactic" aria-expanded="false" aria-controls="collapseSyntactic">\n                                                                    Синтаксические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseSyntactic" class="collapse" aria-labelledby="headingSyntactic" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-syntactic" class="form-control" rows="5"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \x3c!-- Стилистические ошибки --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingStylistic">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseStylistic" aria-expanded="false" aria-controls="collapseStylistic">\n                                                                    Стилистические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseStylistic" class="collapse" aria-labelledby="headingStylistic" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-stylistic" class="form-control" rows="5"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \x3c!-- Логические ошибки --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingLogical">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseLogical" aria-expanded="false" aria-controls="collapseLogical">\n                                                                    Логические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseLogical" class="collapse" aria-labelledby="headingLogical" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-logical" class="form-control" rows="5"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    \x3c!-- Примечание о проверяемом тексте --\x3e\n                                                    <div class="card">\n                                                        <div class="card-header" id="headingTextNote">\n                                                            <h2 class="mb-0">\n                                                                <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTextNote" aria-expanded="false" aria-controls="collapseTextNote">\n                                                                    Примечание о проверяемом тексте\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id="collapseTextNote" class="collapse" aria-labelledby="headingTextNote" data-parent="#promptsAccordion">\n                                                            <div class="card-body">\n                                                                <textarea id="prompt-text-note" class="form-control" rows="3" placeholder="Например: Текст является научной статьей по физике."></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                                \x3c!-- Кнопка сброса промптов --\x3e\n                                                <button id="reset-prompts" class="btn btn-secondary mt-3">Сбросить промпты</button>\n                                                <div id="prompt-message" class="mt-2"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Пресеты --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="presetSettingsHeading">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#presetSettingsCollapse" aria-expanded="false" aria-controls="presetSettingsCollapse">\n                                                Пресеты\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="presetSettingsCollapse" class="collapse" aria-labelledby="presetSettingsHeading" data-parent="#advancedSettingsSubAccordion">\n                                        <div class="card-body">\n                                            \x3c!-- Выбор пресета --\x3e\n                                            <div class="form-group">\n                                                <label for="preset-select">Выберите пресет:</label>\n                                                <select id="preset-select" class="form-control"></select>\n                                            </div>\n                                            \x3c!-- Имя пресета для сохранения --\x3e\n                                            <div class="form-group">\n                                                <label for="preset-name">Название пресета для сохранения:</label>\n                                                <input type="text" id="preset-name" class="form-control" placeholder="Введите название пресета">\n                                            </div>\n                                            \x3c!-- Кнопки для управления пресетами --\x3e\n                                            <div class="form-group mt-3">\n                                                <button id="save-preset" class="btn btn-primary">Сохранить текущие настройки как пресет</button>\n                                                <button id="delete-preset" class="btn btn-danger">Удалить выбранный пресет</button>\n                                            </div>\n                                            \x3c!-- Экспорт и импорт пресета --\x3e\n                                            <div class="form-group mt-3">\n                                                <ul class="nav nav-tabs" id="presetTab" role="tablist">\n                                                    <li class="nav-item">\n                                                        <a class="nav-link active" id="-tab" data-toggle="tab" href="#" role="tab" aria-controls="" aria-selected="true">Экспорт</a>\n                                                    </li>\n                                                    <li class="nav-item">\n                                                        <a class="nav-link" id="import-tab" data-toggle="tab" href="#import" role="tab" aria-controls="import" aria-selected="false">Импорт</a>\n                                                    </li>\n                                                </ul>\n                                                <div class="tab-content" id="presetTabContent">\n                                                    <div class="tab-pane fade show active" id="" role="tabpanel" aria-labelledby="-tab">\n                                                        <label for="preset-json">Экспорт пресета (JSON):</label>\n                                                        <textarea id="preset-json" class="form-control" rows="5" readonly></textarea>\n                                                        <button id="copy-preset-json" class="btn btn-secondary mt-2">Скопировать JSON</button>\n                                                    </div>\n                                                    <div class="tab-pane fade" id="import" role="tabpanel" aria-labelledby="import-tab">\n                                                        <label for="preset-json-import">Импорт пресета (JSON):</label>\n                                                        <textarea id="preset-json-import" class="form-control" rows="5"></textarea>\n                                                        <button id="import-preset" class="btn btn-secondary mt-2">Импортировать пресет</button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            \x3c!-- Сообщения о действиях с пресетами --\x3e\n                                            <div id="preset-message" class="mt-2"></div>\n                                            \x3c!-- Сообщения и подтверждения --\x3e\n                                            <div id="preset-confirmation" class="mt-2" style="display:none;">\n                                                <div class="alert alert-warning">\n                                                    <p id="preset-confirmation-message"></p>\n                                                    <button id="preset-confirm-yes" class="btn btn-danger">Да</button>\n                                                    <button id="preset-confirm-no" class="btn btn-secondary">Нет</button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Кнопка сброса настроек --\x3e\n                                <button id="reset-settings" class="btn btn-secondary mt-3">Сбросить настройки</button>\n                                <div id="reset-message" class="mt-2"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \x3c!-- Кнопка Проверить --\x3e\n            <button id="check-grammar" class="btn btn-primary mt-3">Проверить</button>\n            \x3c!-- Message area --\x3e\n            <div id="message" class="mt-3"></div>\n            \x3c!-- Загрузчик и кнопка Отменить --\x3e\n            <div id="loading" class="mt-3 text-center" style="display: none;">\n                <div id="progress-container" style="display: none;">\n                    <div class="progress">\n                        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>\n                    </div>\n                    <div id="progress-text" class="mt-2">Обработано 0 из 0 чанков</div>\n                </div>\n                <div id="spinner" style="display: none;">\n                    <div class="spinner-border text-primary" role="status">\n                        <span class="sr-only">Загрузка...</span>\n                    </div>\n                </div>\n                <div class="mt-3">\n                    <button id="cancel-check" class="btn btn-secondary">Отменить</button>\n                </div>\n            </div>\n            \x3c!-- Фильтр результатов --\x3e\n            <div id="filter-container" class="mt-3" style="display: none;">\n                <label for="filter-select">Фильтр результатов:</label>\n                <select id="filter-select" class="form-control">\n                    <option value="all">Все ошибки</option>\n                    <option value="can_edit">Только исправляемые</option>\n                    <option value="cannot_edit">Только не исправляемые</option>\n                </select>\n            </div>\n            <div id="grammar-results" class="mt-3"></div>\n        </div>\n    ',initializeGrammarModelSelect(),initializePresetSelectGrammar(),loadGrammarSettings(),loadGrammarPrompts(),document.getElementById("check-grammar").onclick=checkGrammarGrammar,document.getElementById("highlight-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("comment-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("highlight-corrected-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("check-grammatical").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("check-syntactic").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("check-stylistic").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("check-logical").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("split-into-chunks-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("chunk-size").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("max-chars").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("temperature").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("max-tokens").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("response-format-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("retry-on-error-checkbox").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("retry-count").onchange=function(){saveGrammarSettings(),updatePresetJSONGrammar()},document.getElementById("edit-prompts-checkbox").onchange=function(){togglePromptsEditorGrammar(),updatePresetJSONGrammar()},document.getElementById("prompt-role").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("prompt-grammatical").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("prompt-syntactic").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("prompt-stylistic").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("prompt-logical").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("prompt-text-note").addEventListener("input",(function(){saveGrammarPrompts(),updatePresetJSONGrammar()})),document.getElementById("reset-prompts").onclick=function(){resetGrammarPrompts(),updatePresetJSONGrammar()},document.getElementById("reset-settings").onclick=resetGrammarSettings,document.getElementById("preset-select").onchange=loadSelectedPresetGrammar,document.getElementById("save-preset").onclick=saveCurrentSettingsAsPresetGrammar,document.getElementById("delete-preset").onclick=deleteSelectedPresetGrammar,document.getElementById("copy-preset-json").onclick=copyPresetJSONGrammar,document.getElementById("import-preset").onclick=importPresetFromJSONGrammar,document.getElementById("cancel-check").onclick=cancelCheckGrammar,document.getElementById("filter-select").onchange=function(){return displayResultsGrammar(window.grammarResults)},window.abortController=null,window.window.isLoadingPreset=!1,setupSettingsChangeHandlersGrammar()}function initializeGrammarModelSelect(){$("#grammar-model").select2({width:"100%",placeholder:"Выберите модель для проверки"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)})).on("change",(function(){var e=$(this).val();localStorage.setItem("grammarModel",e),updatePresetJSONGrammar()})),populateGrammarModelSelect()}function populateGrammarModelSelect(){var e=$("#grammar-model"),t=JSON.parse(localStorage.getItem("models")||"[]");console.log("Loaded models:",t),e.empty();var n=null;t.forEach((function(t,r){var a=new Option(t.name,t.id,!1,!1);e.append(a),n||(n=t.id),"anthropic/claude-3.5-sonnet:beta"===t.id&&(n=t.id)})),console.log("Default model ID:",n);var r=localStorage.getItem("grammarModel");console.log("Saved model:",r),r&&t.some((function(e){return e.id===r}))?(e.val(r).trigger("change"),console.log("Selected saved model: ".concat(r))):n?(e.val(n).trigger("change"),console.log("Selected default model: ".concat(n))):console.log("No models available to select")}function initializePresetSelectGrammar(){populatePresetSelectGrammar(),$("#preset-select").select2({width:"100%",placeholder:"Выберите пресет"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)}))}function populatePresetSelectGrammar(){var e=$("#preset-select");e.empty();var t=new Option("Текущие настройки","current",!1,!1);e.append(t);var n=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),r=localStorage.getItem("lastSelectedPreset")||null;n.forEach((function(t){var n=new Option(t.name,t.name,!1,!1);e.append(n)})),r&&"current"!==r?e.val(r).trigger("change"):e.val("current").trigger("change")}function getBooleanSettingGrammar(e,t){var n=localStorage.getItem(e);return null==n?t:"true"===n}function getNumericSettingGrammar(e,t){var n=localStorage.getItem(e);if(null==n)return t;var r=parseFloat(n);return isNaN(r)?t:r}function loadGrammarSettings(){var e=localStorage.getItem("lastSelectedPreset");if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t)return $("#preset-select").val(t.name).trigger("change"),void loadSelectedPresetGrammar();localStorage.removeItem("lastSelectedPreset"),$("#preset-select").val("current").trigger("change")}else $("#preset-select").val("current").trigger("change");var n=getBooleanSettingGrammar("highlightErrors",!0);document.getElementById("highlight-checkbox").checked=n;var r=getBooleanSettingGrammar("addComments",!1);document.getElementById("comment-checkbox").checked=r;var a=getBooleanSettingGrammar("highlightCorrected",!0);document.getElementById("highlight-corrected-checkbox").checked=a;var o=getBooleanSettingGrammar("checkGrammatical",!1),c=getBooleanSettingGrammar("checkSyntactic",!1),l=getBooleanSettingGrammar("checkStylistic",!0),i=getBooleanSettingGrammar("checkLogical",!0);document.getElementById("check-grammatical").checked=o,document.getElementById("check-syntactic").checked=c,document.getElementById("check-stylistic").checked=l,document.getElementById("check-logical").checked=i;var s=getBooleanSettingGrammar("splitIntoChunks",!1);document.getElementById("split-into-chunks-checkbox").checked=s;var m=getNumericSettingGrammar("chunkSize",8);document.getElementById("chunk-size").value=m;var d=getNumericSettingGrammar("maxChars",2e3);document.getElementById("max-chars").value=d;var u=getNumericSettingGrammar("temperature",.1);document.getElementById("temperature").value=u;var p=getNumericSettingGrammar("maxTokens",4e3);document.getElementById("max-tokens").value=p;var g=getBooleanSettingGrammar("responseFormat",!1);document.getElementById("response-format-checkbox").checked=g;var h=getBooleanSettingGrammar("retryOnError",!0);document.getElementById("retry-on-error-checkbox").checked=h;var f=getNumericSettingGrammar("retryCount",3);document.getElementById("retry-count").value=f;var y=getBooleanSettingGrammar("editPrompts",!0);document.getElementById("edit-prompts-checkbox").checked=y,togglePromptsEditorGrammar()}function saveGrammarSettings(){var e=document.getElementById("highlight-checkbox").checked;localStorage.setItem("highlightErrors",e);var t=document.getElementById("comment-checkbox").checked;localStorage.setItem("addComments",t);var n=document.getElementById("highlight-corrected-checkbox").checked;localStorage.setItem("highlightCorrected",n);var r=document.getElementById("check-grammatical").checked,a=document.getElementById("check-syntactic").checked,o=document.getElementById("check-stylistic").checked,c=document.getElementById("check-logical").checked;localStorage.setItem("checkGrammatical",r),localStorage.setItem("checkSyntactic",a),localStorage.setItem("checkStylistic",o),localStorage.setItem("checkLogical",c);var l=document.getElementById("split-into-chunks-checkbox").checked;localStorage.setItem("splitIntoChunks",l);var i=document.getElementById("chunk-size").value;localStorage.setItem("chunkSize",i);var s=document.getElementById("max-chars").value;localStorage.setItem("maxChars",s);var m=parseFloat(document.getElementById("temperature").value);localStorage.setItem("temperature",m);var d=parseInt(document.getElementById("max-tokens").value,10);localStorage.setItem("maxTokens",d);var u=document.getElementById("response-format-checkbox").checked;localStorage.setItem("responseFormat",u);var p=document.getElementById("retry-on-error-checkbox").checked;localStorage.setItem("retryOnError",p);var g=parseInt(document.getElementById("retry-count").value,10);localStorage.setItem("retryCount",g);var h=document.getElementById("edit-prompts-checkbox").checked;localStorage.setItem("editPrompts",h),togglePromptsEditorGrammar()}function resetGrammarSettings(){localStorage.removeItem("highlightErrors"),localStorage.removeItem("addComments"),localStorage.removeItem("highlightCorrected"),localStorage.removeItem("checkGrammatical"),localStorage.removeItem("checkSyntactic"),localStorage.removeItem("checkStylistic"),localStorage.removeItem("checkLogical"),localStorage.removeItem("splitIntoChunks"),localStorage.removeItem("chunkSize"),localStorage.removeItem("maxChars"),localStorage.removeItem("temperature"),localStorage.removeItem("maxTokens"),localStorage.removeItem("responseFormat"),localStorage.removeItem("retryOnError"),localStorage.removeItem("retryCount"),localStorage.removeItem("editPrompts"),localStorage.removeItem("promptRole"),localStorage.removeItem("promptGrammatical"),localStorage.removeItem("promptSyntactic"),localStorage.removeItem("promptStylistic"),localStorage.removeItem("promptLogical"),localStorage.removeItem("promptTextNote"),localStorage.removeItem("grammarModel"),localStorage.removeItem("lastSelectedPreset"),$("#preset-select").val(null).trigger("change"),loadGrammarSettings(),loadGrammarPrompts(),populateGrammarModelSelect(),document.getElementById("preset-json").value="",displayResetMessageGrammar("Настройки сброшены к значениям по умолчанию.")}function displayResetMessageGrammar(e){var t=document.getElementById("reset-message");t.innerHTML='<div class="alert alert-info">'.concat(e,"</div>"),setTimeout((function(){t.innerHTML=""}),3e3)}function togglePromptsEditorGrammar(){var e=document.getElementById("edit-prompts-checkbox").checked;document.getElementById("prompts-accordion").style.display=e?"block":"none"}function loadGrammarPrompts(){var e=getDefaultPromptsGrammar(),t=localStorage.getItem("promptRole")||e.role,n=localStorage.getItem("promptGrammatical")||e["грамматическая"],r=localStorage.getItem("promptSyntactic")||e["синтаксическая"],a=localStorage.getItem("promptStylistic")||e["стилистическая"],o=localStorage.getItem("promptLogical")||e["логическая"],c=localStorage.getItem("promptTextNote")||"";document.getElementById("prompt-role").value=t,document.getElementById("prompt-grammatical").value=n,document.getElementById("prompt-syntactic").value=r,document.getElementById("prompt-stylistic").value=a,document.getElementById("prompt-logical").value=o,document.getElementById("prompt-text-note").value=c}function saveGrammarPrompts(){var e=document.getElementById("prompt-role").value,t=document.getElementById("prompt-grammatical").value,n=document.getElementById("prompt-syntactic").value,r=document.getElementById("prompt-stylistic").value,a=document.getElementById("prompt-logical").value,o=document.getElementById("prompt-text-note").value;localStorage.setItem("promptRole",e),localStorage.setItem("promptGrammatical",t),localStorage.setItem("promptSyntactic",n),localStorage.setItem("promptStylistic",r),localStorage.setItem("promptLogical",a),localStorage.setItem("promptTextNote",o),displayPromptMessageGrammar("Промпты сохранены и будут применены при следующей проверке.")}function resetGrammarPrompts(){var e=getDefaultPromptsGrammar();document.getElementById("prompt-role").value=e.role,document.getElementById("prompt-grammatical").value=e["грамматическая"],document.getElementById("prompt-syntactic").value=e["синтаксическая"],document.getElementById("prompt-stylistic").value=e["стилистическая"],document.getElementById("prompt-logical").value=e["логическая"],document.getElementById("prompt-text-note").value="",saveGrammarPrompts(),displayPromptMessageGrammar("Промпты сброшены к значениям по умолчанию.")}function displayPromptMessageGrammar(e){var t=document.getElementById("prompt-message");t.innerHTML='<div class="alert alert-info">'.concat(e,"</div>"),setTimeout((function(){t.innerHTML=""}),3e3)}function getCurrentSettingsGrammar(){return{highlightErrors:document.getElementById("highlight-checkbox").checked,addComments:document.getElementById("comment-checkbox").checked,highlightCorrected:document.getElementById("highlight-corrected-checkbox").checked,checkGrammatical:document.getElementById("check-grammatical").checked,checkSyntactic:document.getElementById("check-syntactic").checked,checkStylistic:document.getElementById("check-stylistic").checked,checkLogical:document.getElementById("check-logical").checked,splitIntoChunks:document.getElementById("split-into-chunks-checkbox").checked,chunkSize:document.getElementById("chunk-size").value,maxChars:document.getElementById("max-chars").value,temperature:document.getElementById("temperature").value,maxTokens:document.getElementById("max-tokens").value,responseFormat:document.getElementById("response-format-checkbox").checked,retryOnError:document.getElementById("retry-on-error-checkbox").checked,retryCount:document.getElementById("retry-count").value,editPrompts:document.getElementById("edit-prompts-checkbox").checked,grammarModel:$("#grammar-model").val()}}function getCurrentPromptsGrammar(){return{promptRole:document.getElementById("prompt-role").value,promptGrammatical:document.getElementById("prompt-grammatical").value,promptSyntactic:document.getElementById("prompt-syntactic").value,promptStylistic:document.getElementById("prompt-stylistic").value,promptLogical:document.getElementById("prompt-logical").value,promptTextNote:document.getElementById("prompt-text-note").value}}function saveCurrentSettingsAsPresetGrammar(){var e=document.getElementById("preset-name"),t=e.value.trim();if(t)if("current"!==t.toLowerCase()&&"Текущие настройки"!==t){var n={name:t,settings:getCurrentSettingsGrammar(),prompts:getCurrentPromptsGrammar()},r=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),a=r.findIndex((function(e){return e.name===t}));-1!==a?showPresetConfirmationGrammar('Пресет с названием "'.concat(t,'" уже существует. Перезаписать его?'),(function(){r[a]=n,localStorage.setItem("grammarPresets",JSON.stringify(r)),populatePresetSelectGrammar(),$("#preset-select").val(n.name).trigger("change"),localStorage.setItem("lastSelectedPreset",n.name),displayPresetMessageGrammar("Пресет сохранен.","success"),e.value="",updatePresetJSONGrammar()})):(r.push(n),localStorage.setItem("grammarPresets",JSON.stringify(r)),populatePresetSelectGrammar(),$("#preset-select").val(n.name).trigger("change"),localStorage.setItem("lastSelectedPreset",n.name),displayPresetMessageGrammar("Пресет сохранен.","success"),e.value="",updatePresetJSONGrammar())}else displayPresetMessageGrammar('Название пресета не может быть "Текущие настройки".',"danger");else displayPresetMessageGrammar("Название пресета не может быть пустым.","danger")}function showPresetConfirmationGrammar(e,t){var n=document.getElementById("preset-confirmation"),r=document.getElementById("preset-confirmation-message"),a=document.getElementById("preset-confirm-yes"),o=document.getElementById("preset-confirm-no");r.textContent=e,n.style.display="block",a.onclick=null,o.onclick=null,a.onclick=function(){n.style.display="none",t()},o.onclick=function(){n.style.display="none"}}function setupSettingsChangeHandlersGrammar(){function e(){if(!window.isLoadingPreset){saveGrammarSettings(),saveGrammarPrompts();var e,t=getCurrentSettingsGrammar(),n=getCurrentPromptsGrammar(),r=null,a=_createForOfIteratorHelper(JSON.parse(localStorage.getItem("grammarPresets")||"[]"));try{for(a.s();!(e=a.n()).done;){var o=e.value;if(areSettingsEqual(o.settings,t)&&areSettingsEqual(o.prompts,n)){r=o.name;break}}}catch(e){a.e(e)}finally{a.f()}r?($("#preset-select").val(r).trigger("change"),localStorage.setItem("lastSelectedPreset",r)):($("#preset-select").val("current").trigger("change"),localStorage.removeItem("lastSelectedPreset")),updatePresetJSONGrammar()}}["highlight-checkbox","comment-checkbox","highlight-corrected-checkbox","check-grammatical","check-syntactic","check-stylistic","check-logical","split-into-chunks-checkbox","chunk-size","max-chars","temperature","max-tokens","response-format-checkbox","retry-on-error-checkbox","retry-count","edit-prompts-checkbox"].forEach((function(t){var n=document.getElementById(t);n&&n.addEventListener("change",e)})),["prompt-role","prompt-grammatical","prompt-syntactic","prompt-stylistic","prompt-logical","prompt-text-note"].forEach((function(t){var n=document.getElementById(t);n&&n.addEventListener("input",e)})),$("#grammar-model").on("change",e)}function areSettingsEqual(e,t){var n=Object.keys(e).sort(),r=Object.keys(t).sort();if(n.length!==r.length)return!1;for(var a=0;a<n.length;a++){var o=n[a];if(o!==r[a])return!1;var c=e[o],l=t[o];if("object"===_typeof(c)&&"object"===_typeof(l)){if(!areSettingsEqual(c,l))return!1}else if(c!==l)return!1}return!0}function loadSelectedPresetGrammar(){window.isLoadingPreset=!0;var e=$("#preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t){var n=t.settings;document.getElementById("highlight-checkbox").checked=n.highlightErrors,document.getElementById("comment-checkbox").checked=n.addComments,document.getElementById("highlight-corrected-checkbox").checked=n.highlightCorrected,document.getElementById("check-grammatical").checked=n.checkGrammatical,document.getElementById("check-syntactic").checked=n.checkSyntactic,document.getElementById("check-stylistic").checked=n.checkStylistic,document.getElementById("check-logical").checked=n.checkLogical,document.getElementById("split-into-chunks-checkbox").checked=n.splitIntoChunks,document.getElementById("chunk-size").value=n.chunkSize,document.getElementById("max-chars").value=n.maxChars,document.getElementById("temperature").value=n.temperature,document.getElementById("max-tokens").value=n.maxTokens,document.getElementById("response-format-checkbox").checked=n.responseFormat,document.getElementById("retry-on-error-checkbox").checked=n.retryOnError,document.getElementById("retry-count").value=n.retryCount,document.getElementById("edit-prompts-checkbox").checked=n.editPrompts,togglePromptsEditorGrammar();var r=t.prompts;document.getElementById("prompt-role").value=r.promptRole,document.getElementById("prompt-grammatical").value=r.promptGrammatical,document.getElementById("prompt-syntactic").value=r.promptSyntactic,document.getElementById("prompt-stylistic").value=r.promptStylistic,document.getElementById("prompt-logical").value=r.promptLogical,document.getElementById("prompt-text-note").value=r.promptTextNote,n.grammarModel&&($("#grammar-model").val(n.grammarModel).trigger("change"),populateGrammarModelSelect()),localStorage.setItem("lastSelectedPreset",e),saveGrammarSettings(),saveGrammarPrompts(),displayPresetMessageGrammar("Пресет загружен.","success"),updatePresetJSONGrammar(),window.isLoadingPreset=!1}else window.isLoadingPreset=!1}else window.isLoadingPreset=!1}function deleteSelectedPresetGrammar(){var e=$("#preset-select").val();e&&"current"!==e?showPresetConfirmationGrammar('Вы уверены, что хотите удалить пресет "'.concat(e,'"?'),(function(){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]");t=t.filter((function(t){return t.name!==e})),localStorage.setItem("grammarPresets",JSON.stringify(t)),$("#preset-select").val("current").trigger("change"),localStorage.removeItem("lastSelectedPreset"),populatePresetSelectGrammar(),displayPresetMessageGrammar("Пресет удален.","success"),document.getElementById("preset-json").value=""})):displayPresetMessageGrammar("Нет выбранного пресета для удаления.","danger")}function updatePresetJSONGrammar(){var e=$("#preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t){var n=JSON.stringify(t,null,2);document.getElementById("preset-json").value=n}else document.getElementById("preset-json").value=""}else document.getElementById("preset-json").value=""}function copyPresetJSONGrammar(){document.getElementById("preset-json").select(),document.execCommand("copy"),displayPresetMessageGrammar("JSON пресета скопирован в буфер обмена.","success")}function importPresetFromJSONGrammar(){var e=document.getElementById("preset-json-import").value;if(e)try{var t=JSON.parse(e);if(!t.name||!t.settings||!t.prompts)return void displayPresetMessageGrammar("Некорректный формат пресета.","danger");if("current"===t.name.toLowerCase()||"Текущие настройки"===t.name)return void displayPresetMessageGrammar('Название пресета не может быть "Текущие настройки".',"danger");t.settings=_objectSpread(_objectSpread({},getDefaultSettingsGrammar()),t.settings),t.prompts=_objectSpread(_objectSpread({},getDefaultPromptsGrammar()),t.prompts);var n=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),r=n.findIndex((function(e){return e.name===t.name}));-1!==r?showPresetConfirmationGrammar('Пресет с названием "'.concat(t.name,'" уже существует. Перезаписать его?'),(function(){n[r]=t,localStorage.setItem("grammarPresets",JSON.stringify(n)),populatePresetSelectGrammar(),$("#preset-select").val(t.name).trigger("change"),localStorage.setItem("lastSelectedPreset",t.name),displayPresetMessageGrammar("Пресет импортирован.","success"),updatePresetJSONGrammar()})):(n.push(t),localStorage.setItem("grammarPresets",JSON.stringify(n)),populatePresetSelectGrammar(),$("#preset-select").val(t.name).trigger("change"),localStorage.setItem("lastSelectedPreset",t.name),displayPresetMessageGrammar("Пресет импортирован.","success"),updatePresetJSONGrammar())}catch(e){console.error("Ошибка при импорте пресета:",e),displayPresetMessageGrammar("Ошибка при импорте пресета. Проверьте формат JSON.","danger")}else displayPresetMessageGrammar("Поле JSON пустое.","danger")}function displayPresetMessageGrammar(e,t){var n=document.getElementById("preset-message");n.innerHTML='<div class="alert alert-'.concat(t,'">').concat(e,"</div>"),setTimeout((function(){n.innerHTML=""}),3e3)}function getDefaultSettingsGrammar(){return{highlightErrors:!0,addComments:!1,highlightCorrected:!0,checkGrammatical:!1,checkSyntactic:!1,checkStylistic:!0,checkLogical:!0,splitIntoChunks:!1,chunkSize:8,maxChars:2e3,temperature:.1,maxTokens:4e3,responseFormat:!1,retryOnError:!0,retryCount:3,editPrompts:!0,grammarModel:"anthropic/claude-3.5-sonnet:beta"}}function getDefaultPromptsGrammar(){return{role:"Ты - опытный редактор и лингвист.","грамматическая":"- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.","синтаксическая":"- Ищи синтаксические ошибки, связанные с неправильным построением предложений.","стилистическая":"- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.","логическая":"- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте."}}function checkGrammarGrammar(){return _checkGrammarGrammar.apply(this,arguments)}function _checkGrammarGrammar(){return _checkGrammarGrammar=_asyncToGenerator(_regeneratorRuntime().mark((function e(){var t,n,r,a,o,c,l,i,s,m,d,u,p,g;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=document.getElementById("split-into-chunks-checkbox").checked,n=parseInt(document.getElementById("chunk-size").value,10)||5,document.getElementById("grammar-results").innerHTML="",resetProgressBarGrammar(),showLoadingGrammar(!0,t),document.getElementById("filter-container").style.display="none",window.abortController=new AbortController,e.next=10,Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:return e.abrupt("return",n.text.trim());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:if(r=e.sent,a=parseInt(document.getElementById("max-chars").value,10)||100,!(r.length>0)){e.next=51;break}if(!(!t&&a>0&&r.length>a)){e.next=17;break}return document.getElementById("grammar-results").innerHTML='<p class="text-warning">Выделенный текст слишком длинный ('.concat(r.length," символов). Пожалуйста, выделите меньше ").concat(a," символов или измените ограничение в настройках.</p>"),showLoadingGrammar(!1),e.abrupt("return");case 17:if(o=$("#grammar-model").val(),c=[],!t){e.next=40;break}l=splitTextIntoChunksGrammar(r,n),i=l.length,s=document.getElementById("progress-bar"),(m=document.getElementById("progress-text")).innerText="Обработано 0 из ".concat(i," чанков"),d=0;case 26:if(!(d<l.length)){e.next=38;break}return e.next=29,analyzeTextWithRetryGrammar(l[d],o,window.abortController.signal);case 29:u=e.sent,c=c.concat(u),p=Math.round((d+1)/i*100),s.style.width="".concat(p,"%"),s.innerText="".concat(p,"%"),m.innerText="Обработано ".concat(d+1," из ").concat(i," чанков");case 35:d++,e.next=26;break;case 38:e.next=44;break;case 40:return e.next=42,analyzeTextWithRetryGrammar(r,o,window.abortController.signal);case 42:g=e.sent,c=c.concat(g);case 44:return window.grammarResults=c,displayResultsGrammar(c),e.next=48,highlightTextGrammar(c);case 48:c.length>0&&(document.getElementById("filter-container").style.display="block"),e.next=54;break;case 51:console.log("Текст не выделен"),document.getElementById("grammar-results").innerHTML='<p class="text-warning">Пожалуйста, выделите текст для проверки.</p>',showLoadingGrammar(!1);case 54:e.next=59;break;case 56:e.prev=56,e.t0=e.catch(0),"AbortError"===e.t0.name?(console.log("Проверка отменена пользователем."),document.getElementById("grammar-results").innerHTML='<p class="text-info">Проверка отменена.</p>'):(console.error("Error in checkGrammarGrammar:",e.t0),document.getElementById("grammar-results").innerHTML='<p class="text-danger">Произошла ошибка при проверке. Пожалуйста, попробуйте еще раз.</p>');case 59:return e.prev=59,showLoadingGrammar(!1),window.abortController=null,e.finish(59);case 63:case"end":return e.stop()}}),e,null,[[0,56,59,63]])}))),_checkGrammarGrammar.apply(this,arguments)}function cancelCheckGrammar(){window.abortController&&(window.abortController.abort(),showLoadingGrammar(!1),window.abortController=null)}function resetProgressBarGrammar(){var e=document.getElementById("progress-bar"),t=document.getElementById("progress-text");e&&(e.style.width="0%",e.innerText="0%"),t&&(t.innerText="Обработано 0 из 0 чанков")}function splitTextIntoChunksGrammar(e,t){for(var n=e.match(/[^.!?]+[.!?]+(\s|$)|[^.!?]+$/g)||[e],r=[],a=0;a<n.length;a+=t){var o=n.slice(a,a+t).join(" ").trim();r.push(o)}return r}function analyzeTextWithRetryGrammar(e,t,n){return _analyzeTextWithRetryGrammar.apply(this,arguments)}function _analyzeTextWithRetryGrammar(){return(_analyzeTextWithRetryGrammar=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a,o,c,l,i;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=document.getElementById("retry-on-error-checkbox").checked,o=parseInt(document.getElementById("retry-count").value,10)||1,c=0,l=null;case 4:if(!(c<o)){e.next=23;break}return e.prev=5,e.next=8,analyzeTextGrammar(t,n,r);case 8:return i=e.sent,e.abrupt("return",i);case 12:if(e.prev=12,e.t0=e.catch(5),l=e.t0,c++,a&&!(c>=o)){e.next=20;break}throw e.t0;case 20:console.warn("Попытка ".concat(c," не удалась. Повторяем..."));case 21:e.next=4;break;case 23:throw l;case 24:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function analyzeTextGrammar(e,t,n){return _analyzeTextGrammar.apply(this,arguments)}function _analyzeTextGrammar(){return(_analyzeTextGrammar=_asyncToGenerator(_regeneratorRuntime().mark((function e(t,n,r){var a,o,c,l,i,s,m,d,u,p,g,h,f,y,v,x,b;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=localStorage.getItem("apiKey"),o=[],c={},l={},i=getDefaultPromptsGrammar(),document.getElementById("check-grammatical").checked&&(o.push("грамматические"),c["грамматическая"]=!0,l["грамматическая"]=document.getElementById("prompt-grammatical").value||i["грамматическая"]),document.getElementById("check-syntactic").checked&&(o.push("синтаксические"),c["синтаксическая"]=!0,l["синтаксическая"]=document.getElementById("prompt-syntactic").value||i["синтаксическая"]),document.getElementById("check-stylistic").checked&&(o.push("стилистические"),c["стилистическая"]=!0,l["стилистическая"]=document.getElementById("prompt-stylistic").value||i["стилистическая"]),document.getElementById("check-logical").checked&&(o.push("логические"),c["логическая"]=!0,l["логическая"]=document.getElementById("prompt-logical").value||i["логическая"]),0!==o.length){e.next=11;break}throw new Error("Не выбраны типы проверок");case 11:return s=o.join(", "),m=document.getElementById("prompt-text-note").value||"",d=document.getElementById("prompt-role").value||i.role,u=parseFloat(document.getElementById("temperature").value)||.1,p=parseInt(document.getElementById("max-tokens").value,10)||8e3,g=document.getElementById("response-format-checkbox").checked,h="".concat(d," Твоя задача - проанализировать предоставленный текст и найти только следующие типы ошибок: ").concat(s,".\n\n").concat(m?"Дополнительная информация о тексте: ".concat(m,"\n"):"","\n\n").concat(Object.keys(l).map((function(e){return'Инструкция для "'.concat(e,'" ошибок:\n').concat(l[e],"\n")})).join("\n"),'\n\nТвои инструкции:\n\n- Анализируй текст на уровне предложений и отдельных слов.\n\n- Ищи только указанные типы ошибок.\n\n- Игнорируй другие типы ошибок.\n\n- Если исправление можно внести напрямую в текст и оно не добавляет новой информации, установи "can_edit": true и предоставь поле "text_to_change" с исправленным текстом.\n\n- Если исправление невозможно внести напрямую в текст или добавляет новую информацию, установи "can_edit": false, предоставь поле "suggestion" с рекомендациями по улучшению и добавь поле "example" с примером улучшенного текста.\n\n- Убедись, что все строки в JSON корректно экранированы. В частности, любые двойные кавычки внутри значений строк должны быть экранированы обратным слешем (\\"").\n\n- Возвращай результат в формате JSON-массива, где каждый элемент содержит:\n  1. "text": проблемный фрагмент текста (слово, фраза или предложение).\n  2. "comment": объяснение проблемы.\n  3. "errorType": тип ошибки (').concat(Object.keys(c).map((function(e){return'"'.concat(e,'"')})).join(", "),').\n  4. "can_edit": true или false (указывает, можно ли внести исправление напрямую в текст).\n  5. Если "can_edit" равно true, добавь поле "text_to_change" с исправленным текстом.\n  6. Если "can_edit" равно false, добавь поле "suggestion" с рекомендациями по улучшению и поле "example" с примером улучшенного текста.\n\nПример ответа:\n\n').concat(getExampleErrorsGrammar(Object.keys(c)),'\n\nВажно:\n\n- Возвращай *только* JSON-массив без дополнительных пояснений или предисловий.\n\n- Убедись, что все строки в JSON корректно экранированы. В частности, любые двойные кавычки внутри значений строк должны быть экранированы обратным слешем (").\n\n- Если ошибок нет, верни пустой массив: [];\n'),f='Пожалуйста, проанализируй следующий текст:\n\n"'.concat(t,'";\n'),e.prev=19,y={model:n,messages:[{role:"system",content:h},{role:"user",content:f}],temperature:u,max_tokens:p},g&&(y.response_format={type:"json_object"}),e.next=24,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word Grammar Checker"},body:JSON.stringify(y),signal:r});case 24:if((v=e.sent).ok){e.next=27;break}throw new Error("HTTP error! status: ".concat(v.status));case 27:return e.next=29,v.json();case 29:return x=e.sent,console.log("Ответ от сервера:",x.choices[0].message.content.trim()),b=safeJsonParseGrammar(x.choices[0].message.content.trim()),e.abrupt("return",b);case 35:if(e.prev=35,e.t0=e.catch(19),"AbortError"!==e.t0.name){e.next=42;break}throw console.log("Запрос был отменен."),e.t0;case 42:throw console.error("Error in analyzeTextGrammar:",e.t0),e.t0;case 44:case"end":return e.stop()}}),e,null,[[19,35]])})))).apply(this,arguments)}function safeJsonParseGrammar(e){try{return JSON.parse(e)}catch(n){var t=e.replace(/\\?"/g,'\\"').replace(/\\\\"/g,'\\"');try{return JSON.parse(t)}catch(e){throw console.error("Failed to parse JSON after fixing:",e),e}}}function getExampleErrorsGrammar(e){var t=[];return e.includes("грамматическая")&&(t.push('{\n    "text": "Она сказал",\n    "comment": "Неправильное согласование рода в глаголе.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала"\n}'),t.push('{\n    "text": "Я иду в школу завтра.",\n    "comment": "Неправильное использование времени глагола.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "Я пойду в школу завтра."\n}'),t.push('{\n    "text": "У него есть две собаки и три кошка.",\n    "comment": "Неправильное согласование числительного и существительного.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "У него есть две собаки и три кошки."\n}'),t.push('{\n    "text": "Бегу по дороге быстро.",\n    "comment": "Отсутствует подлежащее в предложении.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Добавить подлежащее для ясности.",\n    "example": "Я бегу по дороге быстро."\n}'),t.push('{\n    "text": "Придя домой, было тихо.",\n    "comment": "Неправильное употребление деепричастного оборота без подлежащего.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Переписать предложение, указав, кто пришел домой.",\n    "example": "Когда я пришёл домой, было тихо."\n}'),t.push('{\n    "text": "Книга, которую я читаю интересная.",\n    "comment": "Отсутствует запятая перед придаточным предложением.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Добавить запятую для правильной пунктуации.",\n    "example": "Книга, которую я читаю, интересная."\n}')),e.includes("синтаксическая")&&(t.push('{\n    "text": "Я люблю читать книги смотреть фильмы.",\n    "comment": "Отсутствует союз между однородными членами предложения.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "Я люблю читать книги и смотреть фильмы."\n}'),t.push('{\n    "text": "Она сказала что придет позже.",\n    "comment": "Отсутствует запятая перед придаточным предложением.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала, что придет позже."\n}'),t.push('{\n    "text": "После дождя дорога была скользкая она упала.",\n    "comment": "Отсутствует разделение на предложения или союз.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "После дождя дорога была скользкая, и она упала."\n}'),t.push('{\n    "text": "Мы приносим свои искренние извинения всем,кого могли забыть упомянуть здесь.",\n    "comment": "Синтаксическая ошибка: отсутствует пробел после запятой.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Добавить пробел после запятой.",\n    "example": "Мы приносим свои искренние извинения всем, кого могли забыть упомянуть здесь."\n}'),t.push('{\n    "text": "Из-за того что шел дождь.",\n    "comment": "Неполное предложение: отсутствует главная часть.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Добавить главную часть предложения для завершенности.",\n    "example": "Из-за того что шел дождь, мы остались дома."\n}'),t.push('{\n    "text": "Планируя поездку, была куплена карта.",\n    "comment": "Неясно, кто планировал поездку; неправильно построен деепричастный оборот.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Переписать предложение для ясности.",\n    "example": "Планируя поездку, мы купили карту."\n}')),e.includes("стилистическая")&&(t.push('{\n    "text": "Он встал рано утром, чтобы пойти на работку.",\n    "comment": "Нежелательное использование уменьшительно-ласкательного суффикса.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "Он встал рано утром, чтобы пойти на работу."\n}'),t.push('{\n    "text": "Она сказала ему, что это офигенно.",\n    "comment": "Нежелательное использование разговорного выражения.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала ему, что это великолепно."\n}'),t.push('{\n    "text": "В результате он потерпел фиаско.",\n    "comment": "Стилистическая неточность: использование заимствованного слова, которое может быть заменено более подходящим.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "В результате он потерпел неудачу."\n}'),t.push('{\n    "text": "Нам повезло, что мы получили отличную поддержку.",\n    "comment": "Стилистическая неточность: слово \'повезло\' может преуменьшать усилия тех, кто оказал поддержку.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Заменить выражение на более признательное.",\n    "example": "Мы благодарны за отличную поддержку, которую получили."\n}'),t.push('{\n    "text": "Доклад был ничего так, слушатели остались довольны.",\n    "comment": "Неофициальный стиль изложения в формальном контексте.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Исправить выражение на более формальное.",\n    "example": "Доклад был информативным, и слушатели остались довольны."\n}'),t.push('{\n    "text": "Он сделал это быстрее всех, потому что он крутой.",\n    "comment": "Использование жаргонного слова в официальном тексте.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Заменить жаргонное слово на более подходящее.",\n    "example": "Он сделал это быстрее всех благодаря своим навыкам."\n}')),e.includes("логическая")&&(t.push('{\n    "text": "Она родилась в 2000 году и в 1990 году окончила университет.",\n    "comment": "Логическая ошибка: невозможно окончить университет до рождения.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Она родилась в 1970 году и в 1990 году окончила университет."\n}'),t.push('{\n    "text": "Он съел обед перед завтраком.",\n    "comment": "Логическая несостыковка во времени приема пищи.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Он съел завтрак перед обедом."\n}'),t.push('{\n    "text": "Вода замерзает при 100 градусах Цельсия.",\n    "comment": "Неправильная температура замерзания воды.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Вода замерзает при 0 градусах Цельсия."\n}'),t.push('{\n    "text": "Этот квадрат имеет три стороны.",\n    "comment": "Логическое противоречие: квадрат не может иметь три стороны.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Уточнить форму или количество сторон фигуры.",\n    "example": "Этот треугольник имеет три стороны."\n}'),t.push('{\n    "text": "Он продал больше книг, чем любой другой автор, включая себя.",\n    "comment": "Логическая ошибка: некорректное сравнение с самим собой.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Пересмотреть формулировку сравнения.",\n    "example": "Он продал больше книг, чем любой другой автор."\n}'),t.push('{\n    "text": "Она всегда говорит правду, но ей нельзя доверять.",\n    "comment": "Логическое противоречие в характеристике.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Уточнить описание для устранения противоречия.",\n    "example": "Она часто обманывает, поэтому ей нельзя доверять."\n}')),"[\n  ".concat(t.join(",\n  "),"\n]")}function displayResultsGrammar(e){var t=document.getElementById("grammar-results");if(t.innerHTML="",0!==e.length){var n=document.getElementById("filter-select").value,r={};if(e.forEach((function(e,t){var a=e.errorType||"Другие";r[a]||(r[a]=[]),e.index=t,("can_edit"!==n||e.can_edit)&&("cannot_edit"===n&&e.can_edit||r[a].push(e))})),Object.keys(r).forEach((function(e){0===r[e].length&&delete r[e]})),0!==Object.keys(r).length){var a="grammarAccordion",o='<div class="accordion" id="'.concat(a,'">');Object.keys(r).forEach((function(e,t){var n=r[e],c="collapse".concat(t);o+='\n            <div class="card">\n                <div class="card-header" id="heading'.concat(t,'">\n                    <h2 class="mb-0">\n                        <button class="btn btn-link ').concat(0===t?"":"collapsed",'" type="button" data-toggle="collapse" data-target="#').concat(c,'" aria-expanded="').concat(0===t?"true":"false",'" aria-controls="').concat(c,'">\n                            ').concat(e.charAt(0).toUpperCase()+e.slice(1),' ошибки (<span class="error-count">').concat(n.length,'</span>)\n                        </button>\n                    </h2>\n                </div>\n                <div id="').concat(c,'" class="collapse ').concat(0===t?"show":"",'" aria-labelledby="heading').concat(t,'" data-parent="#').concat(a,'">\n                    <div class="card-body">\n                        ').concat(n.map((function(t,r){return'\n                            <div class="mb-3 p-3 border error-card '.concat(r<n.length-1?"border-bottom":"",'" data-error-index="').concat(t.index,'" data-error-type="').concat(e,'">\n                                <p><strong>Проблемный текст:</strong> <span class="text-danger">').concat(t.text,"</span></p>\n                                <p><strong>Комментарий:</strong> ").concat(t.comment,"</p>\n                                ").concat(t.can_edit?'<p><strong>Исправление:</strong> <span class="text-success">'.concat(t.text_to_change,'</span></p>\n                                <button class="btn btn-sm btn-primary apply-suggestion" data-error-index="').concat(t.index,'">Применить исправление</button>'):"<p><strong>Рекомендации:</strong> ".concat(t.suggestion,'</p>\n                                <p><strong>Пример улучшенного текста:</strong> <span class="text-info">').concat(t.example,"</span></p>\n                                <p><em>Исправление невозможно применить напрямую.</em></p>"),"\n                            </div>\n                        ")})).join(""),"\n                    </div>\n                </div>\n            </div>\n        ")})),o+="</div>",t.innerHTML=o;var c,l=_createForOfIteratorHelper(document.getElementsByClassName("apply-suggestion"));try{for(l.s();!(c=l.n()).done;)c.value.addEventListener("click",(function(){var e=parseInt(this.dataset.errorIndex,10);applySuggestion(e,window.grammarResults,this)}))}catch(e){l.e(e)}finally{l.f()}}else t.innerHTML='<p class="text-info">Нет ошибок для отображения по выбранному фильтру.</p>'}else t.innerHTML='<p class="text-success">Ошибок не найдено. Текст выглядит хорошо!</p>'}function highlightTextGrammar(e){return _highlightTextGrammar.apply(this,arguments)}function _highlightTextGrammar(){return _highlightTextGrammar=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,r;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("highlight-checkbox").checked,r=document.getElementById("comment-checkbox").checked,n||r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Word.run(function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(a){var o,c,l,i,s,m,d,u,p;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=a.document.getSelection(),c=_createForOfIteratorHelper(t),e.prev=2,c.s();case 4:if((l=c.n()).done){e.next=19;break}return i=l.value,(s=o.search(i.text,{matchCase:!0,matchWholeWord:!1})).load("items"),a.trackedObjects.add(s),e.next=11,a.sync();case 11:if(!(s.items.length>0)){e.next=16;break}m=_createForOfIteratorHelper(s.items);try{for(m.s();!(d=m.n()).done;)u=d.value,n&&(u.font.highlightColor="yellow"),r&&(p="Тип ошибки: ".concat(i.errorType,"\nКомментарий: ").concat(i.comment),i.can_edit?p+="\nИсправление: ".concat(i.text_to_change):p+="\nРекомендации: ".concat(i.suggestion,"\nПример улучшенного текста: ").concat(i.example),u.insertComment(p))}catch(e){m.e(e)}finally{m.f()}return e.next=16,a.sync();case 16:a.trackedObjects.remove(s);case 17:e.next=4;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(2),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[2,21,24,27]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Error:",e)}));case 6:case"end":return e.stop()}}),e)}))),_highlightTextGrammar.apply(this,arguments)}function showLoadingGrammar(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("loading"),r=document.getElementById("check-grammar"),a=document.getElementById("progress-container"),o=document.getElementById("spinner");e?(n.style.display="block",r.disabled=!0,t?(a.style.display="block",o.style.display="none"):(a.style.display="none",o.style.display="block")):(n.style.display="none",r.disabled=!1,a.style.display="none",o.style.display="none")}Office.onReady((function(e){e.host===Office.HostType.Word&&(initHome(),initPrompts(),initSettings(),initGrammar())})),document.addEventListener("DOMContentLoaded",(function(){initHome(),initPrompts(),initSettings(),initGrammar()}));