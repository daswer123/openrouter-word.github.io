{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://office-addin-taskpane-js/./node_modules/html-loader/dist/runtime/getUrl.js","webpack://office-addin-taskpane-js/webpack/bootstrap","webpack://office-addin-taskpane-js/webpack/runtime/compat get default export","webpack://office-addin-taskpane-js/webpack/runtime/define property getters","webpack://office-addin-taskpane-js/webpack/runtime/global","webpack://office-addin-taskpane-js/webpack/runtime/hasOwnProperty shorthand","webpack://office-addin-taskpane-js/webpack/runtime/publicPath","webpack://office-addin-taskpane-js/webpack/runtime/jsonp chunk loading","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.js","webpack://office-addin-taskpane-js/./src/taskpane/taskpane.html"],"sourcesContent":["\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    // eslint-disable-next-line no-param-reassign\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, no-param-reassign\n  url = String(url.__esModule ? url.default : url);\n  if (options.hash) {\n    // eslint-disable-next-line no-param-reassign\n    url += options.hash;\n  }\n  if (options.maybeNeedQuotes && /[\\t\\n\\f\\r \"'=<>`]/.test(url)) {\n    return \"\\\"\".concat(url, \"\\\"\");\n  }\n  return url;\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t926: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function"," function getPrompts() {\n    return JSON.parse(localStorage.getItem('prompts') || '[]');\n}\n\n function savePrompts(prompts) {\n    localStorage.setItem('prompts', JSON.stringify(prompts));\n}\n\n function getLastSelectedPromptIndex() {\n    return parseInt(localStorage.getItem('lastSelectedPromptIndex') || '-1', 10);\n}\n\n function saveLastSelectedPromptIndex(index) {\n    localStorage.setItem('lastSelectedPromptIndex', index.toString());\n}\n\n\n\n function initSettings() {\n    const settingsTab = document.getElementById('settings');\n    settingsTab.innerHTML = `\n        <div class=\"mt-3\">\n            <label for=\"api-key\" class=\"form-label\">API Ключ:</label>\n            <input type=\"password\" id=\"api-key\" class=\"form-control\">\n        </div>\n        <div class=\"mt-3\">\n            <label for=\"formatting-model\" class=\"form-label\">Модель для форматирования:</label>\n            <select id=\"formatting-model\" class=\"form-select\"></select>\n        </div>\n        <div class=\"mt-3 form-check\">\n            <input type=\"checkbox\" class=\"form-check-input\" id=\"apply-formatting\">\n            <label class=\"form-check-label\" for=\"apply-formatting\">Применять форматирование</label>\n        </div>\n    `;\n\n    document.getElementById('api-key').onchange = saveApiKey;\n    document.getElementById('formatting-model').onchange = saveFormattingModel;\n    document.getElementById('apply-formatting').onchange = saveApplyFormatting;\n    loadModels();\n    loadSettings();\n\n    // Инициализируем Select2 для выбора модели форматирования\n    $('#formatting-model').select2({\n        width: '100%',\n        placeholder: 'Выберите модель для форматирования',\n    }).on('select2:opening', function() {\n        setTimeout(() => {\n            $('.select2-search__field').get(0).focus();\n        }, 0);\n    });\n}\n\n\nfunction saveFormattingModel() {\n    const formattingModel = document.getElementById('formatting-model').value;\n    localStorage.setItem('formattingModel', formattingModel);\n}\n\nfunction saveApplyFormatting() {\n    const applyFormatting = document.getElementById('apply-formatting').checked;\n    localStorage.setItem('applyFormatting', applyFormatting);\n}\n\nfunction loadSettings() {\n    const apiKey = localStorage.getItem('apiKey') || '';\n    const formattingModel = localStorage.getItem('formattingModel') || 'openai/gpt-4-mini';\n    const applyFormatting = localStorage.getItem('applyFormatting') === 'true';\n\n    document.getElementById('api-key').value = apiKey;\n    $('#formatting-model').val(formattingModel).trigger('change');\n    document.getElementById('apply-formatting').checked = applyFormatting;\n}\n\n\n\n function populateModelSelectt(models) {\n    const promptModelSelect = $('#prompt-model');\n    const formattingModelSelect = $('#formatting-model');\n\n    [promptModelSelect, formattingModelSelect].forEach(select => {\n        select.empty();\n        models.forEach(model => {\n            const option = new Option(model.name, model.id, false, false);\n            select.append(option);\n        });\n        select.trigger('change');\n    });\n\n    // Устанавливаем значение по умолчанию для formatting-model\n    const defaultModel = models.find(model => model.id === 'openai/gpt-4-mini') || models[0];\n    if (defaultModel) {\n        formattingModelSelect.val(defaultModel.id).trigger('change');\n    }\n\n    // Загружаем сохраненное значение, если оно есть\n    const savedModel = localStorage.getItem('formattingModel');\n    if (savedModel && models.some(model => model.id === savedModel)) {\n        formattingModelSelect.val(savedModel).trigger('change');\n    }\n}\n\n\n\nfunction saveApiKey() {\n    const apiKey = document.getElementById('api-key').value;\n    localStorage.setItem('apiKey', apiKey);\n}\n\n\n\n\nconst OPENROUTER_BASE_URL = \"https://openrouter.ai/api/v1\";\n\n async function loadModels() {\n    try {\n        const response = await axios.get(`${OPENROUTER_BASE_URL}/models`);\n        const models = response.data.data;\n        localStorage.setItem('models', JSON.stringify(models));\n        populateModelSelectt(models);\n    } catch (error) {\n        console.error('Error loading models:', error);\n    }\n}\n\n async function generateTextWithAI(systemPrompt, userPrompt, model, signal) {\n    const apiKey = localStorage.getItem('apiKey');\n\n    try {\n        const response = await fetch(`${OPENROUTER_BASE_URL}/chat/completions`, {\n            method: 'POST',\n            signal,\n            headers: {\n                'Authorization': `Bearer ${apiKey}`,\n                'Content-Type': 'application/json',\n                'HTTP-Referer': 'https://www.office.com',\n                'X-Title': 'Word AI Assistant',\n            },\n            body: JSON.stringify({\n                model: model,\n                messages: [\n                    { role: \"system\", content: systemPrompt },\n                    { role: \"user\", content: userPrompt }\n                ],\n            }),\n        });\n\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data.choices[0].message.content.trim();\n    } catch (error) {\n        console.error('Error in generateTextWithAI:', error);\n        throw error;\n    }\n}\n\n async function generateTextWithAIFormat(systemPrompt, userPrompt, model, signal) {\n    const apiKey = localStorage.getItem('apiKey');\n\n    try {\n        const response = await fetch(`${OPENROUTER_BASE_URL}/chat/completions`, {\n            method: 'POST',\n            signal,\n            headers: {\n                'Authorization': `Bearer ${apiKey}`,\n                'Content-Type': 'application/json',\n                'HTTP-Referer': 'https://www.office.com',\n                'X-Title': 'Word AI Assistant',\n            },\n            body: JSON.stringify({\n                model: model,\n                messages: [\n                    { role: \"system\", content: systemPrompt },\n                    { role: \"user\", content: userPrompt }\n                ],\n            }),\n        });\n\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        return data.choices[0].message.content.trim();\n    } catch (error) {\n        console.error('Error in generateTextWithAI:', error);\n        throw error;\n    }\n}\n\n\n\nlet originalText = \"\";\nlet currentController = null;\nlet lastSelectedPrompt = null;\n\n function initHome() {\n  const homeTab = document.getElementById('home');\n  homeTab.innerHTML = `\n      <select id=\"prompt-select\" class=\"form-select mt-3\"></select>\n      <div id=\"selected-model\" class=\"mt-2\"></div>\n      <button id=\"replace-text\" class=\"btn btn-primary mt-3\" disabled>Заменить выделенный текст</button>\n      <button id=\"cancel-request\" class=\"btn btn-secondary mt-3\" style=\"display: none;\">Отменить запрос</button>\n      <button id=\"show-selected-text\" class=\"btn btn-info mt-3\">Показать информацию о выделенном тексте</button>\n      <!-- <button id=\"apply-tricks\" class=\"btn btn-warning mt-3\">Применить приколы</button>\n      <button id=\"repeat-styles\" class=\"btn btn-primary mt-3\">Повтор стилей</button> -->\n      <div id=\"selected-text-info\" class=\"mt-3\"></div>\n  `;\n\n  $('#prompt-select').select2({\n      width: '100%',\n      placeholder: 'Выберите промпт',\n      templateResult: formatPrompt,\n      templateSelection: formatPromptSelection,\n  });\n\n  document.getElementById(\"replace-text\").onclick = replaceSelectedText;\n  document.getElementById(\"cancel-request\").onclick = cancelRequest;\n  document.getElementById(\"show-selected-text\").onclick = showSelectedText;\n  // document.getElementById(\"apply-tricks\").onclick = applyTricks;\n  // document.getElementById(\"repeat-styles\").onclick = repeatStyles;\n\n  updatePromptSelect();\n  setInterval(checkSelection, 1000);\n}\n\nfunction formatPrompt(prompt) {\n    if (!prompt.id) {\n        return prompt.text;\n    }\n    const prompts = getPrompts();\n    const promptData = prompts[prompt.id];\n    return $(`<span>${promptData.name} (${promptData.model})</span>`);\n}\n\nfunction formatPromptSelection(prompt) {\n    if (!prompt.id) {\n        return prompt.text;\n    }\n    const prompts = getPrompts();\n    const promptData = prompts[prompt.id];\n    return promptData.name;\n}\n\n function updatePromptSelect() {\n    const select = $('#prompt-select');\n    const modelDiv = document.getElementById('selected-model');\n    const prompts = getPrompts();\n    select.empty();\n    select.append(new Option('Выберите промпт', '', true, true));\n    const lastSelectedPromptIndex = getLastSelectedPromptIndex();\n    prompts.forEach((prompt, index) => {\n        const option = new Option(prompt.name, index, false, index === lastSelectedPromptIndex);\n        select.append(option);\n    });\n    select.trigger('change');\n    const promptIndex = lastSelectedPromptIndex >= 0 && lastSelectedPromptIndex < prompts.length ? lastSelectedPromptIndex : null;\n    lastSelectedPrompt = promptIndex !== null ? prompts[promptIndex] : null;\n    modelDiv.textContent = lastSelectedPrompt ? `Модель: ${lastSelectedPrompt.model}` : '';\n    document.getElementById(\"replace-text\").disabled = !lastSelectedPrompt;\n    select.on('change', function() {\n        const newPromptIndex = $(this).val();\n        lastSelectedPrompt = newPromptIndex ? prompts[newPromptIndex] : null;\n        saveLastSelectedPromptIndex(newPromptIndex || -1);\n        modelDiv.textContent = lastSelectedPrompt ? `Модель: ${lastSelectedPrompt.model}` : '';\n        document.getElementById(\"replace-text\").disabled = !lastSelectedPrompt;\n    });\n}\n\nfunction checkSelection() {\n    Word.run(async (context) => {\n        const selection = context.document.getSelection();\n        selection.load(\"text\");\n        await context.sync();\n\n        const replaceButton = document.getElementById(\"replace-text\");\n        if (selection.text.trim().length > 0) {\n            replaceButton.disabled = false;\n        } else {\n            replaceButton.disabled = true;\n        }\n    });\n}\n\nasync function replaceSelectedText() {\n  Word.run(async (context) => {\n      const selection = context.document.getSelection();\n      selection.load(\"text\");\n      await context.sync();\n\n      originalText = selection.text;\n\n      if (!lastSelectedPrompt) return;\n\n      document.getElementById(\"replace-text\").style.display = \"none\";\n      document.getElementById(\"cancel-request\").style.display = \"inline-block\";\n\n      try {\n          currentController = new AbortController();\n\n          const applyFormatting = localStorage.getItem('applyFormatting') === 'true';\n          const formattingModel = localStorage.getItem('formattingModel') || 'openai/gpt-4-mini';\n          let formattingInfo = [];\n\n          if (applyFormatting) {\n              formattingInfo = await getWordsInfo(context, selection);\n          }\n\n          const systemPrompt = `You are an AI assistant specialized in text processing and formatting. Your task is to generate text based on user prompts and, when required, update formatting information for the generated text. Always provide responses in the requested format.`;\n\n          const userPrompt = `${lastSelectedPrompt.text}\\n\\nUser provided the following text: \"${originalText}\"${applyFormatting ? `\\n\\nFormatting information: ${JSON.stringify(formattingInfo)}` : ''}`;\n\n          const generatedText = await generateTextWithAI(systemPrompt, userPrompt, lastSelectedPrompt.model, currentController.signal);\n\n          if (applyFormatting) {\n              const secondSystemPrompt = `You are an AI assistant specialized in text formatting. Your task is to update formatting information for modified text while preserving the original styles as much as possible. Always return your response as a valid JSON array.`;\n\n              const secondUserPrompt = `\nOriginal text: \"${originalText}\"\nModified text: \"${generatedText}\"\nOriginal formatting information: ${JSON.stringify(formattingInfo)}\n\nTask: Update the formatting information to match the new text while preserving the original styles and formats. Return ONLY the updated formatting information array in valid JSON format.\n\nInstructions:\n1. Analyze the original and modified texts.\n2. Create a new array of formatting information for the modified text.\n3. Preserve the original formatting styles as much as possible.\n4. Ensure the number of elements in the array matches the number of words in the modified text.\n5. Return ONLY the JSON array, without any additional text or explanation.\n\nThe JSON array should contain objects with the following possible properties:\n- text: string (required) - the word from the modified text\n- bold: boolean\n- italic: boolean\n- underline: boolean\n- color: string (e.g., \"#FF0000\" for red)\n- highlightColor: string (e.g., \"yellow\")\n- size: number\n- fontName: string\n- hyperlink: string (URL)\n- footnoteText: string\n\nExample of a valid response:\n[\n{\"text\": \"This\", \"bold\": true, \"color\": \"#0000FF\"},\n{\"text\": \"is\", \"italic\": true},\n{\"text\": \"an\", \"underline\": true},\n{\"text\": \"example\", \"size\": 14, \"fontName\": \"Arial\"},\n{\"text\": \"with\", \"highlightColor\": \"yellow\"},\n{\"text\": \"formatting\", \"hyperlink\": \"https://example.com\"},\n{\"text\": \"applied\", \"footnoteText\": \"This is a footnote example\"}\n]\n\nEnsure your response is a valid JSON array and includes formatting information for all words in the modified text.`;\n\n              let updatedFormattingInfo;\n              try {\n                  const formattingResponse = await generateTextWithAIFormat(secondSystemPrompt, secondUserPrompt, formattingModel, currentController.signal);\n                  updatedFormattingInfo = JSON.parse(formattingResponse);\n\n                  if (!Array.isArray(updatedFormattingInfo)) {\n                      throw new Error(\"Response is not an array\");\n                  }\n              } catch (error) {\n                  console.error(\"Error parsing formatting information:\", error);\n                  selection.insertText(generatedText, Word.InsertLocation.replace);\n                  return;\n              }\n\n              await applyFormattedText(context, selection, generatedText, updatedFormattingInfo);\n          } else {\n              selection.insertText(generatedText, Word.InsertLocation.replace);\n          }\n      } catch (error) {\n          if (error.name !== 'AbortError') {\n              console.error('Error:', error);\n          }\n      } finally {\n          document.getElementById(\"cancel-request\").style.display = \"none\";\n          document.getElementById(\"replace-text\").style.display = \"inline-block\";\n          currentController = null;\n      }\n  });\n}\n\n\nasync function applyFormattedText(context, selection, newText, formattingInfo) {\n  selection.clear();\n  await context.sync();\n\n  const words = newText.split(/\\s+/);\n  let wordIndex = 0;\n\n  for (let i = 0; i < words.length; i++) {\n      let word = words[i];\n      let range = selection.insertText(word, Word.InsertLocation.end);\n\n      if (wordIndex < formattingInfo.length) {\n          const wordInfo = formattingInfo[wordIndex];\n\n          if (wordInfo.bold !== undefined) range.font.bold = wordInfo.bold;\n          if (wordInfo.italic !== undefined) range.font.italic = wordInfo.italic;\n          if (wordInfo.color) range.font.color = wordInfo.color;\n          if (wordInfo.highlightColor) range.font.highlightColor = wordInfo.highlightColor;\n          if (wordInfo.size) range.font.size = wordInfo.size;\n\n          if (wordInfo.hyperlink) {\n              range.hyperlink = wordInfo.hyperlink;\n          }\n\n          if (wordInfo.footnoteText) {\n              let newFootnote = range.insertFootnote();\n              newFootnote.body.insertText(wordInfo.footnoteText, Word.InsertLocation.start);\n          }\n\n          wordIndex++;\n      }\n\n      if (i < words.length - 1) {\n          selection.insertText(\" \", Word.InsertLocation.end);\n      }\n\n      await context.sync();\n  }\n}\n\n\nfunction cancelRequest() {\n    if (currentController) {\n        currentController.abort();\n        document.getElementById(\"cancel-request\").style.display = \"none\";\n        document.getElementById(\"replace-text\").style.display = \"inline-block\";\n    }\n}\n\nasync function applyTricks() {\n  await Word.run(async (context) => {\n    const selection = context.document.getSelection();\n    selection.load(\"text\");\n    await context.sync();\n\n    const words = selection.text.trim().split(/\\s+/);\n    if (words.length < 4) {\n      console.log(\"Выделите минимум 4 слова\");\n      return;\n    }\n\n    const range = selection.getRange();\n    range.clear();\n    await context.sync();\n\n    for (let i = 0; i < words.length; i++) {\n      const word = words[i];\n      let wordRange = range.insertText(word + \" \", Word.InsertLocation.end);\n\n      wordRange.font.bold = false;\n      wordRange.font.italic = false;\n      wordRange.font.color = 'black';\n      wordRange.font.highlightColor = \"white\";\n      wordRange.font.size = 11;\n\n      if (i === 0) {\n        wordRange.font.bold = true;\n      }\n\n      if (i === 1) {\n        wordRange.font.italic = true;\n      }\n\n      if (i === 2) {\n        wordRange.hyperlink = \"https://www.example.com\";\n      }\n\n      if (i === 3) {\n        wordRange.font.color = 'red';\n      }\n\n      if (i === 4) {\n        wordRange.font.highlightColor = 'yellow';\n      }\n\n      if (i === 5) {\n        wordRange.font.size = 16;\n      }\n\n      if (i === words.length - 1) {\n        let footnote = wordRange.insertFootnote();\n        footnote.body.insertText(\"Это пример сноски\", Word.InsertLocation.start);\n      }\n\n      await context.sync();\n    }\n  });\n}\n\nfunction formatSpecialWords(wordsInfo, baseColor, baseFont, baseSize) {\n  let formattedText = [];\n  let footnotes = [];\n\n  wordsInfo.forEach((word, index) => {\n    let wordData = { text: word.text };\n    let hasSpecialFormatting = false;\n\n    let formatting = {};\n\n    if (word.bold === true || word.bold === null) {\n      formatting.bold = true;\n      hasSpecialFormatting = true;\n    }\n    if (word.italic) {\n      formatting.italic = true;\n      hasSpecialFormatting = true;\n    }\n    if (word.underline) {\n      formatting.underline = true;\n      hasSpecialFormatting = true;\n    }\n    if (word.color !== baseColor && word.color !== \"\") {\n      formatting.color = word.color;\n      hasSpecialFormatting = true;\n    }\n    if (word.highlightColor && word.highlightColor !== null) {\n      formatting.highlight = word.highlightColor;\n      hasSpecialFormatting = true;\n    }\n    if (word.fontName !== baseFont && word.fontName !== \"\") {\n      formatting.font = word.fontName;\n      hasSpecialFormatting = true;\n    }\n    if (word.fontSize != baseSize && word.fontSize !== \"\" && word.fontSize !== null) {\n      formatting.size = word.fontSize;\n      hasSpecialFormatting = true;\n    }\n    if (word.hyperlink) {\n      formatting.hyperlink = word.hyperlink;\n      hasSpecialFormatting = true;\n    }\n\n    if (Object.keys(formatting).length > 0) {\n      wordData.formatting = formatting;\n    }\n\n    if (word.hasFootnote) {\n      wordData.footnoteId = index + 1;\n      footnotes.push({\n        id: index + 1,\n        text: word.footnoteText,\n        relatedWordIndex: formattedText.length\n      });\n      hasSpecialFormatting = true;\n    }\n\n    if (hasSpecialFormatting) {\n      formattedText.push(wordData);\n    }\n  });\n\n  return {\n    formattedText: formattedText,\n    footnotes: footnotes,\n    baseFormatting: {\n      color: baseColor,\n      font: baseFont,\n      size: baseSize\n    }\n  };\n}\n\nasync function showSelectedText() {\n  await Word.run(async (context) => {\n    const selection = context.document.getSelection();\n    const ranges = selection.getTextRanges([\" \"], false);\n    ranges.load(\"items\");\n\n    await context.sync();\n\n    let wordsInfo = [];\n    let colorCounts = {};\n    let fontCounts = {};\n    let sizeCounts = {};\n\n    for (let i = 0; i < ranges.items.length; i++) {\n      const range = ranges.items[i];\n      range.load(\"text, hyperlink\");\n      range.font.load(\"bold, italic, underline, color, highlightColor, name, size\");\n\n      const footnotes = range.footnotes;\n      footnotes.load(\"items\");\n\n      await context.sync();\n\n      if (range.text.trim()) {\n        const color = range.font.color || \"default\";\n        const font = range.font.name || \"default\";\n        const size = range.font.size || \"default\";\n\n        colorCounts[color] = (colorCounts[color] || 0) + 1;\n        fontCounts[font] = (fontCounts[font] || 0) + 1;\n        sizeCounts[size] = (sizeCounts[size] || 0) + 1;\n\n        let footnoteText = \"\";\n        if (footnotes.items.length > 0) {\n          const footnote = footnotes.items[0];\n          footnote.body.load(\"text\");\n          await context.sync();\n          footnoteText = footnote.body.text;\n        }\n\n        wordsInfo.push({\n          text: range.text.trim(),\n          bold: range.font.bold,\n          italic: range.font.italic,\n          underline: range.font.underline !== \"None\",\n          color: color,\n          highlightColor: range.font.highlightColor,\n          hasFootnote: footnotes.items.length > 0,\n          footnoteText: footnoteText,\n          fontName: font,\n          fontSize: size,\n          hyperlink: range.hyperlink ? range.hyperlink.address : null,\n          isFirstWord: i === 0,\n          isSecondWord: i === 1,\n          isThirdWord: i === 2,\n          isLastWord: i === ranges.items.length - 1\n        });\n      }\n    }\n\n    const baseColor = Object.entries(colorCounts).reduce((a, b) => a[1] > b[1] ? a : b)[0];\n    const baseFont = Object.entries(fontCounts).reduce((a, b) => a[1] > b[1] ? a : b)[0];\n    const baseSize = Object.entries(sizeCounts).reduce((a, b) => a[1] > b[1] ? a : b)[0];\n\n    displayWordsInfo(wordsInfo, baseColor, baseFont, baseSize);\n    const formattedMassive = formatSpecialWords(wordsInfo, baseColor, baseFont, baseSize);\n    console.log(formattedMassive);\n  });\n}\n\nfunction displayWordsInfo(wordsInfo, baseColor, baseFont, baseSize) {\n  const infoDiv = document.getElementById(\"selected-text-info\");\n  let html = \"<h3>Анализ выделенного текста:</h3>\";\n\n  wordsInfo.forEach((word, index) => {\n    html += `<h4>Слово ${index + 1}: ${word.text}</h4>`;\n    html += `<p>\n      ${word.bold ? \"✅\" : \"❌\"} Жирный${word.isFirstWord ? \" (Первое слово)\" : \"\"}<br>\n      ${word.italic ? \"✅\" : \"❌\"} Курсив${word.isSecondWord ? \" (Второе слово)\" : \"\"}<br>\n      ${word.underline ? \"✅\" : \"❌\"} Подчеркнутый<br>\n      ${word.color !== baseColor && word.color !== \"default\" ? `✅ Особый цвет: ${word.color}` : \"❌ Основной цвет\"}<br>\n      ${word.highlightColor ? `✅ Выделение: ${word.highlightColor}` : \"❌ Без выделения\"}<br>\n      ${word.hasFootnote ? `✅ Есть сноска: ${word.footnoteText}${word.isLastWord ? \" (Последнее слово)\" : \"\"}` : \"❌ Без сноски\"}<br>\n      ${word.fontName !== baseFont && word.fontName !== \"default\" ? `✅ Особый шрифт: ${word.fontName}` : `❌ Основной шрифт: ${baseFont}`}<br>\n      ${word.fontSize != baseSize && word.fontSize !== \"default\" ? `✅ Особый размер: ${word.fontSize}` : `❌ Основной размер: ${baseSize}`}<br>\n      ${word.hyperlink ? `✅ Ссылка: ${word.hyperlink}${word.isThirdWord ? \" (Третье слово)\" : \"\"}` : \"❌ Без ссылки\"}\n    </p>`;\n  });\n\n  infoDiv.innerHTML = html;\n}\n\nasync function repeatStyles() {\n  await Word.run(async (context) => {\n    const selection = context.document.getSelection();\n    selection.load(\"text\");\n    await context.sync();\n\n    const originalText = selection.text;\n    let wordsInfo = await getWordsInfo(context, selection);\n\n    const baseFormatting = getBaseFormatting(wordsInfo);\n    wordsInfo = optimizeWordsInfo(wordsInfo, baseFormatting);\n    wordsInfo = wordsInfo.filter(wordInfo => Object.keys(wordInfo).length > 1);\n\n    console.log(wordsInfo);\n    console.log(\"Base formatting:\", baseFormatting);\n\n    selection.clear();\n    await context.sync();\n\n    const words = originalText.split(/\\s+/);\n    let wordIndex = 0;\n\n    for (let i = 0; i < words.length; i++) {\n      let word = words[i];\n\n      // if (word == \"\u0002\") {\n      //   word = \" \"\n      // }\n\n      let range = selection.insertText(word, Word.InsertLocation.end);\n\n      // Применяем базовое форматирование\n      range.font.bold = baseFormatting.bold;\n      range.font.italic = baseFormatting.italic;\n      range.font.color = baseFormatting.color;\n      range.font.highlightColor = baseFormatting.highlightColor;\n      range.font.size = baseFormatting.size;\n\n      if (wordIndex < wordsInfo.length && wordsInfo[wordIndex].text === word) {\n        const wordInfo = wordsInfo[wordIndex];\n\n        if (wordInfo.bold !== undefined) range.font.bold = wordInfo.bold;\n        if (wordInfo.italic !== undefined) range.font.italic = wordInfo.italic;\n        if (wordInfo.color) range.font.color = wordInfo.color;\n        if (wordInfo.highlightColor) range.font.highlightColor = wordInfo.highlightColor;\n        if (wordInfo.size) range.font.size = wordInfo.size;\n\n        if (wordInfo.hyperlink) {\n          range.hyperlink = wordInfo.hyperlink;\n        }\n\n        if (wordInfo.footnoteText) {\n          let newFootnote = range.insertFootnote(wordInfo.footnoteText.replace(\"\u0002\", ' '), Word.InsertLocation.start);\n          // newFootnote.body.insertText(wordInfo.footnoteText.replace(\"\u0002\", ''), Word.InsertLocation.start);\n          word = word.replace(\"\u0002\", ' ');\n        }\n\n\n\n        wordIndex++;\n      }\n\n      if (i < words.length - 1) {\n        selection.insertText(\" \", Word.InsertLocation.end);\n      }\n\n      await context.sync();\n    }\n  });\n}\n\nfunction getBaseFormatting(wordsInfo) {\n  return {\n    bold: getMostCommonValue(wordsInfo, 'bold'),\n    italic: getMostCommonValue(wordsInfo, 'italic'),\n    color: getMostCommonValue(wordsInfo, 'color'),\n    highlightColor: getMostCommonValue(wordsInfo, 'highlightColor'),\n    size: getMostCommonValue(wordsInfo, 'size')\n  };\n}\n\nfunction optimizeWordsInfo(wordsInfo, baseFormatting) {\n  return wordsInfo.map(word => {\n    const optimizedWord = { text: word.text };\n\n    if (word.bold !== baseFormatting.bold) optimizedWord.bold = word.bold;\n    if (word.italic !== baseFormatting.italic) optimizedWord.italic = word.italic;\n    if (word.color !== baseFormatting.color) optimizedWord.color = word.color;\n    if (word.highlightColor !== baseFormatting.highlightColor) optimizedWord.highlightColor = word.highlightColor;\n    if (word.size !== baseFormatting.size) optimizedWord.size = word.size;\n\n    if (word.hasFootnote) optimizedWord.footnoteText = word.footnoteText;\n    if (word.hyperlink) optimizedWord.hyperlink = word.hyperlink;\n\n    return optimizedWord;\n  });\n}\n\n\n\n\nasync function getWordsInfo(context, selection) {\n  const ranges = selection.getTextRanges([\" \"], false);\n  ranges.load(\"items\");\n  await context.sync();\n\n  let wordsInfo = [];\n\n  for (let range of ranges.items) {\n    range.load(\"text, hyperlink\");\n    range.font.load(\"bold, italic, color, highlightColor, size\");\n    const footnotes = range.footnotes;\n    footnotes.load(\"items\");\n\n    await context.sync();\n\n    if (range.text.trim()) {\n      let footnoteText = \"\";\n      if (footnotes.items.length > 0) {\n        const footnote = footnotes.items[0];\n        footnote.body.load(\"text\");\n        await context.sync();\n        footnoteText = footnote.body.text;\n      }\n\n      wordsInfo.push({\n        text: range.text.trim(),\n        bold: range.font.bold,\n        italic: range.font.italic,\n        color: range.font.color || \"black\",\n        highlightColor: range.font.highlightColor || \"white\",\n        size: range.font.size || \"11\",\n        hasFootnote: footnotes.items.length > 0,\n        footnoteText: footnoteText,\n        hyperlink: range.hyperlink ? range.hyperlink : null\n      });\n    }\n  }\n\n  return wordsInfo;\n}\n\n\nfunction getMostCommonValue(array, property) {\n  const counts = {};\n  let maxCount = 0;\n  let mostCommonValue;\n\n  array.forEach(item => {\n    const value = item[property];\n    counts[value] = (counts[value] || 0) + 1;\n    if (counts[value] > maxCount) {\n      maxCount = counts[value];\n      mostCommonValue = value;\n    }\n  });\n\n  return mostCommonValue;\n}\n\n\n\n\n\n function initPrompts() {\n    const promptsTab = document.getElementById('prompts');\n    promptsTab.innerHTML = `\n        <div class=\"mt-3\">\n            <input type=\"text\" id=\"prompt-name\" class=\"form-control\" placeholder=\"Название промпта\">\n            <select id=\"prompt-model\" class=\"form-select mt-2\"></select>\n            <textarea id=\"prompt-text\" class=\"form-control mt-2\" rows=\"5\" placeholder=\"Текст промпта\"></textarea>\n            <button id=\"save-prompt\" class=\"btn btn-primary mt-2\">Сохранить промпт</button>\n        </div>\n        <div id=\"prompt-list\" class=\"mt-3\"></div>\n    `;\n\n    $('#prompt-model').select2({\n        width: '100%',\n        placeholder: 'Выберите модель',\n    }).on('select2:opening', function() {\n        setTimeout(() => {\n            $('.select2-search__field').get(0).focus();\n        }, 0);\n    });\n\n    document.getElementById(\"save-prompt\").onclick = savePrompt;\n    updatePromptList();\n    populateModelSelect();\n}\n\nfunction populateModelSelect() {\n    const select = $('#prompt-model');\n    const models = JSON.parse(localStorage.getItem('models') || '[]');\n    models.forEach(model => {\n        const option = new Option(model.name, model.id, false, false);\n        select.append(option);\n    });\n    select.trigger('change');\n}\n\nfunction savePrompt() {\n    const name = document.getElementById('prompt-name').value;\n    const model = $('#prompt-model').val();\n    const text = document.getElementById('prompt-text').value;\n    if (name && model && text) {\n        const prompts = getPrompts();\n        prompts.push({ name, model, text });\n        savePrompts(prompts);\n        updatePromptList();\n        updatePromptSelect();\n        document.getElementById('prompt-name').value = '';\n        $('#prompt-model').val(null).trigger('change');\n        document.getElementById('prompt-text').value = '';\n    }\n}\n\nfunction updatePromptList() {\n    const list = document.getElementById('prompt-list');\n    const prompts = getPrompts();\n    list.innerHTML = '';\n    prompts.forEach((prompt, index) => {\n        const div = document.createElement('div');\n        div.className = 'mt-2';\n        div.innerHTML = `\n            <strong>${prompt.name}</strong> (${prompt.model})\n            <button class=\"btn btn-sm btn-primary edit-prompt\" data-index=\"${index}\">Редактировать</button>\n            <button class=\"btn btn-sm btn-info duplicate-prompt\" data-index=\"${index}\">Дубликат</button>\n            <button class=\"btn btn-sm btn-danger delete-prompt\" data-index=\"${index}\">Удалить</button>\n        `;\n        list.appendChild(div);\n    });\n\n    list.querySelectorAll('.delete-prompt').forEach(button => {\n        button.onclick = () => deletePrompt(button.dataset.index);\n    });\n\n    list.querySelectorAll('.edit-prompt').forEach(button => {\n        button.onclick = () => editPrompt(button.dataset.index);\n    });\n\n    list.querySelectorAll('.duplicate-prompt').forEach(button => {\n        button.onclick = () => duplicatePrompt(button.dataset.index);\n    });\n}\n\nfunction deletePrompt(index) {\n    const prompts = getPrompts();\n    prompts.splice(index, 1);\n    savePrompts(prompts);\n    updatePromptList();\n    updatePromptSelect();\n}\n\nfunction editPrompt(index) {\n    const prompts = getPrompts();\n    const prompt = prompts[index];\n    document.getElementById('prompt-name').value = prompt.name;\n    $('#prompt-model').val(prompt.model).trigger('change');\n    document.getElementById('prompt-text').value = prompt.text;\n    document.getElementById('save-prompt').textContent = 'Обновить промпт';\n    document.getElementById('save-prompt').onclick = () => {\n        updatePrompt(index);\n        document.getElementById('save-prompt').textContent = 'Сохранить промпт';\n        document.getElementById('save-prompt').onclick = savePrompt;\n    };\n}\n\nfunction updatePrompt(index) {\n    const name = document.getElementById('prompt-name').value;\n    const model = $('#prompt-model').val();\n    const text = document.getElementById('prompt-text').value;\n    if (name && model && text) {\n        const prompts = getPrompts();\n        prompts[index] = { name, model, text };\n        savePrompts(prompts);\n        updatePromptList();\n        updatePromptSelect();\n        document.getElementById('prompt-name').value = '';\n        $('#prompt-model').val(null).trigger('change');\n        document.getElementById('prompt-text').value = '';\n    }\n}\n\nfunction duplicatePrompt(index) {\n    const prompts = getPrompts();\n    const prompt = prompts[index];\n    document.getElementById('prompt-name').value = prompt.name + ' (копия)';\n    $('#prompt-model').val(null).trigger('change');\n    document.getElementById('prompt-text').value = prompt.text;\n    document.getElementById('save-prompt').textContent = 'Сохранить промпт';\n    document.getElementById('save-prompt').onclick = savePrompt;\n}\n\n function initGrammar() {\n    const grammarTab = document.getElementById('grammar');\n    grammarTab.innerHTML = `\n        <div class=\"mt-3\">\n            <!-- Инструкция по использованию -->\n            <div class=\"alert alert-info\">\n                <strong>Инструкция:</strong>\n                <ul>\n                    <li>В основных настройках выберите модель и тип проверок, которые вы хотите применить к тексту.</li>\n                    <li>Выделите текст, который хотите проверить (от 1 до 4 абзацев).</li>\n                    <li>Нажмите кнопку \"Проверить\".</li>\n                </ul>\n            </div>\n            <!-- Настройки -->\n            <div class=\"accordion\" id=\"mainAccordion\">\n                <!-- Основные настройки -->\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"settingsHeading\">\n                        <h2 class=\"mb-0\">\n                            <button class=\"btn btn-link\" type=\"button\" data-toggle=\"collapse\" data-target=\"#settingsCollapse\" aria-expanded=\"true\" aria-controls=\"settingsCollapse\">\n                                Основные настройки\n                            </button>\n                        </h2>\n                    </div>\n                    <div id=\"settingsCollapse\" class=\"collapse show\" aria-labelledby=\"settingsHeading\" data-parent=\"#mainAccordion\">\n                        <div class=\"card-body\">\n                            <!-- Модель для проверки -->\n                            <div class=\"form-group\">\n                                <label for=\"grammar-model\">Модель для проверки:</label>\n                                <select id=\"grammar-model\" class=\"form-control\" title=\"Выберите модель нейросети для проверки текста\"></select>\n                            </div>\n                            <!-- Типы проверок -->\n                            <div class=\"form-group\">\n                                <label>Типы проверок:</label>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"check-grammatical\">\n                                    <label class=\"form-check-label\" for=\"check-grammatical\" title=\"Проверка на грамматические ошибки\">\n                                        Грамматические (Beta)\n                                    </label>\n                                </div>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"check-syntactic\">\n                                    <label class=\"form-check-label\" for=\"check-syntactic\" title=\"Проверка на синтаксические ошибки\">\n                                        Синтаксические (Beta)\n                                    </label>\n                                </div>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"check-stylistic\" checked>\n                                    <label class=\"form-check-label\" for=\"check-stylistic\" title=\"Проверка на стилистические ошибки\">\n                                        Стилистические\n                                    </label>\n                                </div>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"check-logical\" checked>\n                                    <label class=\"form-check-label\" for=\"check-logical\" title=\"Проверка на логические ошибки\">\n                                        Логические\n                                    </label>\n                                </div>\n                            </div>\n                            <!-- Дополнительные опции -->\n                            <div class=\"form-group\">\n                                <label>Дополнительные опции:</label>\n                                <div class=\"form-check\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"highlight-checkbox\" checked>\n                                    <label class=\"form-check-label\" for=\"highlight-checkbox\" title=\"Выделить проблемный текст в документе\">\n                                        Выделять проблемный текст\n                                    </label>\n                                </div>\n                                <div class=\"form-check mt-2\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"comment-checkbox\">\n                                    <label class=\"form-check-label\" for=\"comment-checkbox\" title=\"Добавить комментарии к проблемному тексту\">\n                                        Добавлять комментарии к проблемному тексту\n                                    </label>\n                                </div>\n                                <!-- Опция изменения цвета исправленного текста -->\n                                <div class=\"form-check mt-2\">\n                                    <input class=\"form-check-input\" type=\"checkbox\" id=\"highlight-corrected-checkbox\" checked>\n                                    <label class=\"form-check-label\" for=\"highlight-corrected-checkbox\" title=\"Изменять цвет исправленного текста\">\n                                        Изменять цвет исправленного текста\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- Дополнительные настройки -->\n                <div class=\"card\">\n                    <div class=\"card-header\" id=\"advancedSettingsHeading\">\n                        <h2 class=\"mb-0\">\n                            <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#advancedSettingsCollapse\" aria-expanded=\"false\" aria-controls=\"advancedSettingsCollapse\">\n                                Продвинутые настройки\n                            </button>\n                        </h2>\n                    </div>\n                    <div id=\"advancedSettingsCollapse\" class=\"collapse\" aria-labelledby=\"advancedSettingsHeading\" data-parent=\"#mainAccordion\">\n                        <div class=\"card-body\">\n                            <!-- Подаккордеон для категорий настроек -->\n                            <div class=\"accordion\" id=\"advancedSettingsSubAccordion\">\n                                <!-- Настройки обработки текста -->\n                                <div class=\"card\">\n                                    <div class=\"card-header\" id=\"textProcessingSettingsHeading\">\n                                        <h2 class=\"mb-0\">\n                                            <button class=\"btn btn-link\" type=\"button\" data-toggle=\"collapse\" data-target=\"#textProcessingSettingsCollapse\" aria-expanded=\"true\" aria-controls=\"textProcessingSettingsCollapse\">\n                                                Настройки обработки текста\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id=\"textProcessingSettingsCollapse\" class=\"collapse show\" aria-labelledby=\"textProcessingSettingsHeading\" data-parent=\"#advancedSettingsSubAccordion\">\n                                        <div class=\"card-body\">\n                                            <!-- Максимальное количество символов -->\n                                            <div class=\"form-group\">\n                                                <label for=\"max-chars\">Максимальное количество символов для проверки (0 для без лимита):</label>\n                                                <input type=\"number\" id=\"max-chars\" class=\"form-control\" value=\"2000\" min=\"0\">\n                                            </div>\n                                            <!-- Опция разбивать текст на чанки -->\n                                            <div class=\"form-check mt-2\">\n                                                <input class=\"form-check-input\" type=\"checkbox\" id=\"split-into-chunks-checkbox\">\n                                                <label class=\"form-check-label\" for=\"split-into-chunks-checkbox\">\n                                                    Разбивать текст на чанки\n                                                </label>\n                                            </div>\n                                            <!-- Размер чанка -->\n                                            <div class=\"form-group mt-2\">\n                                                <label for=\"chunk-size\">Размер чанка (в предложениях):</label>\n                                                <input type=\"number\" id=\"chunk-size\" class=\"form-control\" value=\"8\" min=\"1\">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <!-- Настройки модели -->\n                                <div class=\"card\">\n                                    <div class=\"card-header\" id=\"modelSettingsHeading\">\n                                        <h2 class=\"mb-0\">\n                                            <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#modelSettingsCollapse\" aria-expanded=\"false\" aria-controls=\"modelSettingsCollapse\">\n                                                Настройки модели\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id=\"modelSettingsCollapse\" class=\"collapse\" aria-labelledby=\"modelSettingsHeading\" data-parent=\"#advancedSettingsSubAccordion\">\n                                        <div class=\"card-body\">\n                                            <!-- Температура -->\n                                            <div class=\"form-group\">\n                                                <label for=\"temperature\">Температура (0.0 - 1.0):</label>\n                                                <input type=\"number\" id=\"temperature\" class=\"form-control\" value=\"0.1\" min=\"0.0\" max=\"1.0\" step=\"0.1\">\n                                            </div>\n                                            <!-- Максимальное количество токенов -->\n                                            <div class=\"form-group\">\n                                                <label for=\"max-tokens\">Максимальное количество токенов:</label>\n                                                <input type=\"number\" id=\"max-tokens\" class=\"form-control\" value=\"4000\" min=\"1\">\n                                            </div>\n                                            <!-- Опция включения response_format -->\n                                            <div class=\"form-check mt-2\">\n                                                <input class=\"form-check-input\" type=\"checkbox\" id=\"response-format-checkbox\">\n                                                <label class=\"form-check-label\" for=\"response-format-checkbox\">\n                                                    Использовать response_format: {\"type\": \"json_object\"}\n                                                </label>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <!-- Настройки ошибок -->\n                                <div class=\"card\">\n                                    <div class=\"card-header\" id=\"errorSettingsHeading\">\n                                        <h2 class=\"mb-0\">\n                                            <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#errorSettingsCollapse\" aria-expanded=\"false\" aria-controls=\"errorSettingsCollapse\">\n                                                Настройки ошибок\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id=\"errorSettingsCollapse\" class=\"collapse\" aria-labelledby=\"errorSettingsHeading\" data-parent=\"#advancedSettingsSubAccordion\">\n                                        <div class=\"card-body\">\n                                            <!-- Повторить в случае ошибки -->\n                                            <div class=\"form-check mt-2\">\n                                                <input class=\"form-check-input\" type=\"checkbox\" id=\"retry-on-error-checkbox\" checked>\n                                                <label class=\"form-check-label\" for=\"retry-on-error-checkbox\">\n                                                    Повторить в случае ошибки\n                                                </label>\n                                            </div>\n                                            <!-- Количество повторов -->\n                                            <div class=\"form-group mt-2\">\n                                                <label for=\"retry-count\">Количество повторов при ошибке:</label>\n                                                <input type=\"number\" id=\"retry-count\" class=\"form-control\" value=\"3\" min=\"1\">\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <!-- Настройки промптов -->\n                                <div class=\"card\">\n                                    <div class=\"card-header\" id=\"promptSettingsHeading\">\n                                        <h2 class=\"mb-0\">\n                                            <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#promptSettingsCollapse\" aria-expanded=\"false\" aria-controls=\"promptSettingsCollapse\">\n                                                Настройки промптов\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id=\"promptSettingsCollapse\" class=\"collapse\" aria-labelledby=\"promptSettingsHeading\" data-parent=\"#advancedSettingsSubAccordion\">\n                                        <div class=\"card-body\">\n                                            <!-- Опция редактирования промптов -->\n                                            <div class=\"form-check mt-3\">\n                                                <input class=\"form-check-input\" type=\"checkbox\" id=\"edit-prompts-checkbox\" checked>\n                                                <label class=\"form-check-label\" for=\"edit-prompts-checkbox\">\n                                                    Редактировать системные промпты\n                                                </label>\n                                            </div>\n                                            <!-- Аккордеон для редактирования промптов -->\n                                            <div id=\"prompts-accordion\" class=\"mt-3\">\n                                                <div class=\"accordion\" id=\"promptsAccordion\">\n                                                    <!-- Промпт роли -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingRolePrompt\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseRolePrompt\" aria-expanded=\"true\" aria-controls=\"collapseRolePrompt\">\n                                                                    Промпт роли\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseRolePrompt\" class=\"collapse\" aria-labelledby=\"headingRolePrompt\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-role\" class=\"form-control\" rows=\"3\" placeholder=\"Например: Ты - опытный редактор и лингвист.\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <!-- Грамматические ошибки -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingGrammar\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseGrammar\" aria-expanded=\"false\" aria-controls=\"collapseGrammar\">\n                                                                    Грамматические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseGrammar\" class=\"collapse\" aria-labelledby=\"headingGrammar\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-grammatical\" class=\"form-control\" rows=\"5\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <!-- Синтаксические ошибки -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingSyntactic\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseSyntactic\" aria-expanded=\"false\" aria-controls=\"collapseSyntactic\">\n                                                                    Синтаксические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseSyntactic\" class=\"collapse\" aria-labelledby=\"headingSyntactic\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-syntactic\" class=\"form-control\" rows=\"5\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <!-- Стилистические ошибки -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingStylistic\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseStylistic\" aria-expanded=\"false\" aria-controls=\"collapseStylistic\">\n                                                                    Стилистические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseStylistic\" class=\"collapse\" aria-labelledby=\"headingStylistic\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-stylistic\" class=\"form-control\" rows=\"5\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <!-- Логические ошибки -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingLogical\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseLogical\" aria-expanded=\"false\" aria-controls=\"collapseLogical\">\n                                                                    Логические ошибки\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseLogical\" class=\"collapse\" aria-labelledby=\"headingLogical\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-logical\" class=\"form-control\" rows=\"5\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                    <!-- Примечание о проверяемом тексте -->\n                                                    <div class=\"card\">\n                                                        <div class=\"card-header\" id=\"headingTextNote\">\n                                                            <h2 class=\"mb-0\">\n                                                                <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#collapseTextNote\" aria-expanded=\"false\" aria-controls=\"collapseTextNote\">\n                                                                    Примечание о проверяемом тексте\n                                                                </button>\n                                                            </h2>\n                                                        </div>\n                                                        <div id=\"collapseTextNote\" class=\"collapse\" aria-labelledby=\"headingTextNote\" data-parent=\"#promptsAccordion\">\n                                                            <div class=\"card-body\">\n                                                                <textarea id=\"prompt-text-note\" class=\"form-control\" rows=\"3\" placeholder=\"Например: Текст является научной статьей по физике.\"></textarea>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                                <!-- Кнопка сброса промптов -->\n                                                <button id=\"reset-prompts\" class=\"btn btn-secondary mt-3\">Сбросить промпты</button>\n                                                <div id=\"prompt-message\" class=\"mt-2\"></div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <!-- Пресеты -->\n                                <div class=\"card\">\n                                    <div class=\"card-header\" id=\"presetSettingsHeading\">\n                                        <h2 class=\"mb-0\">\n                                            <button class=\"btn btn-link collapsed\" type=\"button\" data-toggle=\"collapse\" data-target=\"#presetSettingsCollapse\" aria-expanded=\"false\" aria-controls=\"presetSettingsCollapse\">\n                                                Пресеты\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id=\"presetSettingsCollapse\" class=\"collapse\" aria-labelledby=\"presetSettingsHeading\" data-parent=\"#advancedSettingsSubAccordion\">\n                                        <div class=\"card-body\">\n                                            <!-- Выбор пресета -->\n                                            <div class=\"form-group\">\n                                                <label for=\"preset-select\">Выберите пресет:</label>\n                                                <select id=\"preset-select\" class=\"form-control\"></select>\n                                            </div>\n                                            <!-- Имя пресета для сохранения -->\n                                            <div class=\"form-group\">\n                                                <label for=\"preset-name\">Название пресета для сохранения:</label>\n                                                <input type=\"text\" id=\"preset-name\" class=\"form-control\" placeholder=\"Введите название пресета\">\n                                            </div>\n                                            <!-- Кнопки для управления пресетами -->\n                                            <div class=\"form-group mt-3\">\n                                                <button id=\"save-preset\" class=\"btn btn-primary\">Сохранить текущие настройки как пресет</button>\n                                                <button id=\"delete-preset\" class=\"btn btn-danger\">Удалить выбранный пресет</button>\n                                            </div>\n                                            <!-- Экспорт и импорт пресета -->\n                                            <div class=\"form-group mt-3\">\n                                                <ul class=\"nav nav-tabs\" id=\"presetTab\" role=\"tablist\">\n                                                    <li class=\"nav-item\">\n                                                        <a class=\"nav-link active\" id=\"-tab\" data-toggle=\"tab\" href=\"#\" role=\"tab\" aria-controls=\"\" aria-selected=\"true\">Экспорт</a>\n                                                    </li>\n                                                    <li class=\"nav-item\">\n                                                        <a class=\"nav-link\" id=\"import-tab\" data-toggle=\"tab\" href=\"#import\" role=\"tab\" aria-controls=\"import\" aria-selected=\"false\">Импорт</a>\n                                                    </li>\n                                                </ul>\n                                                <div class=\"tab-content\" id=\"presetTabContent\">\n                                                    <div class=\"tab-pane fade show active\" id=\"\" role=\"tabpanel\" aria-labelledby=\"-tab\">\n                                                        <label for=\"preset-json\">Экспорт пресета (JSON):</label>\n                                                        <textarea id=\"preset-json\" class=\"form-control\" rows=\"5\" readonly></textarea>\n                                                        <button id=\"copy-preset-json\" class=\"btn btn-secondary mt-2\">Скопировать JSON</button>\n                                                    </div>\n                                                    <div class=\"tab-pane fade\" id=\"import\" role=\"tabpanel\" aria-labelledby=\"import-tab\">\n                                                        <label for=\"preset-json-import\">Импорт пресета (JSON):</label>\n                                                        <textarea id=\"preset-json-import\" class=\"form-control\" rows=\"5\"></textarea>\n                                                        <button id=\"import-preset\" class=\"btn btn-secondary mt-2\">Импортировать пресет</button>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                            <!-- Сообщения о действиях с пресетами -->\n                                            <div id=\"preset-message\" class=\"mt-2\"></div>\n                                            <!-- Сообщения и подтверждения -->\n                                            <div id=\"preset-confirmation\" class=\"mt-2\" style=\"display:none;\">\n                                                <div class=\"alert alert-warning\">\n                                                    <p id=\"preset-confirmation-message\"></p>\n                                                    <button id=\"preset-confirm-yes\" class=\"btn btn-danger\">Да</button>\n                                                    <button id=\"preset-confirm-no\" class=\"btn btn-secondary\">Нет</button>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                                <!-- Кнопка сброса настроек -->\n                                <button id=\"reset-settings\" class=\"btn btn-secondary mt-3\">Сбросить настройки</button>\n                                <div id=\"reset-message\" class=\"mt-2\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <!-- Кнопка Проверить -->\n            <button id=\"check-grammar\" class=\"btn btn-primary mt-3\">Проверить</button>\n            <!-- Message area -->\n            <div id=\"message\" class=\"mt-3\"></div>\n            <!-- Загрузчик и кнопка Отменить -->\n            <div id=\"loading\" class=\"mt-3 text-center\" style=\"display: none;\">\n                <div id=\"progress-container\" style=\"display: none;\">\n                    <div class=\"progress\">\n                        <div id=\"progress-bar\" class=\"progress-bar\" role=\"progressbar\" style=\"width: 0%;\">0%</div>\n                    </div>\n                    <div id=\"progress-text\" class=\"mt-2\">Обработано 0 из 0 чанков</div>\n                </div>\n                <div id=\"spinner\" style=\"display: none;\">\n                    <div class=\"spinner-border text-primary\" role=\"status\">\n                        <span class=\"sr-only\">Загрузка...</span>\n                    </div>\n                </div>\n                <div class=\"mt-3\">\n                    <button id=\"cancel-check\" class=\"btn btn-secondary\">Отменить</button>\n                </div>\n            </div>\n            <!-- Фильтр результатов -->\n            <div id=\"filter-container\" class=\"mt-3\" style=\"display: none;\">\n                <label for=\"filter-select\">Фильтр результатов:</label>\n                <select id=\"filter-select\" class=\"form-control\">\n                    <option value=\"all\">Все ошибки</option>\n                    <option value=\"can_edit\">Только исправляемые</option>\n                    <option value=\"cannot_edit\">Только не исправляемые</option>\n                </select>\n            </div>\n            <div id=\"grammar-results\" class=\"mt-3\"></div>\n        </div>\n    `;\n\n    initializeGrammarModelSelect();\n    initializePresetSelectGrammar();\n\n    // Загрузка сохраненных настроек\n    loadGrammarSettings();\n    loadGrammarPrompts();\n\n    // Обработчики событий для настроек\n    document.getElementById('check-grammar').onclick = checkGrammarGrammar;\n    document.getElementById('highlight-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('comment-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('highlight-corrected-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('check-grammatical').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('check-syntactic').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('check-stylistic').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('check-logical').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('split-into-chunks-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('chunk-size').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('max-chars').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('temperature').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('max-tokens').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('response-format-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('retry-on-error-checkbox').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('retry-count').onchange = () => { saveGrammarSettings(); updatePresetJSONGrammar(); };\n    document.getElementById('edit-prompts-checkbox').onchange = () => { togglePromptsEditorGrammar(); updatePresetJSONGrammar(); };\n\n    // Обработчики для промптов\n    document.getElementById('prompt-role').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n    document.getElementById('prompt-grammatical').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n    document.getElementById('prompt-syntactic').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n    document.getElementById('prompt-stylistic').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n    document.getElementById('prompt-logical').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n    document.getElementById('prompt-text-note').addEventListener('input', () => { saveGrammarPrompts(); updatePresetJSONGrammar(); });\n\n    // Обработчик для кнопки сброса промптов\n    document.getElementById('reset-prompts').onclick = () => { resetGrammarPrompts(); updatePresetJSONGrammar(); };\n\n    // Обработчик для кнопки сброса настроек\n    document.getElementById('reset-settings').onclick = resetGrammarSettings;\n\n    // Обработчики для пресетов\n    document.getElementById('preset-select').onchange = loadSelectedPresetGrammar;\n    document.getElementById('save-preset').onclick = saveCurrentSettingsAsPresetGrammar;\n    document.getElementById('delete-preset').onclick = deleteSelectedPresetGrammar;\n    document.getElementById('copy-preset-json').onclick = copyPresetJSONGrammar;\n    document.getElementById('import-preset').onclick = importPresetFromJSONGrammar;\n\n    // Обработчик события для кнопки \"Отменить\"\n    document.getElementById('cancel-check').onclick = cancelCheckGrammar;\n\n    // Обработчик для фильтра результатов\n    document.getElementById('filter-select').onchange = () => displayResultsGrammar(window.grammarResults);\n\n    // Переменная для хранения контроллера отмены\n    window.abortController = null;\n\n    // Глабольная переменна\n    window.window.isLoadingPreset = false;\n\n    // Вызываем функцию установки обработчиков после инициализации интерфейса\n    setupSettingsChangeHandlersGrammar();\n}\n\nfunction initializeGrammarModelSelect() {\n    $('#grammar-model').select2({\n        width: '100%',\n        placeholder: 'Выберите модель для проверки',\n    }).on('select2:opening', function () {\n        setTimeout(() => {\n            $('.select2-search__field').get(0).focus();\n        }, 0);\n    }).on('change', function () {\n        const selectedModel = $(this).val();\n        localStorage.setItem('grammarModel', selectedModel);\n        updatePresetJSONGrammar();\n    });\n\n    populateGrammarModelSelect();\n}\n\nfunction populateGrammarModelSelect() {\n    const select = $('#grammar-model');\n    const models = JSON.parse(localStorage.getItem('models') || '[]');\n    console.log('Loaded models:', models); // Логирование загруженных моделей\n    select.empty();\n    let defaultModelId = null;\n    models.forEach((model, index) => {\n        const option = new Option(model.name, model.id, false, false);\n        select.append(option);\n        // Устанавливаем defaultModelId на первую модель, если оно еще не установлено\n        if (!defaultModelId) {\n            defaultModelId = model.id;\n        }\n        // Если вы хотите установить конкретную модель по умолчанию, раскомментируйте и отредактируйте следующую строку\n        if (model.id === 'anthropic/claude-3.5-sonnet:beta') {\n            defaultModelId = model.id;\n        } \n        // а\n    });\n    console.log('Default model ID:', defaultModelId); // Логирование ID модели по умолчанию\n\n    const savedModel = localStorage.getItem('grammarModel');\n    console.log('Saved model:', savedModel); // Логирование сохранённой модели\n\n    if (savedModel && models.some(model => model.id === savedModel)) {\n        select.val(savedModel).trigger('change');\n        console.log(`Selected saved model: ${savedModel}`);\n    } else if (defaultModelId) {\n        select.val(defaultModelId).trigger('change');\n        console.log(`Selected default model: ${defaultModelId}`);\n    } else {\n        console.log('No models available to select');\n    }\n}\n\n\n\nfunction initializePresetSelectGrammar() {\n    populatePresetSelectGrammar();\n\n    $('#preset-select').select2({\n        width: '100%',\n        placeholder: 'Выберите пресет',\n    }).on('select2:opening', function () {\n        setTimeout(() => {\n            $('.select2-search__field').get(0).focus();\n        }, 0);\n    });\n}\n\nfunction populatePresetSelectGrammar() {\n    const select = $('#preset-select');\n    select.empty();\n\n    // Добавляем опцию \"Текущие настройки\"\n    const currentOption = new Option('Текущие настройки', 'current', false, false);\n    select.append(currentOption);\n\n    let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n    let lastSelectedPreset = localStorage.getItem('lastSelectedPreset') || null;\n\n    presets.forEach(preset => {\n        const option = new Option(preset.name, preset.name, false, false);\n        select.append(option);\n    });\n\n    if (lastSelectedPreset && lastSelectedPreset !== 'current') {\n        select.val(lastSelectedPreset).trigger('change');\n    } else {\n        // Устанавливаем \"Текущие настройки\", если нет последнего выбранного пресета\n        select.val('current').trigger('change');\n    }\n}\n\n\n\nfunction getBooleanSettingGrammar(key, defaultValue) {\n    const value = localStorage.getItem(key);\n    if (value === null || value === undefined) {\n        return defaultValue;\n    }\n    return (value === 'true');\n}\n\nfunction getNumericSettingGrammar(key, defaultValue) {\n    const value = localStorage.getItem(key);\n    if (value === null || value === undefined) {\n        return defaultValue;\n    }\n    const num = parseFloat(value);\n    return isNaN(num) ? defaultValue : num;\n}\n\nfunction loadGrammarSettings() {\n    const lastSelectedPreset = localStorage.getItem('lastSelectedPreset');\n    if (lastSelectedPreset && lastSelectedPreset !== 'current') {\n        let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n        const preset = presets.find(p => p.name === lastSelectedPreset);\n        if (preset) {\n            $('#preset-select').val(preset.name).trigger('change');\n            loadSelectedPresetGrammar();\n            return;\n        } else {\n            localStorage.removeItem('lastSelectedPreset');\n            // Устанавливаем \"Текущие настройки\", если пресет не найден\n            $('#preset-select').val('current').trigger('change');\n        }\n    } else {\n        // Устанавливаем \"Текущие настройки\", если нет последнего выбранного пресета\n        $('#preset-select').val('current').trigger('change');\n    }\n\n    // Далее загружаем настройки из localStorage\n    const highlight = getBooleanSettingGrammar('highlightErrors', true);\n    document.getElementById('highlight-checkbox').checked = highlight;\n\n    const addComments = getBooleanSettingGrammar('addComments', false);\n    document.getElementById('comment-checkbox').checked = addComments;\n\n    const highlightCorrected = getBooleanSettingGrammar('highlightCorrected', true);\n    document.getElementById('highlight-corrected-checkbox').checked = highlightCorrected;\n\n    const checkGrammatical = getBooleanSettingGrammar('checkGrammatical', false);\n    const checkSyntactic = getBooleanSettingGrammar('checkSyntactic', false);\n    const checkStylistic = getBooleanSettingGrammar('checkStylistic', true);\n    const checkLogical = getBooleanSettingGrammar('checkLogical', true);\n\n    document.getElementById('check-grammatical').checked = checkGrammatical;\n    document.getElementById('check-syntactic').checked = checkSyntactic;\n    document.getElementById('check-stylistic').checked = checkStylistic;\n    document.getElementById('check-logical').checked = checkLogical;\n\n    const splitIntoChunks = getBooleanSettingGrammar('splitIntoChunks', false);\n    document.getElementById('split-into-chunks-checkbox').checked = splitIntoChunks;\n\n    const chunkSize = getNumericSettingGrammar('chunkSize', 8);\n    document.getElementById('chunk-size').value = chunkSize;\n\n    const maxChars = getNumericSettingGrammar('maxChars', 2000);\n    document.getElementById('max-chars').value = maxChars;\n\n    const temperature = getNumericSettingGrammar('temperature', 0.1);\n    document.getElementById('temperature').value = temperature;\n\n    const maxTokens = getNumericSettingGrammar('maxTokens', 4000);\n    document.getElementById('max-tokens').value = maxTokens;\n\n    const responseFormat = getBooleanSettingGrammar('responseFormat', false);\n    document.getElementById('response-format-checkbox').checked = responseFormat;\n\n    const retryOnError = getBooleanSettingGrammar('retryOnError', true);\n    document.getElementById('retry-on-error-checkbox').checked = retryOnError;\n\n    const retryCount = getNumericSettingGrammar('retryCount', 3);\n    document.getElementById('retry-count').value = retryCount;\n\n    const editPrompts = getBooleanSettingGrammar('editPrompts', true);\n    document.getElementById('edit-prompts-checkbox').checked = editPrompts;\n    togglePromptsEditorGrammar();\n}\n\n\nfunction saveGrammarSettings() {\n    const highlight = document.getElementById('highlight-checkbox').checked;\n    localStorage.setItem('highlightErrors', highlight);\n\n    const addComments = document.getElementById('comment-checkbox').checked;\n    localStorage.setItem('addComments', addComments);\n\n    const highlightCorrected = document.getElementById('highlight-corrected-checkbox').checked;\n    localStorage.setItem('highlightCorrected', highlightCorrected);\n\n    const checkGrammatical = document.getElementById('check-grammatical').checked;\n    const checkSyntactic = document.getElementById('check-syntactic').checked;\n    const checkStylistic = document.getElementById('check-stylistic').checked;\n    const checkLogical = document.getElementById('check-logical').checked;\n\n    localStorage.setItem('checkGrammatical', checkGrammatical);\n    localStorage.setItem('checkSyntactic', checkSyntactic);\n    localStorage.setItem('checkStylistic', checkStylistic);\n    localStorage.setItem('checkLogical', checkLogical);\n\n    const splitIntoChunks = document.getElementById('split-into-chunks-checkbox').checked;\n    localStorage.setItem('splitIntoChunks', splitIntoChunks);\n\n    const chunkSize = document.getElementById('chunk-size').value;\n    localStorage.setItem('chunkSize', chunkSize);\n\n    const maxChars = document.getElementById('max-chars').value;\n    localStorage.setItem('maxChars', maxChars);\n\n    const temperature = parseFloat(document.getElementById('temperature').value);\n    localStorage.setItem('temperature', temperature);\n\n    const maxTokens = parseInt(document.getElementById('max-tokens').value, 10);\n    localStorage.setItem('maxTokens', maxTokens);\n\n    const responseFormat = document.getElementById('response-format-checkbox').checked;\n    localStorage.setItem('responseFormat', responseFormat);\n\n    const retryOnError = document.getElementById('retry-on-error-checkbox').checked;\n    localStorage.setItem('retryOnError', retryOnError);\n\n    const retryCount = parseInt(document.getElementById('retry-count').value, 10);\n    localStorage.setItem('retryCount', retryCount);\n\n    const editPrompts = document.getElementById('edit-prompts-checkbox').checked;\n    localStorage.setItem('editPrompts', editPrompts);\n    togglePromptsEditorGrammar();\n}\n\nfunction resetGrammarSettings() {\n    // Очистка настроек из localStorage\n    localStorage.removeItem('highlightErrors');\n    localStorage.removeItem('addComments');\n    localStorage.removeItem('highlightCorrected');\n    localStorage.removeItem('checkGrammatical');\n    localStorage.removeItem('checkSyntactic');\n    localStorage.removeItem('checkStylistic');\n    localStorage.removeItem('checkLogical');\n    localStorage.removeItem('splitIntoChunks');\n    localStorage.removeItem('chunkSize');\n    localStorage.removeItem('maxChars');\n    localStorage.removeItem('temperature');\n    localStorage.removeItem('maxTokens');\n    localStorage.removeItem('responseFormat');\n    localStorage.removeItem('retryOnError');\n    localStorage.removeItem('retryCount');\n    localStorage.removeItem('editPrompts');\n    localStorage.removeItem('promptRole');\n    localStorage.removeItem('promptGrammatical');\n    localStorage.removeItem('promptSyntactic');\n    localStorage.removeItem('promptStylistic');\n    localStorage.removeItem('promptLogical');\n    localStorage.removeItem('promptTextNote');\n    localStorage.removeItem('grammarModel');\n    localStorage.removeItem('lastSelectedPreset');\n\n    // Очищаем выбор пресета\n    $('#preset-select').val(null).trigger('change');\n\n    // Перезагрузка настроек и промптов\n    loadGrammarSettings();\n    loadGrammarPrompts();\n\n    // Обновляем селектор модели после сброса\n    populateGrammarModelSelect();\n\n    // Очищаем JSON текстовое поле\n    document.getElementById('preset-json').value = '';\n\n    // Отображение сообщения об успешном сбросе настроек\n    displayResetMessageGrammar('Настройки сброшены к значениям по умолчанию.');\n}\n\n\nfunction displayResetMessageGrammar(message) {\n    const messageDiv = document.getElementById('reset-message');\n    messageDiv.innerHTML = `<div class=\"alert alert-info\">${message}</div>`;\n    setTimeout(() => {\n        messageDiv.innerHTML = '';\n    }, 3000);\n}\n\nfunction togglePromptsEditorGrammar() {\n    const editPrompts = document.getElementById('edit-prompts-checkbox').checked;\n    const promptsAccordion = document.getElementById('prompts-accordion');\n    promptsAccordion.style.display = editPrompts ? 'block' : 'none';\n}\n\nfunction loadGrammarPrompts() {\n    const defaultPrompts = getDefaultPromptsGrammar();\n\n    const promptRole = localStorage.getItem('promptRole') || defaultPrompts['role'];\n    const promptGrammatical = localStorage.getItem('promptGrammatical') || defaultPrompts['грамматическая'];\n    const promptSyntactic = localStorage.getItem('promptSyntactic') || defaultPrompts['синтаксическая'];\n    const promptStylistic = localStorage.getItem('promptStylistic') || defaultPrompts['стилистическая'];\n    const promptLogical = localStorage.getItem('promptLogical') || defaultPrompts['логическая'];\n    const promptTextNote = localStorage.getItem('promptTextNote') || '';\n\n    document.getElementById('prompt-role').value = promptRole;\n    document.getElementById('prompt-grammatical').value = promptGrammatical;\n    document.getElementById('prompt-syntactic').value = promptSyntactic;\n    document.getElementById('prompt-stylistic').value = promptStylistic;\n    document.getElementById('prompt-logical').value = promptLogical;\n    document.getElementById('prompt-text-note').value = promptTextNote;\n}\n\nfunction saveGrammarPrompts() {\n    const promptRole = document.getElementById('prompt-role').value;\n    const promptGrammatical = document.getElementById('prompt-grammatical').value;\n    const promptSyntactic = document.getElementById('prompt-syntactic').value;\n    const promptStylistic = document.getElementById('prompt-stylistic').value;\n    const promptLogical = document.getElementById('prompt-logical').value;\n    const promptTextNote = document.getElementById('prompt-text-note').value;\n\n    localStorage.setItem('promptRole', promptRole);\n    localStorage.setItem('promptGrammatical', promptGrammatical);\n    localStorage.setItem('promptSyntactic', promptSyntactic);\n    localStorage.setItem('promptStylistic', promptStylistic);\n    localStorage.setItem('promptLogical', promptLogical);\n    localStorage.setItem('promptTextNote', promptTextNote);\n\n    // Отображаем сообщение об успешном сохранении\n    displayPromptMessageGrammar('Промпты сохранены и будут применены при следующей проверке.');\n}\n\nfunction resetGrammarPrompts() {\n    const defaultPrompts = getDefaultPromptsGrammar();\n    document.getElementById('prompt-role').value = defaultPrompts['role'];\n    document.getElementById('prompt-grammatical').value = defaultPrompts['грамматическая'];\n    document.getElementById('prompt-syntactic').value = defaultPrompts['синтаксическая'];\n    document.getElementById('prompt-stylistic').value = defaultPrompts['стилистическая'];\n    document.getElementById('prompt-logical').value = defaultPrompts['логическая'];\n    document.getElementById('prompt-text-note').value = '';\n\n    saveGrammarPrompts();\n\n    // Отображаем сообщение об успешном сбросе\n    displayPromptMessageGrammar('Промпты сброшены к значениям по умолчанию.');\n}\n\nfunction displayPromptMessageGrammar(message) {\n    const messageDiv = document.getElementById('prompt-message');\n    messageDiv.innerHTML = `<div class=\"alert alert-info\">${message}</div>`;\n    setTimeout(() => {\n        messageDiv.innerHTML = '';\n    }, 3000);\n}\n\nfunction getCurrentSettingsGrammar() {\n    return {\n        highlightErrors: document.getElementById('highlight-checkbox').checked,\n        addComments: document.getElementById('comment-checkbox').checked,\n        highlightCorrected: document.getElementById('highlight-corrected-checkbox').checked,\n        checkGrammatical: document.getElementById('check-grammatical').checked,\n        checkSyntactic: document.getElementById('check-syntactic').checked,\n        checkStylistic: document.getElementById('check-stylistic').checked,\n        checkLogical: document.getElementById('check-logical').checked,\n        splitIntoChunks: document.getElementById('split-into-chunks-checkbox').checked,\n        chunkSize: document.getElementById('chunk-size').value,\n        maxChars: document.getElementById('max-chars').value,\n        temperature: document.getElementById('temperature').value,\n        maxTokens: document.getElementById('max-tokens').value,\n        responseFormat: document.getElementById('response-format-checkbox').checked,\n        retryOnError: document.getElementById('retry-on-error-checkbox').checked,\n        retryCount: document.getElementById('retry-count').value,\n        editPrompts: document.getElementById('edit-prompts-checkbox').checked,\n        grammarModel: $('#grammar-model').val(),\n    };\n}\n\nfunction getCurrentPromptsGrammar() {\n    return {\n        promptRole: document.getElementById('prompt-role').value,\n        promptGrammatical: document.getElementById('prompt-grammatical').value,\n        promptSyntactic: document.getElementById('prompt-syntactic').value,\n        promptStylistic: document.getElementById('prompt-stylistic').value,\n        promptLogical: document.getElementById('prompt-logical').value,\n        promptTextNote: document.getElementById('prompt-text-note').value,\n    };\n}\n\nfunction saveCurrentSettingsAsPresetGrammar() {\n    const presetNameInput = document.getElementById('preset-name');\n    const presetName = presetNameInput.value.trim();\n    if (!presetName) {\n        displayPresetMessageGrammar('Название пресета не может быть пустым.', 'danger');\n        return;\n    }\n\n    if (presetName.toLowerCase() === 'current' || presetName === 'Текущие настройки') {\n        displayPresetMessageGrammar('Название пресета не может быть \"Текущие настройки\".', 'danger');\n        return;\n    }\n\n    const preset = {\n        name: presetName,\n        settings: getCurrentSettingsGrammar(),\n        prompts: getCurrentPromptsGrammar(),\n    };\n\n    let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n\n    // Проверяем, существует ли пресет с таким именем\n    const existingIndex = presets.findIndex(p => p.name === presetName);\n    if (existingIndex !== -1) {\n        // Предлагаем перезаписать существующий пресет\n        showPresetConfirmationGrammar(`Пресет с названием \"${presetName}\" уже существует. Перезаписать его?`, () => {\n            presets[existingIndex] = preset;\n            localStorage.setItem('grammarPresets', JSON.stringify(presets));\n            populatePresetSelectGrammar();\n\n            // Выбираем только что созданный пресет\n            $('#preset-select').val(preset.name).trigger('change');\n            localStorage.setItem('lastSelectedPreset', preset.name);\n\n            displayPresetMessageGrammar('Пресет сохранен.', 'success');\n\n            // Очищаем поле ввода названия пресета\n            presetNameInput.value = '';\n\n            // Обновляем JSON пресета\n            updatePresetJSONGrammar();\n        });\n    } else {\n        presets.push(preset);\n        localStorage.setItem('grammarPresets', JSON.stringify(presets));\n        populatePresetSelectGrammar();\n\n        // Выбираем только что созданный пресет\n        $('#preset-select').val(preset.name).trigger('change');\n        localStorage.setItem('lastSelectedPreset', preset.name);\n\n        displayPresetMessageGrammar('Пресет сохранен.', 'success');\n\n        // Очищаем поле ввода названия пресета\n        presetNameInput.value = '';\n\n        // Обновляем JSON пресета\n        updatePresetJSONGrammar();\n    }\n}\n\n\n\n\nfunction showPresetConfirmationGrammar(message, onConfirm) {\n    const confirmationDiv = document.getElementById('preset-confirmation');\n    const confirmationMessage = document.getElementById('preset-confirmation-message');\n    const confirmYesButton = document.getElementById('preset-confirm-yes');\n    const confirmNoButton = document.getElementById('preset-confirm-no');\n\n    confirmationMessage.textContent = message;\n    confirmationDiv.style.display = 'block';\n\n    // Удаляем предыдущие обработчики событий\n    confirmYesButton.onclick = null;\n    confirmNoButton.onclick = null;\n\n    confirmYesButton.onclick = () => {\n        confirmationDiv.style.display = 'none';\n        onConfirm();\n    };\n\n    confirmNoButton.onclick = () => {\n        confirmationDiv.style.display = 'none';\n    };\n}\n\n// ВАЖНОЕ ИЗМЕНЕНИЕ: Добавляем сброс выбора пресета при изменении настроек или промптов\n\nfunction setupSettingsChangeHandlersGrammar() {\n    // Функция для обработки изменений настроек\n    function onSettingsChange() {\n        if (window.isLoadingPreset) {\n            return;\n        }\n    \n        saveGrammarSettings();\n        saveGrammarPrompts();\n    \n        const currentSettings = getCurrentSettingsGrammar();\n        const currentPrompts = getCurrentPromptsGrammar();\n        let matchedPresetName = null;\n    \n        let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n        for (let preset of presets) {\n            if (\n                areSettingsEqual(preset.settings, currentSettings) &&\n                areSettingsEqual(preset.prompts, currentPrompts)\n            ) {\n                matchedPresetName = preset.name;\n                break;\n            }\n        }\n    \n        if (matchedPresetName) {\n            // Выбираем соответствующий пресет без вызова события 'change'\n            $('#preset-select').val(matchedPresetName).trigger('change');\n            localStorage.setItem('lastSelectedPreset', matchedPresetName);\n        } else {\n            // Устанавливаем \"Текущие настройки\", если нет соответствующего пресета\n            $('#preset-select').val('current').trigger('change'); // Добавлено .trigger('change')\n            localStorage.removeItem('lastSelectedPreset');\n        }\n    \n        // Обновляем JSON пресета\n        updatePresetJSONGrammar();\n    }\n\n    const settingsElements = [\n        'highlight-checkbox',\n        'comment-checkbox',\n        'highlight-corrected-checkbox',\n        'check-grammatical',\n        'check-syntactic',\n        'check-stylistic',\n        'check-logical',\n        'split-into-chunks-checkbox',\n        'chunk-size',\n        'max-chars',\n        'temperature',\n        'max-tokens',\n        'response-format-checkbox',\n        'retry-on-error-checkbox',\n        'retry-count',\n        'edit-prompts-checkbox',\n    ];\n\n    settingsElements.forEach(id => {\n        const element = document.getElementById(id);\n        if (element) {\n            element.addEventListener('change', onSettingsChange);\n        }\n    });\n\n    // Навешиваем обработчики на промпты\n    const promptElements = [\n        'prompt-role',\n        'prompt-grammatical',\n        'prompt-syntactic',\n        'prompt-stylistic',\n        'prompt-logical',\n        'prompt-text-note',\n    ];\n\n    promptElements.forEach(id => {\n        const element = document.getElementById(id);\n        if (element) {\n            element.addEventListener('input', onSettingsChange);\n        }\n    });\n\n    // Обработчик для модели\n    $('#grammar-model').on('change', onSettingsChange);\n\n}\n\n\nfunction areSettingsEqual(obj1, obj2) {\n    const obj1Keys = Object.keys(obj1).sort();\n    const obj2Keys = Object.keys(obj2).sort();\n\n    if (obj1Keys.length !== obj2Keys.length) {\n        return false;\n    }\n\n    for (let i = 0; i < obj1Keys.length; i++) {\n        const key = obj1Keys[i];\n        if (key !== obj2Keys[i]) {\n            return false;\n        }\n        const val1 = obj1[key];\n        const val2 = obj2[key];\n\n        if (typeof val1 === 'object' && typeof val2 === 'object') {\n            if (!areSettingsEqual(val1, val2)) {\n                return false;\n            }\n        } else if (val1 !== val2) {\n            return false;\n        }\n    }\n    return true;\n}\n\n\n\n\n\nfunction loadSelectedPresetGrammar() {\n    window.isLoadingPreset = true;\n\n    const presetName = $('#preset-select').val();\n    if (!presetName || presetName === 'current') {\n        // Если выбран \"Текущие настройки\", ничего не делаем\n        window.isLoadingPreset = false;\n        return;\n    }\n\n    let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n    const preset = presets.find(p => p.name === presetName);\n    if (!preset) {\n        window.isLoadingPreset = false;\n        return;\n    }\n\n    // Загрузка настроек из пресета\n    const settings = preset.settings;\n    document.getElementById('highlight-checkbox').checked = settings.highlightErrors;\n    document.getElementById('comment-checkbox').checked = settings.addComments;\n    document.getElementById('highlight-corrected-checkbox').checked = settings.highlightCorrected;\n    document.getElementById('check-grammatical').checked = settings.checkGrammatical;\n    document.getElementById('check-syntactic').checked = settings.checkSyntactic;\n    document.getElementById('check-stylistic').checked = settings.checkStylistic;\n    document.getElementById('check-logical').checked = settings.checkLogical;\n    document.getElementById('split-into-chunks-checkbox').checked = settings.splitIntoChunks;\n    document.getElementById('chunk-size').value = settings.chunkSize;\n    document.getElementById('max-chars').value = settings.maxChars;\n    document.getElementById('temperature').value = settings.temperature;\n    document.getElementById('max-tokens').value = settings.maxTokens;\n    document.getElementById('response-format-checkbox').checked = settings.responseFormat;\n    document.getElementById('retry-on-error-checkbox').checked = settings.retryOnError;\n    document.getElementById('retry-count').value = settings.retryCount;\n    document.getElementById('edit-prompts-checkbox').checked = settings.editPrompts;\n    togglePromptsEditorGrammar();\n\n    // Загрузка промптов\n    const prompts = preset.prompts;\n    document.getElementById('prompt-role').value = prompts.promptRole;\n    document.getElementById('prompt-grammatical').value = prompts.promptGrammatical;\n    document.getElementById('prompt-syntactic').value = prompts.promptSyntactic;\n    document.getElementById('prompt-stylistic').value = prompts.promptStylistic;\n    document.getElementById('prompt-logical').value = prompts.promptLogical;\n    document.getElementById('prompt-text-note').value = prompts.promptTextNote;\n\n    // Обновляем селектор модели\n    if (settings.grammarModel) {\n        $('#grammar-model').val(settings.grammarModel).trigger('change');\n        // Дополнительно можно вызвать populateGrammarModelSelect(), если необходимо\n        populateGrammarModelSelect();\n    }\n\n    // Сохраняем последний выбранный пресет\n    localStorage.setItem('lastSelectedPreset', presetName);\n\n    // Сохраняем настройки и промпты в localStorage\n    saveGrammarSettings();\n    saveGrammarPrompts();\n\n    displayPresetMessageGrammar('Пресет загружен.', 'success');\n\n    // Обновляем JSON\n    updatePresetJSONGrammar();\n\n    window.isLoadingPreset = false;\n}\n\n\n\n\n\nfunction deleteSelectedPresetGrammar() {\n    const presetName = $('#preset-select').val();\n    if (!presetName || presetName === 'current') {\n        displayPresetMessageGrammar('Нет выбранного пресета для удаления.', 'danger');\n        return;\n    }\n\n    showPresetConfirmationGrammar(`Вы уверены, что хотите удалить пресет \"${presetName}\"?`, () => {\n        let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n        presets = presets.filter(p => p.name !== presetName);\n        localStorage.setItem('grammarPresets', JSON.stringify(presets));\n\n        // Сбрасываем выбор пресета\n        $('#preset-select').val('current').trigger('change');\n        localStorage.removeItem('lastSelectedPreset');\n\n        populatePresetSelectGrammar();\n\n        displayPresetMessageGrammar('Пресет удален.', 'success');\n\n        // Очищаем поле JSON\n        document.getElementById('preset-json').value = '';\n    });\n}\n\nfunction updatePresetJSONGrammar() {\n    const presetName = $('#preset-select').val();\n    if (!presetName || presetName === 'current') {\n        document.getElementById('preset-json').value = '';\n        return;\n    }\n\n    let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n    const preset = presets.find(p => p.name === presetName);\n    if (!preset) {\n        document.getElementById('preset-json').value = '';\n        return;\n    }\n\n    const presetJSON = JSON.stringify(preset, null, 2);\n    document.getElementById('preset-json').value = presetJSON;\n}\n\n\n\n\nfunction copyPresetJSONGrammar() {\n    const presetJSONTextarea = document.getElementById('preset-json');\n    presetJSONTextarea.select();\n    document.execCommand('copy');\n    displayPresetMessageGrammar('JSON пресета скопирован в буфер обмена.', 'success');\n}\n\nfunction importPresetFromJSONGrammar() {\n    const presetJSON = document.getElementById('preset-json-import').value;\n    if (!presetJSON) {\n        displayPresetMessageGrammar('Поле JSON пустое.', 'danger');\n        return;\n    }\n\n    try {\n        const preset = JSON.parse(presetJSON);\n        if (!preset.name || !preset.settings || !preset.prompts) {\n            displayPresetMessageGrammar('Некорректный формат пресета.', 'danger');\n            return;\n        }\n\n        if (preset.name.toLowerCase() === 'current' || preset.name === 'Текущие настройки') {\n            displayPresetMessageGrammar('Название пресета не может быть \"Текущие настройки\".', 'danger');\n            return;\n        }\n\n        preset.settings = { ...getDefaultSettingsGrammar(), ...preset.settings };\n        preset.prompts = { ...getDefaultPromptsGrammar(), ...preset.prompts };\n\n        let presets = JSON.parse(localStorage.getItem('grammarPresets') || '[]');\n\n        // Проверяем, существует ли пресет с таким именем\n        const existingIndex = presets.findIndex(p => p.name === preset.name);\n        if (existingIndex !== -1) {\n            showPresetConfirmationGrammar(`Пресет с названием \"${preset.name}\" уже существует. Перезаписать его?`, () => {\n                presets[existingIndex] = preset;\n                localStorage.setItem('grammarPresets', JSON.stringify(presets));\n                populatePresetSelectGrammar();\n                $('#preset-select').val(preset.name).trigger('change');\n                localStorage.setItem('lastSelectedPreset', preset.name);\n\n                displayPresetMessageGrammar('Пресет импортирован.', 'success');\n                updatePresetJSONGrammar();\n            });\n        } else {\n            presets.push(preset);\n            localStorage.setItem('grammarPresets', JSON.stringify(presets));\n            populatePresetSelectGrammar();\n            $('#preset-select').val(preset.name).trigger('change');\n            localStorage.setItem('lastSelectedPreset', preset.name);\n\n            displayPresetMessageGrammar('Пресет импортирован.', 'success');\n            updatePresetJSONGrammar();\n        }\n    } catch (error) {\n        console.error('Ошибка при импорте пресета:', error);\n        displayPresetMessageGrammar('Ошибка при импорте пресета. Проверьте формат JSON.', 'danger');\n    }\n}\n\n\nfunction displayPresetMessageGrammar(message, type) {\n    const messageDiv = document.getElementById('preset-message');\n    messageDiv.innerHTML = `<div class=\"alert alert-${type}\">${message}</div>`;\n    setTimeout(() => {\n        messageDiv.innerHTML = '';\n    }, 3000);\n}\n\nfunction getDefaultSettingsGrammar() {\n    return {\n        highlightErrors: true,\n        addComments: false,\n        highlightCorrected: true,\n        checkGrammatical: false,\n        checkSyntactic: false,\n        checkStylistic: true,\n        checkLogical: true,\n        splitIntoChunks: false,\n        chunkSize: 8,\n        maxChars: 2000,\n        temperature: 0.1,\n        maxTokens: 4000,\n        responseFormat: false,\n        retryOnError: true,\n        retryCount: 3,\n        editPrompts: true,\n        grammarModel: \"anthropic/claude-3.5-sonnet:beta\",\n    };\n}\n\nfunction getDefaultPromptsGrammar() {\n    return {\n        'role': 'Ты - опытный редактор и лингвист.',\n        'грамматическая': '- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.',\n        'синтаксическая': '- Ищи синтаксические ошибки, связанные с неправильным построением предложений.',\n        'стилистическая': '- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.',\n        'логическая': '- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте.',\n    };\n}\n\nasync function checkGrammarGrammar() {\n    try {\n        const splitIntoChunks = document.getElementById('split-into-chunks-checkbox').checked;\n        const chunkSize = parseInt(document.getElementById('chunk-size').value, 10) || 5;\n\n        // Сбрасываем прогресс бар и список ошибок\n        document.getElementById('grammar-results').innerHTML = '';\n        resetProgressBarGrammar();\n\n        showLoadingGrammar(true, splitIntoChunks);\n\n        // Скрываем фильтр результатов\n        document.getElementById('filter-container').style.display = 'none';\n\n        // Создаем новый AbortController для возможности отмены\n        window.abortController = new AbortController();\n\n        // Получаем выделенный текст\n        const selectionText = await Word.run(async (context) => {\n            const selection = context.document.getSelection();\n            selection.load(\"text\");\n            await context.sync();\n            return selection.text.trim();\n        });\n\n        const maxChars = parseInt(document.getElementById('max-chars').value, 10) || 100;\n\n        if (selectionText.length > 0) {\n            if (!splitIntoChunks && maxChars > 0 && selectionText.length > maxChars) {\n                document.getElementById('grammar-results').innerHTML = `<p class=\"text-warning\">Выделенный текст слишком длинный (${selectionText.length} символов). Пожалуйста, выделите меньше ${maxChars} символов или измените ограничение в настройках.</p>`;\n                showLoadingGrammar(false);\n                return;\n            }\n\n            const model = $('#grammar-model').val();\n            let result = [];\n\n            if (splitIntoChunks) {\n                const chunks = splitTextIntoChunksGrammar(selectionText, chunkSize);\n                const totalChunks = chunks.length;\n                const progressBar = document.getElementById('progress-bar');\n                const progressText = document.getElementById('progress-text');\n\n                // Инициализируем прогресс бар с общим количеством чанков\n                progressText.innerText = `Обработано 0 из ${totalChunks} чанков`;\n\n                for (let i = 0; i < chunks.length; i++) {\n                    const chunkResult = await analyzeTextWithRetryGrammar(chunks[i], model, window.abortController.signal);\n                    result = result.concat(chunkResult);\n\n                    // Обновляем прогресс бар\n                    const progressPercent = Math.round(((i + 1) / totalChunks) * 100);\n                    progressBar.style.width = `${progressPercent}%`;\n                    progressBar.innerText = `${progressPercent}%`;\n                    progressText.innerText = `Обработано ${i + 1} из ${totalChunks} чанков`;\n                }\n            } else {\n                const chunkResult = await analyzeTextWithRetryGrammar(selectionText, model, window.abortController.signal);\n                result = result.concat(chunkResult);\n            }\n\n            // Сохраняем результаты в переменной для дальнейшего использования\n            window.grammarResults = result;\n\n            displayResultsGrammar(result);\n            await highlightTextGrammar(result);\n\n            // Показываем фильтр результатов, если есть ошибки\n            if (result.length > 0) {\n                document.getElementById('filter-container').style.display = 'block';\n            }\n        } else {\n            console.log(\"Текст не выделен\");\n            document.getElementById('grammar-results').innerHTML = '<p class=\"text-warning\">Пожалуйста, выделите текст для проверки.</p>';\n            showLoadingGrammar(false); // Отключаем загрузчик, если нет выделенного текста\n        }\n    } catch (error) {\n        if (error.name === 'AbortError') {\n            console.log('Проверка отменена пользователем.');\n            document.getElementById('grammar-results').innerHTML = '<p class=\"text-info\">Проверка отменена.</p>';\n        } else {\n            console.error('Error in checkGrammarGrammar:', error);\n            document.getElementById('grammar-results').innerHTML = '<p class=\"text-danger\">Произошла ошибка при проверке. Пожалуйста, попробуйте еще раз.</p>';\n        }\n    } finally {\n        showLoadingGrammar(false);\n        window.abortController = null;\n    }\n}\n\nfunction cancelCheckGrammar() {\n    if (window.abortController) {\n        window.abortController.abort();\n        showLoadingGrammar(false);\n        window.abortController = null;\n    }\n}\n\nfunction resetProgressBarGrammar() {\n    const progressBar = document.getElementById('progress-bar');\n    const progressText = document.getElementById('progress-text');\n    if (progressBar) {\n        progressBar.style.width = '0%';\n        progressBar.innerText = '0%';\n    }\n    if (progressText) {\n        progressText.innerText = 'Обработано 0 из 0 чанков';\n    }\n}\n\nfunction splitTextIntoChunksGrammar(text, chunkSize) {\n    const sentences = text.match(/[^.!?]+[.!?]+(\\s|$)|[^.!?]+$/g) || [text];\n    const chunks = [];\n    for (let i = 0; i < sentences.length; i += chunkSize) {\n        const chunk = sentences.slice(i, i + chunkSize).join(' ').trim();\n        chunks.push(chunk);\n    }\n    return chunks;\n}\n\nasync function analyzeTextWithRetryGrammar(text, model, signal) {\n    const retryOnError = document.getElementById('retry-on-error-checkbox').checked;\n    const retryCount = parseInt(document.getElementById('retry-count').value, 10) || 1;\n\n    let attempts = 0;\n    let lastError = null;\n\n    while (attempts < retryCount) {\n        try {\n            const result = await analyzeTextGrammar(text, model, signal);\n            return result;\n        } catch (error) {\n            lastError = error;\n            attempts++;\n            if (!retryOnError || attempts >= retryCount) {\n                throw error;\n            } else {\n                console.warn(`Попытка ${attempts} не удалась. Повторяем...`);\n            }\n        }\n    }\n\n    throw lastError;\n}\n\n\nasync function analyzeTextGrammar(text, model, signal) {\n    const apiKey = localStorage.getItem('apiKey');\n\n    // Получаем выбранные типы ошибок\n    const errorTypes = [];\n    const errorTypesMap = {};\n\n    const prompts = {};\n    const defaultPrompts = getDefaultPromptsGrammar();\n\n    if (document.getElementById('check-grammatical').checked) {\n        errorTypes.push('грамматические');\n        errorTypesMap['грамматическая'] = true;\n        prompts['грамматическая'] = document.getElementById('prompt-grammatical').value || defaultPrompts['грамматическая'];\n    }\n    if (document.getElementById('check-syntactic').checked) {\n        errorTypes.push('синтаксические');\n        errorTypesMap['синтаксическая'] = true;\n        prompts['синтаксическая'] = document.getElementById('prompt-syntactic').value || defaultPrompts['синтаксическая'];\n    }\n    if (document.getElementById('check-stylistic').checked) {\n        errorTypes.push('стилистические');\n        errorTypesMap['стилистическая'] = true;\n        prompts['стилистическая'] = document.getElementById('prompt-stylistic').value || defaultPrompts['стилистическая'];\n    }\n    if (document.getElementById('check-logical').checked) {\n        errorTypes.push('логические');\n        errorTypesMap['логическая'] = true;\n        prompts['логическая'] = document.getElementById('prompt-logical').value || defaultPrompts['логическая'];\n    }\n\n    if (errorTypes.length === 0) {\n        throw new Error('Не выбраны типы проверок');\n    }\n\n    const errorTypesString = errorTypes.join(', ');\n\n    // Получаем примечание о проверяемом тексте\n    const promptTextNote = document.getElementById('prompt-text-note').value || '';\n\n    // Получаем промпт роли\n    const promptRole = document.getElementById('prompt-role').value || defaultPrompts['role'];\n\n    // Получаем настройки модели\n    const temperature = parseFloat(document.getElementById('temperature').value) || 0.1;\n    const maxTokens = parseInt(document.getElementById('max-tokens').value, 10) || 8000;\n    const responseFormat = document.getElementById('response-format-checkbox').checked;\n\n    // Формируем системный промпт\n    const systemPrompt = `${promptRole} Твоя задача - проанализировать предоставленный текст и найти только следующие типы ошибок: ${errorTypesString}.\n\n${promptTextNote ? `Дополнительная информация о тексте: ${promptTextNote}\\n` : ''}\n\n${Object.keys(prompts).map(type => `Инструкция для \"${type}\" ошибок:\\n${prompts[type]}\\n`).join('\\n')}\n\nТвои инструкции:\n\n- Анализируй текст на уровне предложений и отдельных слов.\n\n- Ищи только указанные типы ошибок.\n\n- Игнорируй другие типы ошибок.\n\n- Если исправление можно внести напрямую в текст и оно не добавляет новой информации, установи \"can_edit\": true и предоставь поле \"text_to_change\" с исправленным текстом.\n\n- Если исправление невозможно внести напрямую в текст или добавляет новую информацию, установи \"can_edit\": false, предоставь поле \"suggestion\" с рекомендациями по улучшению и добавь поле \"example\" с примером улучшенного текста.\n\n- Убедись, что все строки в JSON корректно экранированы. В частности, любые двойные кавычки внутри значений строк должны быть экранированы обратным слешем (\\\\\"\").\n\n- Возвращай результат в формате JSON-массива, где каждый элемент содержит:\n  1. \"text\": проблемный фрагмент текста (слово, фраза или предложение).\n  2. \"comment\": объяснение проблемы.\n  3. \"errorType\": тип ошибки (${Object.keys(errorTypesMap).map(type => `\"${type}\"`).join(', ')}).\n  4. \"can_edit\": true или false (указывает, можно ли внести исправление напрямую в текст).\n  5. Если \"can_edit\" равно true, добавь поле \"text_to_change\" с исправленным текстом.\n  6. Если \"can_edit\" равно false, добавь поле \"suggestion\" с рекомендациями по улучшению и поле \"example\" с примером улучшенного текста.\n\nПример ответа:\n\n${getExampleErrorsGrammar(Object.keys(errorTypesMap))}\n\nВажно:\n\n- Возвращай *только* JSON-массив без дополнительных пояснений или предисловий.\n\n- Убедись, что все строки в JSON корректно экранированы. В частности, любые двойные кавычки внутри значений строк должны быть экранированы обратным слешем (\\\").\n\n- Если ошибок нет, верни пустой массив: [];\n`;\n\n    const userPrompt = `Пожалуйста, проанализируй следующий текст:\n\n\"${text}\";\n`;\n\n    try {\n        const requestBody = {\n            model: model,\n            messages: [\n                { role: \"system\", content: systemPrompt },\n                { role: \"user\", content: userPrompt }\n            ],\n            temperature: temperature,\n            max_tokens: maxTokens,\n        };\n\n        if (responseFormat) {\n            requestBody.response_format = { \"type\": \"json_object\" };\n        }\n\n        const response = await fetch(\"https://openrouter.ai/api/v1/chat/completions\", {\n            method: 'POST',\n            headers: {\n                'Authorization': `Bearer ${apiKey}`,\n                'Content-Type': 'application/json',\n                'HTTP-Referer': 'https://www.office.com',\n                'X-Title': 'Word Grammar Checker',\n            },\n            body: JSON.stringify(requestBody),\n            signal: signal, // Передаем сигнал для возможности отмены\n        });\n\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n\n        const data = await response.json();\n        console.log('Ответ от сервера:', data.choices[0].message.content.trim());\n\n        // Обработка потенциальных ошибок в JSON\n        const jsonResponse = safeJsonParseGrammar(data.choices[0].message.content.trim());\n        return jsonResponse;\n    } catch (error) {\n        if (error.name === 'AbortError') {\n            console.log('Запрос был отменен.');\n            throw error;\n        } else {\n            console.error('Error in analyzeTextGrammar:', error);\n            throw error;\n        }\n    }\n}\n\n\n// Функция безопасного парсинга JSON\nfunction safeJsonParseGrammar(str) {\n    try {\n        return JSON.parse(str);\n    } catch (error) {\n        // Попытка исправить возможные ошибки экранирования\n        const fixedStr = str.replace(/\\\\?\"/g, '\\\\\"').replace(/\\\\\\\\\"/g, '\\\\\\\"');\n        try {\n            return JSON.parse(fixedStr);\n        } catch (innerError) {\n            console.error('Failed to parse JSON after fixing:', innerError);\n            throw innerError;\n        }\n    }\n}\n\nfunction getExampleErrorsGrammar(selectedErrorTypes) {\n    const examples = [];\n\n    if (selectedErrorTypes.includes('грамматическая')) {\n        // Примеры с can_edit: true\n        examples.push(`{\n    \"text\": \"Она сказал\",\n    \"comment\": \"Неправильное согласование рода в глаголе.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Она сказала\"\n}`);\n        examples.push(`{\n    \"text\": \"Я иду в школу завтра.\",\n    \"comment\": \"Неправильное использование времени глагола.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Я пойду в школу завтра.\"\n}`);\n        examples.push(`{\n    \"text\": \"У него есть две собаки и три кошка.\",\n    \"comment\": \"Неправильное согласование числительного и существительного.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"У него есть две собаки и три кошки.\"\n}`);\n\n        // Примеры с can_edit: false\n        examples.push(`{\n    \"text\": \"Бегу по дороге быстро.\",\n    \"comment\": \"Отсутствует подлежащее в предложении.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Добавить подлежащее для ясности.\",\n    \"example\": \"Я бегу по дороге быстро.\"\n}`);\n        examples.push(`{\n    \"text\": \"Придя домой, было тихо.\",\n    \"comment\": \"Неправильное употребление деепричастного оборота без подлежащего.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Переписать предложение, указав, кто пришел домой.\",\n    \"example\": \"Когда я пришёл домой, было тихо.\"\n}`);\n        examples.push(`{\n    \"text\": \"Книга, которую я читаю интересная.\",\n    \"comment\": \"Отсутствует запятая перед придаточным предложением.\",\n    \"errorType\": \"грамматическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Добавить запятую для правильной пунктуации.\",\n    \"example\": \"Книга, которую я читаю, интересная.\"\n}`);\n    }\n\n    if (selectedErrorTypes.includes('синтаксическая')) {\n        // Примеры с can_edit: true\n        examples.push(`{\n    \"text\": \"Я люблю читать книги смотреть фильмы.\",\n    \"comment\": \"Отсутствует союз между однородными членами предложения.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Я люблю читать книги и смотреть фильмы.\"\n}`);\n        examples.push(`{\n    \"text\": \"Она сказала что придет позже.\",\n    \"comment\": \"Отсутствует запятая перед придаточным предложением.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Она сказала, что придет позже.\"\n}`);\n        examples.push(`{\n    \"text\": \"После дождя дорога была скользкая она упала.\",\n    \"comment\": \"Отсутствует разделение на предложения или союз.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"После дождя дорога была скользкая, и она упала.\"\n}`);\n\n        // Примеры с can_edit: false\n        examples.push(`{\n    \"text\": \"Мы приносим свои искренние извинения всем,кого могли забыть упомянуть здесь.\",\n    \"comment\": \"Синтаксическая ошибка: отсутствует пробел после запятой.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Добавить пробел после запятой.\",\n    \"example\": \"Мы приносим свои искренние извинения всем, кого могли забыть упомянуть здесь.\"\n}`);\n        examples.push(`{\n    \"text\": \"Из-за того что шел дождь.\",\n    \"comment\": \"Неполное предложение: отсутствует главная часть.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Добавить главную часть предложения для завершенности.\",\n    \"example\": \"Из-за того что шел дождь, мы остались дома.\"\n}`);\n        examples.push(`{\n    \"text\": \"Планируя поездку, была куплена карта.\",\n    \"comment\": \"Неясно, кто планировал поездку; неправильно построен деепричастный оборот.\",\n    \"errorType\": \"синтаксическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Переписать предложение для ясности.\",\n    \"example\": \"Планируя поездку, мы купили карту.\"\n}`);\n    }\n\n    if (selectedErrorTypes.includes('стилистическая')) {\n        // Примеры с can_edit: true\n        examples.push(`{\n    \"text\": \"Он встал рано утром, чтобы пойти на работку.\",\n    \"comment\": \"Нежелательное использование уменьшительно-ласкательного суффикса.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Он встал рано утром, чтобы пойти на работу.\"\n}`);\n        examples.push(`{\n    \"text\": \"Она сказала ему, что это офигенно.\",\n    \"comment\": \"Нежелательное использование разговорного выражения.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Она сказала ему, что это великолепно.\"\n}`);\n        examples.push(`{\n    \"text\": \"В результате он потерпел фиаско.\",\n    \"comment\": \"Стилистическая неточность: использование заимствованного слова, которое может быть заменено более подходящим.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"В результате он потерпел неудачу.\"\n}`);\n\n        // Примеры с can_edit: false\n        examples.push(`{\n    \"text\": \"Нам повезло, что мы получили отличную поддержку.\",\n    \"comment\": \"Стилистическая неточность: слово 'повезло' может преуменьшать усилия тех, кто оказал поддержку.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Заменить выражение на более признательное.\",\n    \"example\": \"Мы благодарны за отличную поддержку, которую получили.\"\n}`);\n        examples.push(`{\n    \"text\": \"Доклад был ничего так, слушатели остались довольны.\",\n    \"comment\": \"Неофициальный стиль изложения в формальном контексте.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Исправить выражение на более формальное.\",\n    \"example\": \"Доклад был информативным, и слушатели остались довольны.\"\n}`);\n        examples.push(`{\n    \"text\": \"Он сделал это быстрее всех, потому что он крутой.\",\n    \"comment\": \"Использование жаргонного слова в официальном тексте.\",\n    \"errorType\": \"стилистическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Заменить жаргонное слово на более подходящее.\",\n    \"example\": \"Он сделал это быстрее всех благодаря своим навыкам.\"\n}`);\n    }\n\n    if (selectedErrorTypes.includes('логическая')) {\n        // Примеры с can_edit: true\n        examples.push(`{\n    \"text\": \"Она родилась в 2000 году и в 1990 году окончила университет.\",\n    \"comment\": \"Логическая ошибка: невозможно окончить университет до рождения.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Она родилась в 1970 году и в 1990 году окончила университет.\"\n}`);\n        examples.push(`{\n    \"text\": \"Он съел обед перед завтраком.\",\n    \"comment\": \"Логическая несостыковка во времени приема пищи.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Он съел завтрак перед обедом.\"\n}`);\n        examples.push(`{\n    \"text\": \"Вода замерзает при 100 градусах Цельсия.\",\n    \"comment\": \"Неправильная температура замерзания воды.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": true,\n    \"text_to_change\": \"Вода замерзает при 0 градусах Цельсия.\"\n}`);\n\n        // Примеры с can_edit: false\n        examples.push(`{\n    \"text\": \"Этот квадрат имеет три стороны.\",\n    \"comment\": \"Логическое противоречие: квадрат не может иметь три стороны.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Уточнить форму или количество сторон фигуры.\",\n    \"example\": \"Этот треугольник имеет три стороны.\"\n}`);\n        examples.push(`{\n    \"text\": \"Он продал больше книг, чем любой другой автор, включая себя.\",\n    \"comment\": \"Логическая ошибка: некорректное сравнение с самим собой.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Пересмотреть формулировку сравнения.\",\n    \"example\": \"Он продал больше книг, чем любой другой автор.\"\n}`);\n        examples.push(`{\n    \"text\": \"Она всегда говорит правду, но ей нельзя доверять.\",\n    \"comment\": \"Логическое противоречие в характеристике.\",\n    \"errorType\": \"логическая\",\n    \"can_edit\": false,\n    \"suggestion\": \"Уточнить описание для устранения противоречия.\",\n    \"example\": \"Она часто обманывает, поэтому ей нельзя доверять.\"\n}`);\n    }\n\n    return `[\n  ${examples.join(',\\n  ')}\n]`;\n}\n\n\nfunction displayResultsGrammar(results) {\n    const resultsDiv = document.getElementById('grammar-results');\n    resultsDiv.innerHTML = '';\n\n    if (results.length === 0) {\n        resultsDiv.innerHTML = '<p class=\"text-success\">Ошибок не найдено. Текст выглядит хорошо!</p>';\n        return;\n    }\n\n    const filterValue = document.getElementById('filter-select').value;\n\n    // Группируем ошибки по типам\n    const groupedResults = {};\n    results.forEach((result, index) => {\n        const type = result.errorType || 'Другие';\n        if (!groupedResults[type]) {\n            groupedResults[type] = [];\n        }\n        // Добавляем индекс ошибки для идентификации\n        result.index = index;\n\n        // Фильтрация по can_edit\n        if (filterValue === 'can_edit' && !result.can_edit) {\n            return;\n        }\n        if (filterValue === 'cannot_edit' && result.can_edit) {\n            return;\n        }\n\n        groupedResults[type].push(result);\n    });\n\n    // Удаляем категории без ошибок\n    Object.keys(groupedResults).forEach(type => {\n        if (groupedResults[type].length === 0) {\n            delete groupedResults[type];\n        }\n    });\n\n    // Проверяем, есть ли результаты после фильтрации\n    if (Object.keys(groupedResults).length === 0) {\n        resultsDiv.innerHTML = '<p class=\"text-info\">Нет ошибок для отображения по выбранному фильтру.</p>';\n        return;\n    }\n\n    // Отображаем ошибки в аккордеонах с разделением\n    const accordionId = 'grammarAccordion';\n    let accordionHTML = `<div class=\"accordion\" id=\"${accordionId}\">`;\n\n    Object.keys(groupedResults).forEach((type, index) => {\n        const errors = groupedResults[type];\n        const collapseId = `collapse${index}`;\n        accordionHTML += `\n            <div class=\"card\">\n                <div class=\"card-header\" id=\"heading${index}\">\n                    <h2 class=\"mb-0\">\n                        <button class=\"btn btn-link ${index === 0 ? '' : 'collapsed'}\" type=\"button\" data-toggle=\"collapse\" data-target=\"#${collapseId}\" aria-expanded=\"${index === 0 ? 'true' : 'false'}\" aria-controls=\"${collapseId}\">\n                            ${type.charAt(0).toUpperCase() + type.slice(1)} ошибки (<span class=\"error-count\">${errors.length}</span>)\n                        </button>\n                    </h2>\n                </div>\n                <div id=\"${collapseId}\" class=\"collapse ${index === 0 ? 'show' : ''}\" aria-labelledby=\"heading${index}\" data-parent=\"#${accordionId}\">\n                    <div class=\"card-body\">\n                        ${errors.map((error, errorIndex) => `\n                            <div class=\"mb-3 p-3 border error-card ${errorIndex < errors.length - 1 ? 'border-bottom' : ''}\" data-error-index=\"${error.index}\" data-error-type=\"${type}\">\n                                <p><strong>Проблемный текст:</strong> <span class=\"text-danger\">${error.text}</span></p>\n                                <p><strong>Комментарий:</strong> ${error.comment}</p>\n                                ${error.can_edit ? \n                                `<p><strong>Исправление:</strong> <span class=\"text-success\">${error.text_to_change}</span></p>\n                                <button class=\"btn btn-sm btn-primary apply-suggestion\" data-error-index=\"${error.index}\">Применить исправление</button>`\n                                 : \n                                `<p><strong>Рекомендации:</strong> ${error.suggestion}</p>\n                                <p><strong>Пример улучшенного текста:</strong> <span class=\"text-info\">${error.example}</span></p>\n                                <p><em>Исправление невозможно применить напрямую.</em></p>`\n                                }\n                            </div>\n                        `).join('')}\n                    </div>\n                </div>\n            </div>\n        `;\n    });\n\n    accordionHTML += '</div>';\n    resultsDiv.innerHTML = accordionHTML;\n\n    // Добавляем обработчики для кнопок \"Применить исправление\"\n    const buttons = document.getElementsByClassName('apply-suggestion');\n    for (let button of buttons) {\n        button.addEventListener('click', function () {\n            const errorIndex = parseInt(this.dataset.errorIndex, 10);\n            applySuggestion(errorIndex, window.grammarResults, this);\n        });\n    }\n}\n\nasync function highlightTextGrammar(results) {\n    const highlight = document.getElementById('highlight-checkbox').checked;\n    const addComments = document.getElementById('comment-checkbox').checked;\n    if (!highlight && !addComments) return;\n\n    await Word.run(async (context) => {\n        const selection = context.document.getSelection();\n        for (let result of results) {\n            const ranges = selection.search(result.text, { matchCase: true, matchWholeWord: false });\n            ranges.load(\"items\");\n            context.trackedObjects.add(ranges);\n            await context.sync();\n\n            if (ranges.items.length > 0) {\n                for (let range of ranges.items) {\n                    if (highlight) {\n                        range.font.highlightColor = \"yellow\";\n                    }\n                    if (addComments) {\n                        let commentText = `Тип ошибки: ${result.errorType}\\nКомментарий: ${result.comment}`;\n                        if (result.can_edit) {\n                            commentText += `\\nИсправление: ${result.text_to_change}`;\n                        } else {\n                            commentText += `\\nРекомендации: ${result.suggestion}\\nПример улучшенного текста: ${result.example}`;\n                        }\n                        range.insertComment(commentText);\n                    }\n                }\n                await context.sync();\n            }\n\n            context.trackedObjects.remove(ranges);\n        }\n    }).catch(function (error) {\n        console.log('Error:', error);\n    });\n}\n\n// Функция показа загрузки\nfunction showLoadingGrammar(isLoading, useProgressBar = false) {\n    const loadingElement = document.getElementById('loading');\n    const checkButton = document.getElementById('check-grammar');\n    const progressContainer = document.getElementById('progress-container');\n    const spinner = document.getElementById('spinner');\n    if (isLoading) {\n        loadingElement.style.display = 'block';\n        checkButton.disabled = true;\n        if (useProgressBar) {\n            progressContainer.style.display = 'block';\n            spinner.style.display = 'none';\n        } else {\n            progressContainer.style.display = 'none';\n            spinner.style.display = 'block';\n        }\n    } else {\n        loadingElement.style.display = 'none';\n        checkButton.disabled = false;\n        progressContainer.style.display = 'none';\n        spinner.style.display = 'none';\n    }\n}\n\n\n\n\n\n\n// \n\n\nOffice.onReady((info) => {\n    if (info.host === Office.HostType.Word) {\n        initHome();\n        initPrompts();\n        initSettings();\n        initGrammar();\n    }\n});\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    initHome();\n    initPrompts();\n    initSettings();\n    initGrammar();\n});\n\n","// Imports\nimport ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___ from \"../../node_modules/html-loader/dist/runtime/getUrl.js\";\nvar ___HTML_LOADER_IMPORT_0___ = new URL(\"./taskpane.js\", import.meta.url);\n// Module\nvar ___HTML_LOADER_REPLACEMENT_0___ = ___HTML_LOADER_GET_SOURCE_FROM_IMPORT___(___HTML_LOADER_IMPORT_0___);\nvar code = \"<!DOCTYPE html> <html> <head> <meta charset=\\\"UTF-8\\\"/> <meta http-equiv=\\\"X-UA-Compatible\\\" content=\\\"IE=Edge\\\"/> <title>Замена текста</title> <link rel=\\\"stylesheet\\\" href=\\\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css\\\"> <link rel=\\\"stylesheet\\\" href=\\\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css\\\"> <link href=\\\"https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css\\\" rel=\\\"stylesheet\\\"/> </head> <body> <div class=\\\"container mt-3\\\"> <ul class=\\\"nav nav-tabs\\\" id=\\\"myTab\\\" role=\\\"tablist\\\"> <li class=\\\"nav-item\\\" role=\\\"presentation\\\"> <a class=\\\"nav-link active\\\" id=\\\"home-tab\\\" data-toggle=\\\"tab\\\" href=\\\"#home\\\" role=\\\"tab\\\" aria-controls=\\\"home\\\" aria-selected=\\\"true\\\">Основное</a> </li> <li class=\\\"nav-item\\\" role=\\\"presentation\\\"> <a class=\\\"nav-link\\\" id=\\\"grammar-tab\\\" data-toggle=\\\"tab\\\" href=\\\"#grammar\\\" role=\\\"tab\\\" aria-controls=\\\"grammar\\\" aria-selected=\\\"false\\\">Проверка на ошибки</a> </li> <li class=\\\"nav-item\\\" role=\\\"presentation\\\"> <a class=\\\"nav-link\\\" id=\\\"prompts-tab\\\" data-toggle=\\\"tab\\\" href=\\\"#prompts\\\" role=\\\"tab\\\" aria-controls=\\\"prompts\\\" aria-selected=\\\"false\\\">Промпты</a> </li> <li class=\\\"nav-item\\\" role=\\\"presentation\\\"> <a class=\\\"nav-link\\\" id=\\\"settings-tab\\\" data-toggle=\\\"tab\\\" href=\\\"#settings\\\" role=\\\"tab\\\" aria-controls=\\\"settings\\\" aria-selected=\\\"false\\\">Настройки</a> </li> </ul> <div class=\\\"tab-content\\\" id=\\\"myTabContent\\\"> <div class=\\\"tab-pane fade show active\\\" id=\\\"home\\\" role=\\\"tabpanel\\\" aria-labelledby=\\\"home-tab\\\"></div> <div class=\\\"tab-pane fade\\\" id=\\\"grammar\\\" role=\\\"tabpanel\\\" aria-labelledby=\\\"grammar-tab\\\"></div> <div class=\\\"tab-pane fade\\\" id=\\\"prompts\\\" role=\\\"tabpanel\\\" aria-labelledby=\\\"prompts-tab\\\"></div> <div class=\\\"tab-pane fade\\\" id=\\\"settings\\\" role=\\\"tabpanel\\\" aria-labelledby=\\\"settings-tab\\\"></div> </div> </div> <\" + \"script src=\\\"https://code.jquery.com/jquery-3.5.1.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://appsforoffice.microsoft.com/lib/1/hosted/office.js\\\"><\" + \"/script> <\" + \"script src=\\\"https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js\\\"><\" + \"/script> <\" + \"script src=\\\"\" + ___HTML_LOADER_REPLACEMENT_0___ + \"\\\"><\" + \"/script> </body> </html> \";\n// Exports\nexport default code;"],"names":["module","exports","url","options","String","__esModule","default","hash","maybeNeedQuotes","test","concat","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","m","n","getter","d","a","definition","key","o","Object","defineProperty","enumerable","get","g","globalThis","this","Function","e","window","obj","prop","prototype","hasOwnProperty","call","scriptUrl","importScripts","location","document","currentScript","src","scripts","getElementsByTagName","length","i","Error","replace","p","b","baseURI","self","href","_regeneratorRuntime","t","r","value","Symbol","iterator","c","asyncIterator","u","toStringTag","define","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","type","arg","h","l","f","s","y","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","v","values","defineIteratorMethods","forEach","_invoke","AsyncIterator","invoke","_typeof","resolve","__await","then","callInvokeWithMethodAndArg","done","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","return","TypeError","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","isNaN","displayName","isGeneratorFunction","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","keys","reverse","pop","prev","charAt","slice","stop","rval","handle","complete","finish","catch","delegateYield","asyncGeneratorStep","_asyncToGenerator","arguments","apply","_next","_throw","getPrompts","JSON","parse","localStorage","getItem","savePrompts","prompts","setItem","stringify","initSettings","apiKey","formattingModel","applyFormatting","getElementById","innerHTML","onchange","saveApiKey","saveFormattingModel","saveApplyFormatting","_loadModels","loadModels","$","val","trigger","checked","select2","width","placeholder","on","setTimeout","focus","populateModelSelectt","models","promptModelSelect","formattingModelSelect","select","empty","model","option","Option","id","append","defaultModel","find","savedModel","some","OPENROUTER_BASE_URL","_callee2","response","_context2","axios","data","t0","console","error","generateTextWithAI","_x","_x2","_x3","_x4","_generateTextWithAI","_callee3","systemPrompt","userPrompt","signal","_context3","fetch","headers","body","messages","role","content","ok","status","json","choices","message","trim","generateTextWithAIFormat","_x5","_x6","_x7","_x8","_generateTextWithAIFormat","_callee4","_context4","originalText","currentController","lastSelectedPrompt","initHome","templateResult","formatPrompt","templateSelection","formatPromptSelection","onclick","replaceSelectedText","cancelRequest","showSelectedText","updatePromptSelect","setInterval","checkSelection","prompt","text","promptData","modelDiv","lastSelectedPromptIndex","parseInt","index","promptIndex","textContent","disabled","newPromptIndex","toString","Word","run","_ref","_callee","context","selection","replaceButton","_context","getSelection","load","sync","_x9","_replaceSelectedText","_callee6","_context6","_ref2","_callee5","formattingInfo","generatedText","secondUserPrompt","updatedFormattingInfo","formattingResponse","_context5","style","display","AbortController","getWordsInfo","Array","isArray","insertText","InsertLocation","applyFormattedText","t1","_x23","_x10","_x11","_x12","_x13","_applyFormattedText","_callee7","newText","words","wordIndex","word","range","wordInfo","_context7","clear","split","end","bold","font","italic","color","highlightColor","size","hyperlink","footnoteText","insertFootnote","start","abort","formatSpecialWords","wordsInfo","baseColor","baseFont","baseSize","formattedText","footnotes","wordData","hasSpecialFormatting","formatting","underline","highlight","fontName","fontSize","hasFootnote","footnoteId","relatedWordIndex","baseFormatting","_showSelectedText","_callee11","_context11","_ref4","_callee10","ranges","colorCounts","fontCounts","sizeCounts","footnote","formattedMassive","_context10","getTextRanges","items","address","isFirstWord","isSecondWord","isThirdWord","isLastWord","entries","reduce","displayWordsInfo","log","_x25","infoDiv","html","_x14","_x15","_getWordsInfo","_callee14","_iterator3","_step3","_context14","_createForOfIteratorHelper","initPrompts","savePrompt","updatePromptList","list","div","createElement","className","appendChild","querySelectorAll","button","splice","deletePrompt","dataset","updatePrompt","initGrammar","selectedModel","updatePresetJSONGrammar","populateGrammarModelSelect","populatePresetSelectGrammar","loadGrammarSettings","loadGrammarPrompts","checkGrammarGrammar","saveGrammarSettings","togglePromptsEditorGrammar","addEventListener","saveGrammarPrompts","defaultPrompts","displayPromptMessageGrammar","resetGrammarSettings","loadSelectedPresetGrammar","saveCurrentSettingsAsPresetGrammar","deleteSelectedPresetGrammar","copyPresetJSONGrammar","importPresetFromJSONGrammar","cancelCheckGrammar","displayResultsGrammar","grammarResults","abortController","isLoadingPreset","onSettingsChange","_step","currentSettings","getCurrentSettingsGrammar","currentPrompts","getCurrentPromptsGrammar","matchedPresetName","_iterator","preset","areSettingsEqual","settings","err","removeItem","element","setupSettingsChangeHandlersGrammar","defaultModelId","currentOption","presets","lastSelectedPreset","getBooleanSettingGrammar","defaultValue","getNumericSettingGrammar","num","parseFloat","addComments","highlightCorrected","checkGrammatical","checkSyntactic","checkStylistic","checkLogical","splitIntoChunks","chunkSize","maxChars","temperature","maxTokens","responseFormat","retryOnError","retryCount","editPrompts","messageDiv","promptRole","promptGrammatical","promptSyntactic","promptStylistic","promptLogical","promptTextNote","highlightErrors","grammarModel","presetNameInput","presetName","toLowerCase","existingIndex","findIndex","showPresetConfirmationGrammar","displayPresetMessageGrammar","onConfirm","confirmationDiv","confirmationMessage","confirmYesButton","confirmNoButton","obj1","obj2","obj1Keys","sort","obj2Keys","val1","val2","filter","presetJSON","execCommand","_objectSpread","_checkGrammarGrammar","_callee16","selectionText","result","chunks","totalChunks","progressBar","progressText","chunkResult","progressPercent","_chunkResult","_context16","resetProgressBarGrammar","showLoadingGrammar","_ref6","_callee15","_context15","_x27","splitTextIntoChunksGrammar","innerText","analyzeTextWithRetryGrammar","Math","round","highlightTextGrammar","sentences","match","chunk","join","_x16","_x17","_x18","_analyzeTextWithRetryGrammar","_callee17","attempts","lastError","_context17","analyzeTextGrammar","warn","_x19","_x20","_x21","_analyzeTextGrammar","_callee18","errorTypes","errorTypesMap","errorTypesString","requestBody","jsonResponse","_context18","map","selectedErrorTypes","examples","includes","max_tokens","response_format","safeJsonParseGrammar","str","fixedStr","innerError","results","resultsDiv","filterValue","groupedResults","errorType","can_edit","accordionId","accordionHTML","errors","collapseId","toUpperCase","errorIndex","comment","text_to_change","suggestion","example","_step2","_iterator2","getElementsByClassName","applySuggestion","_x22","_highlightTextGrammar","_callee20","_context20","_ref7","_callee19","_iterator4","_step4","_iterator5","_step5","commentText","_context19","search","matchCase","matchWholeWord","trackedObjects","add","insertComment","remove","_x28","isLoading","useProgressBar","loadingElement","checkButton","progressContainer","spinner","Office","onReady","info","host","HostType","___HTML_LOADER_IMPORT_0___","URL"],"sourceRoot":""}