/*! For license information please see taskpane.js.LICENSE.txt */
!function(){var e={14385:function(e){"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},54058:function(e,t,n){"use strict";e.exports=n.p+"34a73275545a09a8511b.js"}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var a=t.getElementsByTagName("script");if(a.length)for(var r=a.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=a[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),n.b=document.baseURI||self.location.href,function(){var e=["lastSelectedPromptIndex","lastSelectedMultipromptIndices"];function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){s=!0,o=e},f:function(){try{c||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,o,c,l=[],s=!0,i=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(a=o.call(n)).done)&&(l.push(a.value),l.length!==t);s=!0);}catch(e){i=!0,r=e}finally{try{if(!s&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(i)throw r}}return l}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function i(){"use strict";i=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,n){e[t]=n.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",s=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function d(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(e){d=function(e,t,n){return e[t]=n}}function m(e,t,n,a){var r=t&&t.prototype instanceof y?t:y,c=Object.create(r.prototype),l=new O(a||[]);return o(c,"_invoke",{value:T(e,n,l)}),c}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=m;var g="suspendedStart",f="suspendedYield",v="executing",h="completed",b={};function y(){}function x(){}function _(){}var k={};d(k,l,(function(){return this}));var I=Object.getPrototypeOf,E=I&&I(I(L([])));E&&E!==n&&a.call(E,l)&&(k=E);var S=_.prototype=y.prototype=Object.create(k);function B(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(o,c,l,s){var i=p(e[o],e,c);if("throw"!==i.type){var u=i.arg,d=u.value;return d&&"object"==r(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,l,s)}),(function(e){n("throw",e,l,s)})):t.resolve(d).then((function(e){u.value=e,l(u)}),(function(e){return n("throw",e,l,s)}))}s(i.arg)}var c;o(this,"_invoke",{value:function(e,a){function r(){return new t((function(t,r){n(e,a,t,r)}))}return c=c?c.then(r,r):r()}})}function T(t,n,a){var r=g;return function(o,c){if(r===v)throw Error("Generator is already running");if(r===h){if("throw"===o)throw c;return{value:e,done:!0}}for(a.method=o,a.arg=c;;){var l=a.delegate;if(l){var s=C(l,a);if(s){if(s===b)continue;return s}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(r===g)throw r=h,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);r=v;var i=p(t,n,a);if("normal"===i.type){if(r=a.done?h:f,i.arg===b)continue;return{value:i.arg,done:a.done}}"throw"===i.type&&(r=h,a.method="throw",a.arg=i.arg)}}}function C(t,n){var a=n.method,r=t.iterator[a];if(r===e)return n.delegate=null,"throw"===a&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),b;var o=p(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,b;var c=o.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function L(t){if(t||""===t){var n=t[l];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function n(){for(;++o<t.length;)if(a.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return c.next=c}}throw new TypeError(r(t)+" is not iterable")}return x.prototype=_,o(S,"constructor",{value:_,configurable:!0}),o(_,"constructor",{value:x,configurable:!0}),x.displayName=d(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,d(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},B(w.prototype),d(w.prototype,s,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,a,r,o){void 0===o&&(o=Promise);var c=new w(m(e,n,a,r),o);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},B(S),d(S,u,"Generator"),d(S,l,(function(){return this})),d(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=L,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(M),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(a,r){return l.type="throw",l.arg=t,n.next=a,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],l=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var s=a.call(c,"catchLoc"),i=a.call(c,"finallyLoc");if(s&&i){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(s){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!i)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;M(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:L(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),b}},t}function u(e,t,n,a,r,o,c){try{var l=e[o](c),s=l.value}catch(e){return void n(e)}l.done?t(s):Promise.resolve(s).then(a,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function c(e){u(o,a,r,c,l,"next",e)}function l(e){u(o,a,r,c,l,"throw",e)}c(void 0)}))}}var m="acula";function p(){return JSON.parse(localStorage.getItem("".concat(m,"prompts"))||"[]")}function g(e){localStorage.setItem("".concat(m,"prompts"),JSON.stringify(e))}function f(e,t){return v.apply(this,arguments)}function v(){return(v=d(i().mark((function e(t,n){var a,r,c,l,s,u,d,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=n.getTextRanges([" "],!1)).load("items"),e.next=4,t.sync();case 4:r=[],console.log(a),c=o(a.items),e.prev=7,c.s();case 9:if((l=c.n()).done){e.next=28;break}return(s=l.value).load("text, hyperlink"),s.font.load("bold, italic, underline, color, highlightColor, size, name"),(u=s.footnotes).load("items"),e.next=17,t.sync();case 17:if(!s.text.trim()){e.next=26;break}if(d="",!(u.items.length>0)){e.next=25;break}return(m=u.items[0]).body.load("text"),e.next=24,t.sync();case 24:d=m.body.text;case 25:r.push({text:s.text.trim(),bold:s.font.bold,italic:s.font.italic,underline:"None"!==s.font.underline,color:s.font.color||null,highlightColor:s.font.highlightColor||null,size:s.font.size||null,fontName:s.font.name||null,footnoteText:d||null,hyperlink:s.hyperlink?s.hyperlink:null});case 26:e.next=9;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(7),c.e(e.t0);case 33:return e.prev=33,c.f(),e.finish(33);case 36:return e.abrupt("return",r);case 37:case"end":return e.stop()}}),e,null,[[7,30,33,36]])})))).apply(this,arguments)}function h(e,t,n,a){return b.apply(this,arguments)}function b(){return(b=d(i().mark((function e(t,n,a,r){var o,c,l,s,u,d,m,p,g,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.clear(),e.next=3,t.sync();case 3:return o={bold:!1,italic:!1,underline:!1,color:"black",highlightColor:null,size:11,fontName:"Calibri"},n.font.bold=o.bold,n.font.italic=o.italic,n.font.underline=o.underline?"Single":"None",n.font.color=o.color||"black",n.font.highlightColor=o.highlightColor||null,n.font.size=o.size||11,n.font.name=o.fontName||"Calibri",e.next=13,t.sync();case 13:c=a.split(/\s+/),l=new Map,Array.isArray(r)&&r.length>0?r.forEach((function(e,t){var n="".concat(e.text,"-").concat(t);l.set(n,e)})):console.warn("Нет валидных данных форматирования. Применяется только базовое форматирование."),s=0,u=0;case 18:if(!(u<c.length)){e.next=30;break}if(d=c[u],m=n.insertText(d,Word.InsertLocation.end),p="".concat(d,"-").concat(s),g=l.get(p)){for(f in g)"text"!==f&&("bold"===f&&(m.font.bold=g[f]),"italic"===f&&(m.font.italic=g[f]),"underline"===f&&(m.font.underline=g[f]?"Single":"None"),"color"===f&&(m.font.color=g[f]),"highlightColor"===f&&(m.font.highlightColor=g[f]),"size"===f&&(m.font.size=g[f]),"fontName"===f&&(m.font.name=g[f]),"hyperlink"===f&&(m.hyperlink=g[f]),"footnoteText"===f&&g[f]&&m.insertFootnote().body.insertText(g[f],Word.InsertLocation.start));s++}return u<c.length-1&&n.insertText(" ",Word.InsertLocation.end),e.next=27,t.sync();case 27:u++,e.next=18;break;case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t,n,a){var r=document.getElementById("fuuga_selected-text-info"),o="<h3>Анализ выделенного текста:</h3>";e.forEach((function(e,r){o+="<h4>Слово ".concat(r+1,": ").concat(e.text,"</h4>"),o+="<p>\n          ".concat(e.bold?"✅":"❌"," <strong>Жирный</strong><br>\n          ").concat(e.italic?"✅":"❌"," <em>Курсив</em><br>\n          ").concat(e.underline?"✅":"❌"," <u>Подчеркнутый</u><br>\n          ").concat(e.color!==t&&"default"!==e.color?"✅ Особый цвет: ".concat(e.color):"❌ Основной цвет","<br>\n          ").concat(e.highlightColor?"✅ Выделение: ".concat(e.highlightColor):"❌ Без выделения","<br>\n          ").concat(e.footnoteText?"✅ Есть сноска: ".concat(e.footnoteText):"❌ Без сноски","<br>\n          ").concat(e.fontName!==n&&"default"!==e.fontName?"✅ Особый шрифт: ".concat(e.fontName):"❌ Основной шрифт: ".concat(n),"<br>\n          ").concat(e.size!=a&&"default"!==e.size?"✅ Особый размер: ".concat(e.size):"❌ Основной размер: ".concat(a),"<br>\n          ").concat(e.hyperlink?'✅ Ссылка: <a href="'.concat(e.hyperlink,'" target="_blank">').concat(e.hyperlink,"</a>"):"❌ Без ссылки","\n        </p>")})),r.innerHTML=o}function x(e,t){return e.map((function(e){var n={text:e.text},a=!1;for(var r in t)void 0!==e[r]&&e[r]!==t[r]&&(n[r]=e[r],a=!0);return a?n:null})).filter((function(e){return null!==e}))}function _(e,t,n,a,r,o,c){return k.apply(this,arguments)}function k(){return(k=d(i().mark((function e(t,n,a,r,o,c,l){var s,u,d,m,p,g,f,v,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=localStorage.getItem("apiKey"),u=I(t),d=x(t,u),m='\nИсходный текст: "'.concat(n,'"\nИзменённый текст: "').concat(a,'"\n\nСписок слов с уникальным форматированием из исходного текста:\n').concat(JSON.stringify(d,null,2),"\n\nБазовое форматирование (применяется ко всему тексту по умолчанию):\n").concat(JSON.stringify(u,null,2),'\n\nТвоя задача:\n1. Найди соответствия для слов с уникальным форматированием в изменённом тексте, учитывая возможные изменения слов (например, перевод).\n2. Верни список слов из изменённого текста с применимым уникальным форматированием.\n3. Если какое-то уникальное форматирование не применимо в изменённом тексте, опусти его.\n\nВерни **только** валидный JSON-массив, где каждый объект содержит:\n- text: string - слово из изменённого текста с уникальным форматированием\n- свойства форматирования, отличающиеся от базовых значений\n\nПример ответа:\n[\n  { "text": "Hi", "italic": true },\n  { "text": "Danil", "bold": true },\n  { "text": "20", "size": 20 }\n]\n'),p={model:r,messages:[{role:"system",content:"Ты - AI помощник по форматированию текста. Твоя задача - сопоставить слова с уникальным форматированием из исходного текста с соответствующими словами в изменённом тексте, даже если слова изменились (например, при переводе). Верни список слов из изменённого текста с их уникальным форматированием."},{role:"user",content:m}],temperature:o,max_tokens:c},e.prev=6,e.next=9,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word Text Formatter"},body:JSON.stringify(p),signal:l});case 9:if((g=e.sent).ok){e.next=12;break}throw new Error("HTTP error! status: ".concat(g.status));case 12:return e.next=14,g.json();case 14:if(f=e.sent,console.log("Ответ от сервера (форматирование):",f.choices[0].message.content.trim()),v=f.choices[0].message.content.trim(),e.prev=17,h=JSON.parse(v),Array.isArray(h)){e.next=21;break}throw new Error("Response is not an array");case 21:e.next=27;break;case 23:throw e.prev=23,e.t0=e.catch(17),console.error("Ошибка при парсинге ответа модели:",e.t0),e.t0;case 27:return e.abrupt("return",h);case 30:if(e.prev=30,e.t1=e.catch(6),"AbortError"!==e.t1.name){e.next=37;break}throw console.log("Запрос был отменен."),e.t1;case 37:throw console.error("Error in getUpdatedFormattingInfo:",e.t1),e.t1;case 39:case"end":return e.stop()}}),e,null,[[6,30],[17,23]])})))).apply(this,arguments)}function I(e){var t={bold:{},italic:{},underline:{},color:{},highlightColor:{},size:{},fontName:{}};e.forEach((function(e){for(var n in t){var a=void 0!==e[n]?e[n]:null;t[n][a]=(t[n][a]||0)+1}}));var n={};for(var a in t)n[a]=Object.entries(t[a]).reduce((function(e,t){return e[1]>=t[1]?e:t}))[0],"true"===n[a]?n[a]=!0:"false"===n[a]?n[a]=!1:"null"===n[a]?n[a]=null:"size"===a&&null!==n[a]&&(n[a]=parseFloat(n[a]));return n}var E=null;function S(){document.getElementById("home").innerHTML='\n      <div class="mt-3">\n          \x3c!-- Navigation Tabs --\x3e\n          <ul class="nav nav-tabs" id="fuuga_homeTab" role="tablist">\n              <li class="nav-item">\n                  <a class="nav-link active" id="fuuga_main-tab" data-toggle="tab" href="#fuuga_mainContent" role="tab" aria-controls="fuuga_mainContent" aria-selected="true">\n                      <i class="fas fa-home"></i> Основное\n                  </a>\n              </li>\n              <li class="nav-item">\n                  <a class="nav-link" id="fuuga_multiprompt-tab" data-toggle="tab" href="#fuuga_multipromptContent" role="tab" aria-controls="fuuga_multipromptContent" aria-selected="false">\n                      <i class="fas fa-layer-group"></i> Мультипромпт\n                  </a>\n              </li>\n              <li class="nav-item">\n                  <a class="nav-link" id="fuuga_settings-tab" data-toggle="tab" href="#fuuga_settingsContent" role="tab" aria-controls="fuuga_settingsContent" aria-selected="false">\n                      <i class="fas fa-cog"></i> Настройки\n                  </a>\n              </li>\n              <li class="nav-item">\n                  <a class="nav-link" id="fuuga_presets-tab" data-toggle="tab" href="#fuuga_presetsContent" role="tab" aria-controls="fuuga_presetsContent" aria-selected="false">\n                      <i class="fas fa-save"></i> Пресеты\n                  </a>\n              </li>\n              <li class="nav-item">\n                  <a class="nav-link" id="fuuga_tools-tab" data-toggle="tab" href="#fuuga_toolsContent" role="tab" aria-controls="fuuga_toolsContent" aria-selected="false">\n                      <i class="fas fa-tools"></i> Инструменты\n                  </a>\n              </li>\n          </ul>\n          \x3c!-- Tab Contents --\x3e\n          <div class="tab-content" id="fuuga_homeTabContent">\n              \x3c!-- Main Content --\x3e\n              <div class="tab-pane fade show active" id="fuuga_mainContent" role="tabpanel" aria-labelledby="fuuga_main-tab">\n                  <div class="mt-3">\n                      \x3c!-- Instruction --\x3e\n                      <div class="alert alert-info">\n                          <strong>Инструкция:</strong>\n                          <ul>\n                              <li>Выберите промпт, который вы хотите применить к тексту.</li>\n                              <li>Выделите текст, который хотите обработать.</li>\n                              <li>Нажмите кнопку "Обработать".</li>\n                          </ul>\n                      </div>\n                      \x3c!-- Prompt Selection --\x3e\n                      <div class="form-group">\n                          <label for="fuuga_prompt-select">Выберите промпт:</label>\n                          <select id="fuuga_prompt-select" class="form-control"></select>\n                      </div>\n                      <div id="fuuga_selected-model" class="mt-2"></div>\n                      \x3c!-- Process Button --\x3e\n                      <button id="fuuga_process-text" class="btn btn-primary mt-3" disabled><i class="fas fa-play"></i> Обработать</button>\n                      \x3c!-- Cancel Button --\x3e\n                      <button id="fuuga_cancel-process" class="btn btn-secondary mt-3" style="display: none;"><i class="fas fa-stop"></i> Отменить</button>\n                      \x3c!-- Loading Indicator --\x3e\n                      <div id="fuuga_loading" class="mt-3 text-center" style="display: none;">\n                          \x3c!-- Processing statuses at the top --\x3e\n                          <div id="fuuga_current-step-spinner" class="mt-2 font-weight-bold"></div>\n                          <div id="fuuga_current-step" class="mt-2 font-weight-bold"></div>\n                          <div id="fuuga_progress-container" style="display: none;">\n                              <div class="progress">\n                                  <div id="fuuga_progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>\n                              </div>\n                              <div id="fuuga_progress-text" class="mt-2">Обработано 0 из 0 чанков</div>\n                          </div>\n                          <div id="fuuga_spinner" style="display: none;">\n                              <div class="spinner-border text-primary" role="status">\n                                  <span class="sr-only">Загрузка...</span>\n                              </div>\n                          </div>\n                      </div>\n                      \x3c!-- Logger Output --\x3e\n                      <div id="fuuga_logger-output" class="mt-3"></div>\n                      \x3c!-- Results --\x3e\n                      <div id="fuuga_home-results" class="mt-3"></div>\n                  </div>\n              </div>\n              \x3c!-- Multiprompt Content --\x3e\n              <div class="tab-pane fade" id="fuuga_multipromptContent" role="tabpanel" aria-labelledby="fuuga_multiprompt-tab">\n                  \x3c!-- Sub Tabs for Multiprompt --\x3e\n                  <ul class="nav nav-tabs mt-3" id="fuuga_multipromptSubTab" role="tablist">\n                      <li class="nav-item">\n                          <a class="nav-link active" id="fuuga_multiprompt-main-tab" data-toggle="tab" href="#fuuga_multipromptMainContent" role="tab" aria-controls="fuuga_multipromptMainContent" aria-selected="true">\n                              <i class="fas fa-list"></i> Основное\n                          </a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_multiprompt-visualization-tab" data-toggle="tab" href="#fuuga_multipromptVisualizationContent" role="tab" aria-controls="fuuga_multipromptVisualizationContent" aria-selected="false">\n                              <i class="fas fa-eye"></i> Визуализация\n                          </a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_multiprompt-logger-tab" data-toggle="tab" href="#fuuga_multipromptLoggerContent" role="tab" aria-controls="fuuga_multipromptLoggerContent" aria-selected="false" style="display: none;">\n                              <i class="fas fa-file-alt"></i> Логер\n                          </a>\n                      </li>\n                  </ul>\n                  \x3c!-- Content of Multiprompt Sub Tabs --\x3e\n                  <div class="tab-content" id="fuuga_multipromptSubTabContent">\n                      \x3c!-- Multiprompt Main Content --\x3e\n                      <div class="tab-pane fade show active" id="fuuga_multipromptMainContent" role="tabpanel" aria-labelledby="fuuga_multiprompt-main-tab">\n                          <div class="mt-3">\n                              \x3c!-- Instruction --\x3e\n                              <div class="alert alert-info">\n                                  <strong>Мультипромпт:</strong>\n                                  <p>Здесь вы можете выбрать последовательность промптов для обработки текста.</p>\n                                  <ul>\n                                      <li>Выберите один или несколько промптов из списка.</li>\n                                      <li>Установите порядок выполнения с помощью стрелок или перетаскивания.</li>\n                                      <li>Нажмите кнопку "Обработать с мультипромптом".</li>\n                                  </ul>\n                              </div>\n                              \x3c!-- Multiprompt Selection --\x3e\n                              <div class="form-group">\n                                  <label for="fuuga_multiprompt-select">Выберите промпты и установите порядок:</label>\n                                  <select id="fuuga_multiprompt-select" class="form-control" multiple></select>\n                                  <small class="form-text text-muted">Выберите промпты и используйте список ниже для управления порядком.</small>\n                              </div>\n                              \x3c!-- Selected Prompts List --\x3e\n                              <ul id="fuuga_selected-prompts-list" class="list-group mt-2"></ul>\n                              <button id="fuuga_process-multiprompt-text" class="btn btn-primary mt-3" disabled><i class="fas fa-play"></i> Обработать с мультипромптом</button>\n                              \x3c!-- Cancel Button --\x3e\n                              <button id="fuuga_cancel-multiprompt-process" class="btn btn-secondary mt-3" style="display: none;"><i class="fas fa-stop"></i> Отменить</button>\n                              \x3c!-- Loading Indicator --\x3e\n                              <div id="fuuga_multiprompt-loading" class="mt-3 text-center" style="display: none;">\n                                  \x3c!-- Processing statuses at the top --\x3e\n                                  <div id="fuuga_multiprompt-current-step-spinner" class="mt-2 font-weight-bold"></div>\n                                  <div id="fuuga_multiprompt-current-step" class="mt-2 font-weight-bold"></div>\n                                  <div id="fuuga_multiprompt-progress-container" style="display: none;">\n                                      <div class="progress">\n                                          <div id="fuuga_multiprompt-progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>\n                                      </div>\n                                      <div id="fuuga_multiprompt-progress-text" class="mt-2">Обработано 0 из 0 шагов</div>\n                                  </div>\n                                  <div id="fuuga_multiprompt-spinner" style="display: none;">\n                                      <div class="spinner-border text-primary" role="status">\n                                          <span class="sr-only">Загрузка...</span>\n                                      </div>\n                                  </div>\n                              </div>\n                              \x3c!-- Results --\x3e\n                              <div id="fuuga_multiprompt-results" class="mt-3"></div>\n                          </div>\n                      </div>\n                      \x3c!-- Multiprompt Visualization Content --\x3e\n                      <div class="tab-pane fade" id="fuuga_multipromptVisualizationContent" role="tabpanel" aria-labelledby="fuuga_multiprompt-visualization-tab">\n                          <div class="mt-3">\n                              \x3c!-- Visualization --\x3e\n                              <div id="fuuga_multiprompt-flow" class="mt-3"></div>\n                          </div>\n                      </div>\n                      \x3c!-- Multiprompt Logger Content --\x3e\n                      <div class="tab-pane fade" id="fuuga_multipromptLoggerContent" role="tabpanel" aria-labelledby="fuuga_multiprompt-logger-tab">\n                          <div class="mt-3">\n                              \x3c!-- Logger Output --\x3e\n                              <div id="fuuga_multiprompt-logger-output" class="mt-3"></div>\n                          </div>\n                      </div>\n                  </div>\n              </div>\n              \x3c!-- Settings Content --\x3e\n              <div class="tab-pane fade" id="fuuga_settingsContent" role="tabpanel" aria-labelledby="fuuga_settings-tab">\n                  \x3c!-- Instructions for Settings --\x3e\n                  <div class="alert alert-info mt-3">\n                      <strong>Инструкция:</strong>\n                      <p>Здесь вы можете настроить параметры обработки текста, модели, форматирования и логирования.</p>\n                  </div>\n                  \x3c!-- Sub Tabs for Settings --\x3e\n                  <ul class="nav nav-tabs mt-3" id="fuuga_settingsSubTab" role="tablist">\n                      <li class="nav-item">\n                          <a class="nav-link active" id="fuuga_text-processing-tab" data-toggle="tab" href="#fuuga_textProcessingContent" role="tab" aria-controls="fuuga_textProcessingContent" aria-selected="true"><i class="fas fa-file-alt"></i> Настройки обработки текста</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_model-settings-tab" data-toggle="tab" href="#fuuga_modelSettingsContent" role="tab" aria-controls="fuuga_modelSettingsContent" aria-selected="false"><i class="fas fa-brain"></i> Настройки модели</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_formatting-settings-tab" data-toggle="tab" href="#fuuga_formattingSettingsContent" role="tab" aria-controls="fuuga_formattingSettingsContent" aria-selected="false"><i class="fas fa-font"></i> Параметры форматирования</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_logger-settings-tab" data-toggle="tab" href="#fuuga_loggerSettingsContent" role="tab" aria-controls="fuuga_loggerSettingsContent" aria-selected="false"><i class="fas fa-clipboard-list"></i> Настройки логера</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_misc-settings-tab" data-toggle="tab" href="#fuuga_miscSettingsContent" role="tab" aria-controls="fuuga_miscSettingsContent" aria-selected="false"><i class="fas fa-sliders-h"></i> Разное</a>\n                      </li>\n                  </ul>\n                  \x3c!-- Content of Settings Sub Tabs --\x3e\n                  <div class="tab-content" id="fuuga_settingsSubTabContent">\n                      \x3c!-- Text Processing Settings --\x3e\n                      <div class="tab-pane fade show active" id="fuuga_textProcessingContent" role="tabpanel" aria-labelledby="fuuga_text-processing-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете настроить параметры обработки текста, такие как максимальное количество символов и разбивка на чанки.</p>\n                          </div>\n                          \x3c!-- Maximum characters --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_max-chars">Максимальное количество символов для обработки (0 для без лимита):</label>\n                              <input type="number" id="fuuga_max-chars" class="form-control" value="2000" min="0">\n                          </div>\n                          \x3c!-- Split into chunks --\x3e\n                          <div class="form-check mt-2">\n                              <input class="form-check-input" type="checkbox" id="fuuga_split-into-chunks-checkbox">\n                              <label class="form-check-label" for="fuuga_split-into-chunks-checkbox" title="Разбивать текст на небольшие части для обработки">\n                                  Разбивать текст на чанки\n                              </label>\n                          </div>\n                          \x3c!-- Chunk size --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_chunk-size">Размер чанка (в предложениях):</label>\n                              <input type="number" id="fuuga_chunk-size" class="form-control" value="8" min="1">\n                          </div>\n                      </div>\n                      \x3c!-- Model Settings --\x3e\n                      <div class="tab-pane fade" id="fuuga_modelSettingsContent" role="tabpanel" aria-labelledby="fuuga_model-settings-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете настроить параметры модели, такие как температура и максимальное количество токенов.</p>\n                          </div>\n                          \x3c!-- Температура --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_temperature">Температура (0.0 - 1.0):</label>\n                              <input type="number" id="fuuga_temperature" class="form-control" value="0.5" min="0.0" max="1.0" step="0.1" title="Контролирует степень случайности модели. Низкие значения делают ответы более детерминированными">\n                          </div>\n                          \x3c!-- Максимальное количество токенов --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_max-tokens">Максимальное количество токенов:</label>\n                              <input type="number" id="fuuga_max-tokens" class="form-control" value="4000" min="1" title="Максимальное количество токенов в ответе модели">\n                          </div>\n                      </div>\n                      \x3c!-- Formatting Settings --\x3e\n                      <div class="tab-pane fade" id="fuuga_formattingSettingsContent" role="tabpanel" aria-labelledby="fuuga_formatting-settings-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете настроить параметры форматирования текста.</p>\n                          </div>\n                          \x3c!-- Apply Formatting --\x3e\n                          <div class="form-check mt-2">\n                              <input type="checkbox" class="form-check-input" id="fuuga_apply-formatting">\n                              <label class="form-check-label" for="fuuga_apply-formatting">Применять форматирование</label>\n                          </div>\n                          \x3c!-- Formatting Model --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_formatting-model">Модель для форматирования:</label>\n                              <select id="fuuga_formatting-model" class="form-control"></select>\n                          </div>\n                          \x3c!-- Formatting Temperature --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_formatting-temperature">Температура для форматирования (0.0 - 1.0):</label>\n                              <input type="number" id="fuuga_formatting-temperature" class="form-control" value="0.5" min="0.0" max="1.0" step="0.1" title="Контролирует степень случайности модели при форматировании">\n                          </div>\n                          \x3c!-- Formatting Max Tokens --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_formatting-max-tokens">Максимальное количество токенов для форматирования:</label>\n                              <input type="number" id="fuuga_formatting-max-tokens" class="form-control" value="1000" min="1" title="Максимальное количество токенов в ответе модели при форматировании">\n                          </div>\n                      </div>\n                      \x3c!-- Logger Settings --\x3e\n                      <div class="tab-pane fade" id="fuuga_loggerSettingsContent" role="tabpanel" aria-labelledby="fuuga_logger-settings-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете настроить параметры логирования.</p>\n                          </div>\n                          \x3c!-- Enable Logger --\x3e\n                          <div class="form-check mt-2">\n                              <input type="checkbox" class="form-check-input" id="fuuga_enable-logger">\n                              <label class="form-check-label" for="fuuga_enable-logger">Включить логирование</label>\n                          </div>\n                          \x3c!-- Logger Level --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_logger-level">Уровень логирования:</label>\n                              <select id="fuuga_logger-level" class="form-control">\n                                  <option value="minimal">Минимальный</option>\n                                  <option value="medium">Средний</option>\n                                  <option value="maximal">Максимальный</option>\n                                  <option value="custom">Пользовательский</option>\n                              </select>\n                          </div>\n                          \x3c!-- Custom Logger Prompt --\x3e\n                          <div class="mt-2" id="fuuga_custom-logger-prompt-container" style="display: none;">\n                              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#fuuga_customLoggerPromptCollapse" aria-expanded="false" aria-controls="fuuga_customLoggerPromptCollapse">\n                                  Настроить пользовательский промпт\n                              </button>\n                              <div class="collapse" id="fuuga_customLoggerPromptCollapse">\n                                  <div class="card card-body">\n                                      <div class="form-group">\n                                          <label for="fuuga_custom-logger-prompt">Пользовательский промпт для логера:</label>\n                                          <textarea id="fuuga_custom-logger-prompt" class="form-control" rows="5" placeholder="Введите ваш пользовательский промпт здесь..."></textarea>\n                                          <small class="form-text text-muted">Используйте {{beforeText}} и {{afterText}} для вставки исходного и обработанного текста соответственно. Пример: "Проанализируй изменения между {{beforeText}} и {{afterText}}"</small>\n                                      </div>\n                                  </div>\n                              </div>\n                          </div>\n                          \x3c!-- Logger Model --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_logger-model">Модель для логирования:</label>\n                              <select id="fuuga_logger-model" class="form-control"></select>\n                          </div>\n                          \x3c!-- Logger Temperature --\x3e\n                          <div class="form-group mt-2">\n                              <label for="fuuga_logger-temperature">Температура для логирования (0.0 - 1.0):</label>\n                              <input type="number" id="fuuga_logger-temperature" class="form-control" value="0.3" min="0.0" max="1.0" step="0.1" title="Контролирует степень случайности модели при логировании">\n                          </div>\n                          \x3c!-- Logger Max Tokens --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_logger-max-tokens">Максимальное количество токенов для логирования:</label>\n                              <input type="number" id="fuuga_logger-max-tokens" class="form-control" value="500" min="1" title="Максимальное количество токенов в ответе модели при логировании">\n                          </div>\n                          \x3c!-- Logger Prompts Edit --\x3e\n                          <div class="form-check mt-2">\n                              <input type="checkbox" class="form-check-input" id="fuuga_edit-logger-prompts">\n                              <label class="form-check-label" for="fuuga_edit-logger-prompts">Редактировать промпты логера</label>\n                          </div>\n                          <div id="fuuga_logger-prompts-accordion" class="mt-3" style="display: none;">\n                              <div class="accordion" id="fuuga_loggerPromptsAccordion">\n                                  \x3c!-- Minimal Level Prompt --\x3e\n                                  <div class="card">\n                                      <div class="card-header" id="fuuga_headingMinimalPrompt">\n                                          <h2 class="mb-0">\n                                              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#fuuga_collapseMinimalPrompt" aria-expanded="true" aria-controls="fuuga_collapseMinimalPrompt">\n                                                  Промпт для минимального уровня\n                                              </button>\n                                          </h2>\n                                      </div>\n                                      <div id="fuuga_collapseMinimalPrompt" class="collapse" aria-labelledby="fuuga_headingMinimalPrompt" data-parent="#fuuga_loggerPromptsAccordion">\n                                          <div class="card-body">\n                                              <textarea id="fuuga_logger-prompt-minimal" class="form-control" rows="5"></textarea>\n                                          </div>\n                                      </div>\n                                  </div>\n                                  \x3c!-- Medium Level Prompt --\x3e\n                                  <div class="card">\n                                      <div class="card-header" id="fuuga_headingMediumPrompt">\n                                          <h2 class="mb-0">\n                                              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#fuuga_collapseMediumPrompt" aria-expanded="false" aria-controls="fuuga_collapseMediumPrompt">\n                                                  Промпт для среднего уровня\n                                              </button>\n                                          </h2>\n                                      </div>\n                                      <div id="fuuga_collapseMediumPrompt" class="collapse" aria-labelledby="fuuga_headingMediumPrompt" data-parent="#fuuga_loggerPromptsAccordion">\n                                          <div class="card-body">\n                                              <textarea id="fuuga_logger-prompt-medium" class="form-control" rows="5"></textarea>\n                                          </div>\n                                      </div>\n                                  </div>\n                                  \x3c!-- Maximal Level Prompt --\x3e\n                                  <div class="card">\n                                      <div class="card-header" id="fuuga_headingMaximalPrompt">\n                                          <h2 class="mb-0">\n                                              <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#fuuga_collapseMaximalPrompt" aria-expanded="false" aria-controls="fuuga_collapseMaximalPrompt">\n                                                  Промпт для максимального уровня\n                                              </button>\n                                          </h2>\n                                      </div>\n                                      <div id="fuuga_collapseMaximalPrompt" class="collapse" aria-labelledby="fuuga_headingMaximalPrompt" data-parent="#fuuga_loggerPromptsAccordion">\n                                          <div class="card-body">\n                                              <textarea id="fuuga_logger-prompt-maximal" class="form-control" rows="5"></textarea>\n                                          </div>\n                                      </div>\n                                  </div>\n                              </div>\n                              \x3c!-- Reset Logger Prompts Button --\x3e\n                              <button id="fuuga_reset-logger-prompts" class="btn btn-secondary mt-3">Сбросить промпты логера</button>\n                              <div id="fuuga_logger-prompt-message" class="mt-2"></div>\n                          </div>\n                      </div>\n                      \x3c!-- Misc Settings --\x3e\n                      <div class="tab-pane fade" id="fuuga_miscSettingsContent" role="tabpanel" aria-labelledby="fuuga_misc-settings-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете сбросить настройки до значений по умолчанию.</p>\n                          </div>\n                          <button id="fuuga_reset-settings" class="btn btn-danger mt-3">Сбросить до настроек по умолчанию</button>\n                      </div>\n                  </div>\n              </div>\n              \x3c!-- Presets Content --\x3e\n              <div class="tab-pane fade" id="fuuga_presetsContent" role="tabpanel" aria-labelledby="fuuga_presets-tab">\n                  \x3c!-- Instructions for Presets --\x3e\n                  <div class="alert alert-info mt-3">\n                      <strong>Инструкция:</strong>\n                      <p>Здесь вы можете сохранять, экспортировать и импортировать ваши настройки в виде пресетов.</p>\n                  </div>\n                  \x3c!-- Presets Sub Tabs --\x3e\n                  <ul class="nav nav-tabs mt-3" id="fuuga_presetsSubTab" role="tablist">\n                      <li class="nav-item">\n                          <a class="nav-link active" id="fuuga_save-preset-tab" data-toggle="tab" href="#fuuga_savePresetContent" role="tab" aria-controls="fuuga_savePresetContent" aria-selected="true">Сохранить</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_-preset-tab" data-toggle="tab" href="#fuuga_PresetContent" role="tab" aria-controls="fuuga_PresetContent" aria-selected="false">Экспорт</a>\n                      </li>\n                      <li class="nav-item">\n                          <a class="nav-link" id="fuuga_import-preset-tab" data-toggle="tab" href="#fuuga_importPresetContent" role="tab" aria-controls="fuuga_importPresetContent" aria-selected="false">Импорт</a>\n                      </li>\n                  </ul>\n                  \x3c!-- Presets Sub Tab Content --\x3e\n                  <div class="tab-content" id="fuuga_presetsSubTabContent">\n                      \x3c!-- Save Preset --\x3e\n                      <div class="tab-pane fade show active" id="fuuga_savePresetContent" role="tabpanel" aria-labelledby="fuuga_save-preset-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете сохранить текущие настройки как пресет.</p>\n                          </div>\n                          \x3c!-- Preset Selection --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_preset-select">Выберите пресет:</label>\n                              <select id="fuuga_preset-select" class="form-control"></select>\n                          </div>\n                          \x3c!-- Preset Name --\x3e\n                          <div class="form-group">\n                              <label for="fuuga_preset-name">Название пресета для сохранения:</label>\n                              <input type="text" id="fuuga_preset-name" class="form-control" placeholder="Введите название пресета">\n                          </div>\n                          \x3c!-- Preset Buttons --\x3e\n                          <div class="form-group mt-3">\n                              <button id="fuuga_save-preset" class="btn btn-primary">Сохранить текущие настройки как пресет</button>\n                              <button id="fuuga_delete-preset" class="btn btn-danger">Удалить выбранный пресет</button>\n                          </div>\n                          \x3c!-- Preset Messages and Confirmation --\x3e\n                          <div id="fuuga_preset-confirmation" class="mt-2" style="display:none;">\n                              <div class="alert alert-warning">\n                                  <p id="fuuga_preset-confirmation-message"></p>\n                                  <button id="fuuga_preset-confirm-yes" class="btn btn-danger">Да</button>\n                                  <button id="fuuga_preset-confirm-no" class="btn btn-secondary">Нет</button>\n                              </div>\n                          </div>\n                          <div id="fuuga_preset-message" class="mt-2"></div>\n                      </div>\n                      \x3c!--  Preset --\x3e\n                      <div class="tab-pane fade" id="fuuga_PresetContent" role="tabpanel" aria-labelledby="fuuga_-preset-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете экспортировать выбранный пресет в формате JSON.</p>\n                          </div>\n                          <label for="fuuga_preset-json">Экспорт пресета (JSON):</label>\n                          <textarea id="fuuga_preset-json" class="form-control" rows="5" readonly></textarea>\n                          <button id="fuuga_copy-preset-json" class="btn btn-secondary mt-2">Скопировать JSON</button>\n                      </div>\n                      \x3c!-- Import Preset --\x3e\n                      <div class="tab-pane fade" id="fuuga_importPresetContent" role="tabpanel" aria-labelledby="fuuga_import-preset-tab">\n                          <div class="alert alert-info mt-3">\n                              <p>Здесь вы можете импортировать пресет из JSON.</p>\n                          </div>\n                          <label for="fuuga_preset-json-import">Импорт пресета (JSON):</label>\n                          <textarea id="fuuga_preset-json-import" class="form-control" rows="5"></textarea>\n                          <button id="fuuga_import-preset" class="btn btn-secondary mt-2">Импортировать пресет</button>\n                      </div>\n                  </div>\n              </div>\n              \x3c!-- Tools Content --\x3e\n              <div class="tab-pane fade" id="fuuga_toolsContent" role="tabpanel" aria-labelledby="fuuga_tools-tab">\n                  \x3c!-- Instructions for Tools --\x3e\n                  <div class="alert alert-info mt-3">\n                      <strong>Инструменты:</strong>\n                      <p>Здесь вы можете получить информацию о выделенном тексте.</p>\n                  </div>\n                  <button id="fuuga_show-selected-text" class="btn btn-info mt-3"><i class="fas fa-info-circle"></i> Показать информацию о выделенном тексте</button>\n                  <div id="fuuga_selected-text-info" class="mt-3"></div>\n              </div>\n          </div>\n      </div>\n  ',$('#fuuga_homeTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$('#fuuga_settingsSubTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$('#fuuga_multipromptSubTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$('#fuuga_presetsSubTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$("#fuuga_prompt-select").select2({width:"100%",placeholder:"Выберите промпт",templateResult:w,templateSelection:T}),$("#fuuga_multiprompt-select").select2({width:"100%",placeholder:"Выберите промпты",multiple:!0,allowClear:!0,templateResult:w,templateSelection:T}),$("#fuuga_formatting-model").select2({width:"100%",placeholder:"Выберите модель для форматирования"}),$("#fuuga_logger-model").select2({width:"100%",placeholder:"Выберите модель для логирования"}),$("#fuuga_selected-prompts-list").sortable({update:function(e,t){O(),L()}}),document.getElementById("fuuga_process-text").onclick=A,document.getElementById("fuuga_cancel-process").onclick=z,document.getElementById("fuuga_show-selected-text").onclick=ge,document.getElementById("fuuga_process-multiprompt-text").onclick=J,document.getElementById("fuuga_cancel-multiprompt-process").onclick=D,document.getElementById("fuuga_reset-settings").onclick=C,document.getElementById("fuuga_logger-level").onchange=function(){var e=document.getElementById("fuuga_logger-level").value;document.getElementById("fuuga_custom-logger-prompt-container").style.display="custom"===e?"block":"none",L()},document.getElementById("fuuga_enable-logger").onchange=function(){var e=document.getElementById("fuuga_enable-logger").checked;document.getElementById("fuuga_multiprompt-logger-tab").style.display=e?"block":"none",L()},document.getElementById("fuuga_edit-logger-prompts").onchange=function(){var e=document.getElementById("fuuga_edit-logger-prompts").checked;document.getElementById("fuuga_logger-prompts-accordion").style.display=e?"block":"none",L()},document.getElementById("fuuga_reset-logger-prompts").onclick=function(){var e;e={minimal:"Опишите кратко изменения между текстом до и после обработки.",medium:"Опишите изменения между текстом до и после обработки, упомяните ключевые изменения.",maximal:"Детально опишите все изменения между текстом до и после обработки, включая использование промпта.",custom:""},document.getElementById("fuuga_logger-prompt-minimal").value=e.minimal,document.getElementById("fuuga_logger-prompt-medium").value=e.medium,document.getElementById("fuuga_logger-prompt-maximal").value=e.maximal,document.getElementById("fuuga_custom-logger-prompt").value=e.custom,Ut(),Vt("Промпты логера сброшены к значениям по умолчанию."),se()},function(){var e=$("#fuuga_formatting-model"),t=JSON.parse(localStorage.getItem("models")||"[]");e.empty(),t.forEach((function(t){var n=new Option(t.name,t.id,!1,!1);e.append(n)})),e.trigger("change");var n=t.find((function(e){return"openai/gpt-4"===e.id}))||t[0];n&&e.val(n.id).trigger("change");var a=JSON.parse(localStorage.getItem("mainSettings")||"{}").formattingModel;a&&t.some((function(e){return e.id===a}))&&e.val(a).trigger("change")}(),function(){var e=$("#fuuga_logger-model"),t=JSON.parse(localStorage.getItem("models")||"[]");e.empty(),t.forEach((function(t){var n=new Option(t.name,t.id,!1,!1);e.append(n)})),e.trigger("change");var n=t.find((function(e){return"openai/gpt-4"===e.id}))||t[0];n&&e.val(n.id).trigger("change");var a=JSON.parse(localStorage.getItem("mainSettings")||"{}").loggerModel;a&&t.some((function(e){return e.id===a}))&&e.val(a).trigger("change")}(),B(),function(){var e=$("#fuuga_multiprompt-select"),t=p();e.empty(),t.forEach((function(t,n){var a=new Option(t.name,n,!1,!1);e.append(a)}));var n=JSON.parse(localStorage.getItem("mainSettings")||"{}").lastSelectedMultipromptIndices||[];e.val(n).trigger("change"),M(n),e.off("change").on("change",(function(){M($(this).val()),L()}))}(),N(),$("#fuuga_preset-select").select2({width:"100%",placeholder:"Выберите пресет"}),re(),setInterval(P,1e3),document.getElementById("fuuga_apply-formatting").onchange=function(){L()},document.getElementById("fuuga_split-into-chunks-checkbox").onchange=function(){L()},document.getElementById("fuuga_chunk-size").onchange=function(){L()},document.getElementById("fuuga_max-chars").onchange=function(){L()},document.getElementById("fuuga_temperature").onchange=function(){L()},document.getElementById("fuuga_max-tokens").onchange=function(){L()},document.getElementById("fuuga_formatting-temperature").onchange=function(){L()},document.getElementById("fuuga_formatting-max-tokens").onchange=function(){L()},document.getElementById("fuuga_logger-temperature").onchange=function(){L()},document.getElementById("fuuga_logger-max-tokens").onchange=function(){L()},document.getElementById("fuuga_custom-logger-prompt").onchange=function(){L()},document.getElementById("fuuga_logger-prompt-minimal").onchange=function(){Ut(),se()},document.getElementById("fuuga_logger-prompt-medium").onchange=function(){Ut(),se()},document.getElementById("fuuga_logger-prompt-maximal").onchange=function(){Ut(),se()},$("#fuuga_formatting-model").on("change",(function(){L()})),$("#fuuga_logger-model").on("change",(function(){L()})),document.getElementById("fuuga_preset-select").onchange=oe,document.getElementById("fuuga_save-preset").onclick=ce,document.getElementById("fuuga_delete-preset").onclick=le,document.getElementById("fuuga_copy-preset-json").onclick=ie,document.getElementById("fuuga_import-preset").onclick=ue,N()}function B(){var e=$("#fuuga_prompt-select"),t=document.getElementById("fuuga_selected-model"),n=p();e.empty(),e.append(new Option("Выберите промпт","",!0,!0));var a=JSON.parse(localStorage.getItem("mainSettings")||"{}").lastSelectedPromptIndex||-1;n.forEach((function(t,n){var r=new Option(t.name,n,!1,n==a);e.append(r)})),e.trigger("change");var r=a>=0&&a<n.length?a:null;E=null!==r?n[r]:null,t.textContent=E?"Модель: ".concat(E.model):"",document.getElementById("fuuga_process-text").disabled=!E,e.on("change",(function(){var e=$(this).val();E=e?n[e]:null;var a=JSON.parse(localStorage.getItem("mainSettings")||"{}");a.lastSelectedPromptIndex=e||-1,localStorage.setItem("mainSettings",JSON.stringify(a)),t.textContent=E?"Модель: ".concat(E.model):"",document.getElementById("fuuga_process-text").disabled=!E,L()}))}function w(e){if(!e.id)return e.text;var t=p()[e.id];return t?$("<span>".concat(t.name," (").concat(t.model,")</span>")):e.text}function T(e){if(!e.id)return e.text;var t=p()[e.id];return t?t.name:e.text}function C(){$("body").append('\n      <div class="modal fade" id="fuuga_resetSettingsModal" tabindex="-1" role="dialog" aria-labelledby="fuuga_resetSettingsModalLabel" aria-hidden="true">\n        <div class="modal-dialog" role="document">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title" id="fuuga_resetSettingsModalLabel">Сброс настроек</h5>\n              <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">\n                <span aria-hidden="true">&times;</span>\n              </button>\n            </div>\n            <div class="modal-body">\n              Вы уверены, что хотите сбросить настройки до значений по умолчанию?\n            </div>\n            <div class="modal-footer">\n              <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>\n              <button type="button" class="btn btn-danger" id="fuuga_confirmResetSettings">Сбросить</button>\n            </div>\n          </div>\n        </div>\n      </div>\n  '),$("#fuuga_resetSettingsModal").modal("show"),$("#fuuga_confirmResetSettings").on("click",(function(){var e;resetHomeSettings(),$("#fuuga_resetSettingsModal").modal("hide"),$("#fuuga_resetSettingsModal").remove(),e='\n      <div class="alert alert-'.concat("success",' alert-dismissible fade show mt-3" role="alert">\n          ').concat("Настройки были сброшены до значений по умолчанию.",'\n          <button type="button" class="close" data-dismiss="alert" aria-label="Закрыть">\n              <span aria-hidden="true">&times;</span>\n          </button>\n      </div>\n  '),$("#fuuga_miscSettingsContent").prepend(e)})),$("#fuuga_resetSettingsModal").on("hidden.bs.modal",(function(){$("#fuuga_resetSettingsModal").remove()}))}function P(){Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:a=document.getElementById("fuuga_process-text"),r=document.getElementById("fuuga_process-multiprompt-text"),o=$("#fuuga_multiprompt-select").val(),n.text.trim().length>0&&E?a.disabled=!1:a.disabled=!0,n.text.trim().length>0&&o&&o.length>0?r.disabled=!1:r.disabled=!0;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function M(e){var t=p(),n=document.getElementById("fuuga_selected-prompts-list");n.innerHTML="",Array.isArray(e)||(e=e?[e]:[]),e.forEach((function(e){if(""!==e){var a=parseInt(e,10);if(!isNaN(a)){var r=t[a];if(r){var o=document.createElement("li");o.className="list-group-item d-flex justify-content-between align-items-center",o.dataset.promptIndex=a,o.innerHTML="\n          <div>\n              <span>".concat(r.name,'</span>\n              <span class="badge badge-secondary ml-2">').concat(r.model,'</span>\n          </div>\n          <div>\n              <button class="btn btn-sm btn-secondary move-up"><i class="fas fa-arrow-up"></i></button>\n              <button class="btn btn-sm btn-secondary move-down"><i class="fas fa-arrow-down"></i></button>\n              <button class="btn btn-sm btn-danger remove-prompt"><i class="fas fa-times"></i></button>\n          </div>\n      '),n.appendChild(o)}}}})),n.querySelectorAll(".move-up").forEach((function(e){e.addEventListener("click",(function(){var e=this.closest("li");e.previousElementSibling&&(e.parentNode.insertBefore(e,e.previousElementSibling),O(),L())}))})),n.querySelectorAll(".move-down").forEach((function(e){e.addEventListener("click",(function(){var e=this.closest("li");e.nextElementSibling&&(e.parentNode.insertBefore(e.nextElementSibling,e),O(),L())}))})),n.querySelectorAll(".remove-prompt").forEach((function(e){e.addEventListener("click",(function(){var e=this.closest("li");e.parentNode.removeChild(e);var t=Array.from(n.children).map((function(e){return e.dataset.promptIndex}));$("#fuuga_multiprompt-select").val(t).trigger("change"),O(),L()}))})),O()}function O(){var e=document.getElementById("fuuga_selected-prompts-list"),t=p(),n=e.querySelectorAll("li"),a=Array.from(n).map((function(e){return e.dataset.promptIndex})),r=document.getElementById("fuuga_multiprompt-flow");r.innerHTML="";var o="fuuga_multiprompt-flow-accordion",c='<div class="accordion" id="'.concat(o,'">');c+='\n      <div class="card">\n          <div class="card-header" id="'.concat(o,'-heading-original">\n              <h2 class="mb-0">\n                  <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#').concat(o,'-collapse-original" aria-expanded="true" aria-controls="').concat(o,'-collapse-original">\n                      <i class="fas fa-file-alt"></i> Исходный текст\n                  </button>\n              </h2>\n          </div>\n          <div id="').concat(o,'-collapse-original" class="collapse" aria-labelledby="').concat(o,'-heading-original" data-parent="#').concat(o,'">\n              <div class="card-body" id="fuuga_multiprompt-original-text">\n                  Здесь будет отображаться ваш исходный текст.\n              </div>\n          </div>\n      </div>\n  '),a.forEach((function(e,n){var a=t[e],r="".concat(o,"-collapse-").concat(n);c+='\n          <div class="card">\n              <div class="card-header" id="'.concat(o,"-heading-").concat(n,'">\n                  <h2 class="mb-0">\n                      <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#').concat(r,'" aria-expanded="true" aria-controls="').concat(r,'">\n                          <i class="fas fa-bolt"></i> Шаг ').concat(n+1,": ").concat(a.name,'\n                      </button>\n                  </h2>\n              </div>\n              <div id="').concat(r,'" class="collapse" aria-labelledby="').concat(o,"-heading-").concat(n,'" data-parent="#').concat(o,'">\n                  <div class="card-body">\n                      <p><strong>Описание промпта:</strong> ').concat(a.text||"Нет описания","</p>\n                      <p><strong>Модель:</strong> ").concat(a.model,'</p>\n                      <p><strong>Результат после этого шага будет отображаться здесь после обработки.</strong></p>\n                      <div id="fuuga_multiprompt-step-result-').concat(n,'" class="mt-2"></div>\n                  </div>\n              </div>\n          </div>\n      ')})),!!JSON.parse(localStorage.getItem("mainSettings")||"{}").applyFormatting&&(c+='\n          <div class="card">\n              <div class="card-header" id="'.concat(o,'-heading-formatting">\n                  <h2 class="mb-0">\n                      <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#').concat(o,'-collapse-formatting" aria-expanded="true" aria-controls="').concat(o,'-collapse-formatting">\n                          <i class="fas fa-paint-brush"></i> Применение форматирования\n                      </button>\n                  </h2>\n              </div>\n              <div id="').concat(o,'-collapse-formatting" class="collapse" aria-labelledby="').concat(o,'-heading-formatting" data-parent="#').concat(o,'">\n                  <div class="card-body">\n                      <p>Финальный текст будет отформатирован с использованием выбранной модели форматирования.</p>\n                  </div>\n              </div>\n          </div>\n      ')),c+="</div>",r.innerHTML=c,$(".collapse").collapse()}function L(){var e=JSON.parse(localStorage.getItem("mainSettings")||"{}");e.applyFormatting=document.getElementById("fuuga_apply-formatting").checked,e.splitIntoChunks=document.getElementById("fuuga_split-into-chunks-checkbox").checked,e.chunkSize=document.getElementById("fuuga_chunk-size").value,e.maxChars=document.getElementById("fuuga_max-chars").value,e.temperature=document.getElementById("fuuga_temperature").value,e.maxTokens=document.getElementById("fuuga_max-tokens").value,e.formattingTemperature=document.getElementById("fuuga_formatting-temperature").value,e.formattingMaxTokens=document.getElementById("fuuga_formatting-max-tokens").value,e.formattingModel=$("#fuuga_formatting-model").val(),e.enableLogger=document.getElementById("fuuga_enable-logger").checked,e.loggerLevel=document.getElementById("fuuga_logger-level").value,e.customLoggerPrompt=document.getElementById("fuuga_custom-logger-prompt").value,e.loggerTemperature=document.getElementById("fuuga_logger-temperature").value,e.loggerMaxTokens=document.getElementById("fuuga_logger-max-tokens").value,e.loggerModel=$("#fuuga_logger-model").val(),e.editLoggerPrompts=document.getElementById("fuuga_edit-logger-prompts").checked;var t={};t.minimal=document.getElementById("fuuga_logger-prompt-minimal").value,t.medium=document.getElementById("fuuga_logger-prompt-medium").value,t.maximal=document.getElementById("fuuga_logger-prompt-maximal").value,e.loggerPrompts=t,localStorage.setItem("mainSettings",JSON.stringify(e)),se()}function N(){var e=JSON.parse(localStorage.getItem("mainSettings")||"{}"),t=e.applyFormatting||!1;document.getElementById("fuuga_apply-formatting").checked=t;var n=e.splitIntoChunks||!1;document.getElementById("fuuga_split-into-chunks-checkbox").checked=n;var a=e.chunkSize||8;document.getElementById("fuuga_chunk-size").value=a;var r=e.maxChars||2e3;document.getElementById("fuuga_max-chars").value=r;var o=e.temperature||.5;document.getElementById("fuuga_temperature").value=o;var c=e.maxTokens||4e3;document.getElementById("fuuga_max-tokens").value=c;var l=e.formattingTemperature||.5;document.getElementById("fuuga_formatting-temperature").value=l;var s=e.formattingMaxTokens||1e3;document.getElementById("fuuga_formatting-max-tokens").value=s;var i=e.formattingModel;i&&$("#fuuga_formatting-model").val(i).trigger("change");var u=e.enableLogger||!1;document.getElementById("fuuga_enable-logger").checked=u,document.getElementById("fuuga_multiprompt-logger-tab").style.display=u?"block":"none";var d=e.loggerLevel||"minimal";document.getElementById("fuuga_logger-level").value=d,document.getElementById("fuuga_custom-logger-prompt-container").style.display="custom"===d?"block":"none";var m=e.customLoggerPrompt||"";document.getElementById("fuuga_custom-logger-prompt").value=m;var p=e.loggerTemperature||.3;document.getElementById("fuuga_logger-temperature").value=p;var g=e.loggerMaxTokens||500;document.getElementById("fuuga_logger-max-tokens").value=g;var f=e.loggerModel;f&&$("#fuuga_logger-model").val(f).trigger("change");var v=e.editLoggerPrompts||!1;document.getElementById("fuuga_edit-logger-prompts").checked=v,document.getElementById("fuuga_logger-prompts-accordion").style.display=v?"block":"none";var h="Опишите кратко изменения между текстом до и после обработки.",b="Опишите изменения между текстом до и после обработки, упомяните ключевые изменения.",y="Детально опишите все изменения между текстом до и после обработки, включая использование промпта.",x=e.loggerPrompts||{};document.getElementById("fuuga_logger-prompt-minimal").value=x.minimal||h,document.getElementById("fuuga_logger-prompt-medium").value=x.medium||b,document.getElementById("fuuga_logger-prompt-maximal").value=x.maximal||y;var _=e.lastSelectedPromptIndex;null!=_&&$("#fuuga_prompt-select").val(_).trigger("change");var k=e.lastSelectedMultipromptIndices;k&&k.length>0&&($("#fuuga_multiprompt-select").val(k).trigger("change"),M(k))}function A(){return j.apply(this,arguments)}function j(){return j=d(i().mark((function e(){var t,n,a,r,o,c,l,s,u,m,p,g,f,v,b,y,x,_,k,I,S,B,w,T,C,P,M,O,L,N,A,j,J,H,z,R,G,D,K;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W();case 3:if(t=e.sent,E){e.next=6;break}return e.abrupt("return");case 6:if(n=document.getElementById("fuuga_split-into-chunks-checkbox").checked,a=parseInt(document.getElementById("fuuga_chunk-size").value,10)||8,document.getElementById("fuuga_home-results").innerHTML="",q(),ne(!0,n),document.getElementById("fuuga_process-text").disabled=!0,window.abortController=new AbortController,r=parseInt(document.getElementById("fuuga_max-chars").value,10)||0,!(t.text.length>0)){e.next=85;break}if(!(!n&&r>0&&t.text.length>r)){e.next=20;break}return document.getElementById("fuuga_home-results").innerHTML='<p class="text-warning">Выделенный текст слишком длинный ('.concat(t.text.length," символов). Пожалуйста, выделите меньше ").concat(r," символов или измените ограничение в настройках.</p>"),ne(!1),document.getElementById("fuuga_process-text").disabled=!1,e.abrupt("return");case 20:if(o=document.getElementById("fuuga_apply-formatting").checked,c=$("#fuuga_formatting-model").val(),l=parseFloat(document.getElementById("fuuga_formatting-temperature").value)||.5,s=parseInt(document.getElementById("fuuga_formatting-max-tokens").value,10)||1e3,u=parseFloat(document.getElementById("fuuga_temperature").value)||.5,m=parseInt(document.getElementById("fuuga_max-tokens").value,10)||4e3,p=document.getElementById("fuuga_enable-logger").checked,g=document.getElementById("fuuga_logger-level").value,f=$("#fuuga_logger-model").val(),v=parseFloat(document.getElementById("fuuga_logger-temperature").value)||.3,b=parseInt(document.getElementById("fuuga_logger-max-tokens").value,10)||500,y=document.getElementById("fuuga_custom-logger-prompt").value,x=document.getElementById("fuuga_logger-prompt-minimal").value,_=document.getElementById("fuuga_logger-prompt-medium").value,k=document.getElementById("fuuga_logger-prompt-maximal").value,I=[],S=[],B=[],!n){e.next=67;break}w=U(t.text,a),T=w.length,C=document.getElementById("fuuga_progress-bar"),P=document.getElementById("fuuga_progress-text"),M=document.getElementById("fuuga_current-step"),P.innerText="Обработано 0 из ".concat(T," чанков"),O=0;case 46:if(!(O<w.length)){e.next=65;break}return L=w[O],M.innerText="Выполняется обработка чанка ".concat(O+1),e.next=51,V(L,u,m,window.abortController.signal,o,c,l,s,E,p,g,f,v,b,y,{loggerPromptMinimal:x,loggerPromptMedium:_,loggerPromptMaximal:k},1,!0);case 51:N=e.sent,A=N.generatedText,j=N.formattingInfo,J=N.loggerOutput,I.push(A),o&&j&&(S=S.concat(j)),p&&J&&B.push(J),H=Math.round((O+1)/T*100),C.style.width="".concat(H,"%"),C.innerText="".concat(H,"%"),P.innerText="Обработано ".concat(O+1," из ").concat(T," чанков");case 62:O++,e.next=46;break;case 65:e.next=78;break;case 67:return document.getElementById("fuuga_current-step-spinner").innerText="Выполняется обработка промпта",e.next=71,V(t.text,u,m,window.abortController.signal,o,c,l,s,E,p,g,f,v,b,y,{loggerPromptMinimal:x,loggerPromptMedium:_,loggerPromptMaximal:k},1,!0);case 71:z=e.sent,R=z.generatedText,G=z.formattingInfo,D=z.loggerOutput,I.push(R),o&&G&&(S=G),p&&D&&B.push(D);case 78:return K=I.join(" "),e.next=81,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.body,a=n.search("START_TIMESTAMP",{matchCase:!0}).getFirst(),r=n.search("END_TIMESTAMP",{matchCase:!0}).getFirst(),(c=a.expandTo(r)).font.size=13,c.font.color="black",e.next=8,t.sync();case 8:if(!o){e.next=13;break}return e.next=11,h(t,c,K,S);case 11:e.next=14;break;case 13:c.insertText(K,Word.InsertLocation.replace);case 14:return a.delete(),r.delete(),e.next=18,t.sync();case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 81:p&&B.length>0&&te(B,"fuuga_logger-output"),document.getElementById("fuuga_home-results").innerHTML='<p class="text-success">Обработка завершена успешно.</p>',e.next=88;break;case 85:console.log("Текст не выделен"),document.getElementById("fuuga_home-results").innerHTML='<p class="text-warning">Пожалуйста, выделите текст для обработки.</p>',ne(!1);case 88:e.next=93;break;case 90:e.prev=90,e.t0=e.catch(0),"AbortError"===e.t0.name?(console.log("Обработка отменена пользователем."),document.getElementById("fuuga_home-results").innerHTML='<p class="text-info">Обработка отменена.</p>'):(console.error("Error in processSelectedText:",e.t0),document.getElementById("fuuga_home-results").innerHTML='<p class="text-danger">Произошла ошибка при обработке. Пожалуйста, попробуйте еще раз.</p>');case 93:return e.prev=93,ne(!1),window.abortController=null,document.getElementById("fuuga_process-text").disabled=!1,e.next=99,F();case 99:return e.finish(93);case 100:case"end":return e.stop()}}),e,null,[[0,90,93,100]])}))),j.apply(this,arguments)}function J(){return H.apply(this,arguments)}function H(){return H=d(i().mark((function e(){var t,n,a,r,o,c,l,s,u,m,g,v,b,y,x,k,I,E,S,B,w,T,C,P,M,O,L,N,A,j,J;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,W();case 3:if(t=e.sent,n=$("#fuuga_selected-prompts-list").children("li"),a=p(),r=[],n.each((function(){var e=$(this).data("promptIndex");r.push(a[e])})),0!==r.length){e.next=11;break}return H=void 0,H='\n      <div class="modal fade" id="fuuga_alertModal" tabindex="-1" role="dialog" aria-labelledby="fuuga_alertModalLabel" aria-hidden="true">\n        <div class="modal-dialog modal-dialog-centered" role="document">\n          <div class="modal-content">\n            <div class="modal-header">\n              <h5 class="modal-title" id="fuuga_alertModalLabel">Внимание</h5>\n              <button type="button" class="close" data-dismiss="modal" aria-label="Закрыть">\n                <span aria-hidden="true">&times;</span>\n              </button>\n            </div>\n            <div class="modal-body">\n              '.concat("Пожалуйста, выберите хотя бы один промпт.",'\n            </div>\n            <div class="modal-footer">\n              <button type="button" class="btn btn-primary" data-dismiss="modal">ОК</button>\n            </div>\n          </div>\n        </div>\n      </div>\n  '),$("body").append(H),$("#fuuga_alertModal").modal("show"),$("#fuuga_alertModal").on("hidden.bs.modal",(function(){$("#fuuga_alertModal").remove()})),e.abrupt("return");case 11:if(document.getElementById("fuuga_multiprompt-results").innerHTML="",K(),ae(!0),document.getElementById("fuuga_process-multiprompt-text").disabled=!0,window.abortController=new AbortController,o=parseInt(document.getElementById("fuuga_max-chars").value,10)||0,!(t.text.length>0)){e.next=70;break}if(!(o>0&&t.text.length>o)){e.next=23;break}return document.getElementById("fuuga_multiprompt-results").innerHTML='<p class="text-warning">Выделенный текст слишком длинный ('.concat(t.text.length," символов). Пожалуйста, выделите меньше ").concat(o," символов или измените ограничение в настройках.</p>"),ae(!1),document.getElementById("fuuga_process-multiprompt-text").disabled=!1,e.abrupt("return");case 23:c=document.getElementById("fuuga_apply-formatting").checked,l=$("#fuuga_formatting-model").val(),s=parseFloat(document.getElementById("fuuga_formatting-temperature").value)||.5,u=parseInt(document.getElementById("fuuga_formatting-max-tokens").value,10)||1e3,m=parseFloat(document.getElementById("fuuga_temperature").value)||.5,g=parseInt(document.getElementById("fuuga_max-tokens").value,10)||4e3,v=document.getElementById("fuuga_enable-logger").checked,b=document.getElementById("fuuga_logger-level").value,y=$("#fuuga_logger-model").val(),x=parseFloat(document.getElementById("fuuga_logger-temperature").value)||.3,k=parseInt(document.getElementById("fuuga_logger-max-tokens").value,10)||500,I=document.getElementById("fuuga_custom-logger-prompt").value,E=document.getElementById("fuuga_logger-prompt-minimal").value,S=document.getElementById("fuuga_logger-prompt-medium").value,B=document.getElementById("fuuga_logger-prompt-maximal").value,w=t.text,T=[],document.getElementById("fuuga_multiprompt-original-text").innerText=w,C=0;case 42:if(!(C<r.length)){e.next=64;break}return P=r[C],document.getElementById("fuuga_multiprompt-current-step").innerText="Выполняется промпт ".concat(C+1,": ").concat(P.name),e.next=48,V(w,m,g,window.abortController.signal,!1,l,s,u,P,v,b,y,x,k,I,{loggerPromptMinimal:E,loggerPromptMedium:S,loggerPromptMaximal:B},1,!1);case 48:M=e.sent,O=M.generatedText,L=M.loggerOutput,w=O,document.getElementById("fuuga_multiprompt-step-result-".concat(C)).innerText=w,v&&L&&T.push(L),N=r.length,A=Math.round((C+1)/N*100),j=document.getElementById("fuuga_multiprompt-progress-bar"),J=document.getElementById("fuuga_multiprompt-progress-text"),j.style.width="".concat(A,"%"),j.innerText="".concat(A,"%"),J.innerText="Обработано ".concat(C+1," из ").concat(N," шагов");case 61:C++,e.next=42;break;case 64:return e.next=66,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o,d,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.body,a=n.search("START_TIMESTAMP",{matchCase:!0}).getFirst(),r=n.search("END_TIMESTAMP",{matchCase:!0}).getFirst(),(o=a.expandTo(r)).load("text"),e.next=7,t.sync();case 7:return o.font.size=13,o.font.color="black",e.next=11,t.sync();case 11:if(!c){e.next=24;break}return document.getElementById("fuuga_multiprompt-current-step").innerText="Применяется форматирование",e.next=16,f(t,o);case 16:return d=e.sent,e.next=19,_(d,o.text,w,l,s,u,window.abortController.signal);case 19:return m=e.sent,e.next=22,h(t,o,w,m);case 22:e.next=25;break;case 24:o.insertText(w,Word.InsertLocation.replace);case 25:return a.delete(),r.delete(),e.next=29,t.sync();case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 66:v&&T.length>0&&te(T,"fuuga_multiprompt-logger-output"),document.getElementById("fuuga_multiprompt-results").innerHTML='<p class="text-success">Обработка завершена успешно.</p>',e.next=74;break;case 70:console.log("Текст не выделен"),document.getElementById("fuuga_multiprompt-results").innerHTML='<p class="text-warning">Пожалуйста, выделите текст для обработки.</p>',showMultip,romptLoading(!1);case 74:e.next=79;break;case 76:e.prev=76,e.t0=e.catch(0),"AbortError"===e.t0.name?(console.log("Обработка отменена пользователем."),document.getElementById("fuuga_multiprompt-results").innerHTML='<p class="text-info">Обработка отменена.</p>'):(console.error("Error in processMultipromptText:",e.t0),document.getElementById("fuuga_multiprompt-results").innerHTML='<p class="text-danger">Произошла ошибка при обработке. Пожалуйста, попробуйте еще раз.</p>');case 79:return e.prev=79,ae(!1),window.abortController=null,document.getElementById("fuuga_process-multiprompt-text").disabled=!1,e.next=85,F();case 85:return e.finish(79);case 86:case"end":return e.stop()}var H}),e,null,[[0,76,79,86]])}))),H.apply(this,arguments)}function z(){window.abortController&&(window.abortController.abort(),ne(!1),window.abortController=null,document.getElementById("fuuga_process-text").disabled=!1,F())}function F(){return R.apply(this,arguments)}function R(){return R=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return(r=d(i().mark((function e(a){var r,c,l,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(a,"*"),(c=n.search(r,{matchWildcards:!0})).load("items"),e.next=5,t.sync();case 5:l=o(c.items);try{for(l.s();!(s=l.n()).done;)s.value.delete()}catch(e){l.e(e)}finally{l.f()}return e.next=9,t.sync();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(e){return r.apply(this,arguments)},n=t.document.body,e.next=5,a("START_TIMESTAMP");case 5:return e.next=7,a("END_TIMESTAMP");case 7:console.log("Все маркеры timestamp успешно удалены.");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Ошибка при удалении маркеров:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),R.apply(this,arguments)}function W(){return G.apply(this,arguments)}function G(){return G=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:if(0!==(a=n.text.trim()).length){e.next=7;break}throw new Error("Нет выделенного текста");case 7:return r="START_TIMESTAMP",o="END_TIMESTAMP",n.insertText(r,Word.InsertLocation.before),n.insertText(o,Word.InsertLocation.after),c=t.document.body.search(r,{matchCase:!0}).getFirst(),l=t.document.body.search(o,{matchCase:!0}).getFirst(),c.font.size=1,l.font.size=1,c.font.color="white",l.font.color="white",e.next=19,t.sync();case 19:return e.abrupt("return",{text:a});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),console.error("Ошибка при создании маркеров выделения:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),G.apply(this,arguments)}function D(){window.abortController&&(window.abortController.abort(),ae(!1),window.abortController=null,document.getElementById("fuuga_process-multiprompt-text").disabled=!1)}function q(){var e=document.getElementById("fuuga_progress-bar"),t=document.getElementById("fuuga_progress-text"),n=document.getElementById("fuuga_current-step");e&&(e.style.width="0%",e.innerText="0%"),t&&(t.innerText="Обработано 0 из 0 чанков"),n&&(n.innerText="");var a=document.getElementById("fuuga_current-step-spinner");a&&(a.innerText="")}function K(){var e=document.getElementById("fuuga_multiprompt-progress-bar"),t=document.getElementById("fuuga_multiprompt-progress-text"),n=document.getElementById("fuuga_multiprompt-current-step");e&&(e.style.width="0%",e.innerText="0%"),t&&(t.innerText="Обработано 0 из 0 шагов"),n&&(n.innerText="");var a=document.getElementById("fuuga_multiprompt-current-step-spinner");a&&(a.innerText="")}function U(e,t){for(var n=e.match(/[^.!?]+[.!?]+(\s|$)|[^.!?]+$/g)||[e],a=[],r=0;r<n.length;r+=t){var o=n.slice(r,r+t).join(" ").trim();a.push(o)}return a}function V(e,t,n,a,r,o,c,l,s,i,u,d,m,p,g,f){return X.apply(this,arguments)}function X(){return X=d(i().mark((function e(t,n,a,r,o,c,l,s,u,d,m,p,g,f,v,h){var b,y,x,_,k=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b=k.length>16&&void 0!==k[16]?k[16]:1,y=k.length>17&&void 0!==k[17]&&k[17],x=0;case 3:if(!(x<b)){e.next=25;break}return e.prev=4,e.next=7,Z(t,n,a,r,o,c,l,s,u,d,m,p,g,f,v,h,y);case 7:return _=e.sent,e.abrupt("return",{generatedText:_.generatedText||"",formattingInfo:_.formattingInfo||[],loggerOutput:_.loggerOutput||null});case 11:if(e.prev=11,e.t0=e.catch(4),"AbortError"!==e.t0.name){e.next=17;break}throw e.t0;case 17:if(!(++x>=b)){e.next=22;break}throw e.t0;case 22:console.warn("Попытка ".concat(x," не удалась. Повторяем..."));case 23:e.next=3;break;case 25:return e.abrupt("return",{generatedText:"",formattingInfo:[],loggerOutput:null});case 26:case"end":return e.stop()}}),e,null,[[4,11]])}))),X.apply(this,arguments)}function Z(e,t,n,a,r,o,c,l,s,i,u,d,m,p,g,f,v){return Y.apply(this,arguments)}function Y(){return Y=d(i().mark((function e(t,n,a,r,o,c,l,s,u,m,p,g,v,h,b,y,x){var k,I,E,S,B,w,T,C,P,M,O;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k=localStorage.getItem("apiKey"),I=u.model,E=u.text,S="".concat(E,'\n\nПользователь предоставил следующий текст: "').concat(t,'"'),B={model:I,messages:[{role:"system",content:"Ты - AI помощник по обработке текста. Твоя задача - генерировать только необходимый текст на основе пользовательского промпта. Не добавляй никаких дополнительных комментариев, пояснений или пунктуации. Возвращай только обработанный текст."},{role:"user",content:S}],temperature:n,max_tokens:a},e.prev=6,e.next=9,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(k),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word Text Processor"},body:JSON.stringify(B),signal:r});case 9:if((w=e.sent).ok){e.next=12;break}throw new Error("HTTP error! status: ".concat(w.status));case 12:return e.next=14,w.json();case 14:if(T=e.sent,console.log("Ответ от сервера:",T.choices[0].message.content.trim()),C=T.choices[0].message.content.trim(),P=[],!o||!x){e.next=27;break}return document.getElementById("fuuga_current-step-spinner").innerText="Применяется форматирование",e.next=23,Word.run(function(){var e=d(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.getSelection(),e.next=3,f(t,n);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 23:return M=e.sent,e.next=26,_(M,t,C,c,l,s,r);case 26:P=e.sent;case 27:if(O=null,!m){e.next=32;break}return e.next=31,Q(t,C,u,r,p,x?"Single Prompt":"Chunk Processing",g,v,h,b,y);case 31:O=e.sent;case 32:return e.abrupt("return",{generatedText:C,formattingInfo:P,loggerOutput:O});case 35:if(e.prev=35,e.t0=e.catch(6),"AbortError"!==e.t0.name){e.next=42;break}throw console.log("Запрос был отменен."),e.t0;case 42:throw console.error("Error in processChunkHome:",e.t0),e.t0;case 44:case"end":return e.stop()}}),e,null,[[6,35]])}))),Y.apply(this,arguments)}function Q(e,t,n,a,r,o,c,l,s,i){return ee.apply(this,arguments)}function ee(){return(ee=d(i().mark((function e(t,n,a,r,o,c,l,s,u,d){var m,p,g,f,v,h,b,y,x,_;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m=localStorage.getItem("apiKey"),p=JSON.parse(localStorage.getItem("mainSettings")||"{}"),g=p.loggerPrompts||{minimal:"Опишите кратко изменения между текстом до и после обработки.",medium:"Опишите изменения между текстом до и после обработки, упомяните ключевые изменения.",maximal:"Детально опишите все изменения между текстом до и после обработки, включая использование промпта."},"",f="custom"===o&&d?d.replace("{{beforeText}}",t).replace("{{afterText}}",n):g[o]||"Опишите изменения между текстом до и после обработки.",v="custom"===o&&d?f:"".concat(f,'\n\nПромпт: "').concat(a.name,'"\n\nТекст до обработки: "').concat(t,'"\n\nТекст после обработки: "').concat(n,'"'),h={model:l,messages:[{role:"system",content:'Ты - AI помощник для логирования изменений текста. Твоя задача - анализировать изменения между исходным и полученным текстами и предоставлять отчет пользователю.\n  \n  Примеры отчета для разных уровней детализации:\n\n  1. Минимальный уровень:\n  {\n      "level": "minimal",\n      "message": "Текст был сокращен и упрощен."\n  }\n\n  2. Средний уровень:\n  {\n      "level": "medium",\n      "message": "Текст был сокращен, удалены лишние подробности. Улучшена структура предложений для большей ясности."\n  }\n\n  3. Максимальный уровень:\n  {\n      "level": "maximal",\n      "message": "Текст был переработан для сокращения и упрощения. Конкретно, удалены повторяющиеся идеи во втором абзаце. В третьем предложении исправлена грамматическая ошибка: \'он есть\' заменено на \'он\'. Язык стал более формальным и профессиональным.",\n      "details": "Детальное описание изменений...",\n      "examples": ["Пример 1", "Пример 2"]\n  }\n\n  Твой отчет должен соответствовать выбранному уровню детализации и включать только необходимые поля для этого уровня. Другие уровни не нужны. Ответ должен быть валидным JSON объектом без дополнительных комментариев или пояснений.\n  '},{role:"user",content:v}],temperature:s,max_tokens:u},e.prev=8,e.next=11,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(m),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word Logger"},body:JSON.stringify(h),signal:r});case 11:if((b=e.sent).ok){e.next=14;break}throw new Error("HTTP error! status: ".concat(b.status));case 14:return e.next=16,b.json();case 16:y=e.sent,console.log("Ответ от сервера (Логер):",y.choices[0].message.content.trim()),x=y.choices[0].message.content.trim(),e.prev=19,_=JSON.parse(x),e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(19),console.error("Ошибка при парсинге JSON ответа логера:",e.t0),e.abrupt("return",null);case 27:if(_.level&&_.message){e.next=30;break}return console.error("Некорректный формат JSON ответа логера."),e.abrupt("return",null);case 30:return e.abrupt("return",{stepDescription:c,promptName:a.name,loggerOutput:_});case 33:if(e.prev=33,e.t1=e.catch(8),"AbortError"!==e.t1.name){e.next=40;break}return console.log("Запрос был отменен."),e.abrupt("return",null);case 40:return console.error("Error in processLogger:",e.t1),e.abrupt("return",null);case 42:case"end":return e.stop()}}),e,null,[[8,33],[19,23]])})))).apply(this,arguments)}function te(e,t){var n=document.getElementById(t);n.innerHTML="";var a="".concat(t,"-accordion"),r='<div class="accordion" id="'.concat(a,'">');e.forEach((function(e,t){var n="".concat(a,"-collapse-").concat(t),o="".concat(a,"-heading-").concat(t),c="",l="";switch(e.loggerOutput.level){case"minimal":c="bg-info text-white",l="fas fa-info-circle";break;case"medium":c="bg-warning text-dark",l="fas fa-exclamation-triangle";break;case"maximal":c="bg-danger text-white",l="fas fa-exclamation-circle";break;default:c="bg-secondary text-white",l="fas fa-question-circle"}var s,i,u,d=(s=e.loggerOutput,u="\n      <p><strong>Уровень:</strong> ".concat((i=s.level,i.charAt(0).toUpperCase()+i.slice(1)),"</p>\n      <p><strong>Сообщение:</strong> ").concat(s.message,"</p>\n  "),"medium"===s.level&&s.details&&(u+="<p><strong>Детали:</strong> ".concat(s.details,"</p>")),"maximal"===s.level&&(s.details&&(u+="<p><strong>Детали:</strong> ".concat(s.details,"</p>")),s.examples&&Array.isArray(s.examples)&&(u+="<p><strong>Примеры:</strong></p><ul>",s.examples.forEach((function(e){u+="<li>".concat(e,"</li>")})),u+="</ul>")),u);r+='\n          <div class="card">\n              <div class="card-header '.concat(c,'" id="').concat(o,'">\n                  <h2 class="mb-0">\n                      <button class="btn btn-link text-white" type="button" data-toggle="collapse" data-target="#').concat(n,'" aria-expanded="').concat(0===t?"true":"false",'" aria-controls="').concat(n,'">\n                          <i class="').concat(l,'"></i> ').concat(e.stepDescription,": ").concat(e.promptName,'\n                      </button>\n                  </h2>\n              </div>\n              <div id="').concat(n,'" class="collapse ').concat(0===t?"show":"",'" aria-labelledby="').concat(o,'" data-parent="#').concat(a,'">\n                  <div class="card-body">\n                      ').concat(d,"\n                  </div>\n              </div>\n          </div>\n      ")})),r+="</div>",n.innerHTML=r}function ne(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("fuuga_loading"),a=document.getElementById("fuuga_process-text"),r=document.getElementById("fuuga_cancel-process"),o=document.getElementById("fuuga_progress-container"),c=document.getElementById("fuuga_spinner");e?(n.style.display="block",a.disabled=!0,r.style.display="inline-block",t?(o.style.display="block",c.style.display="none"):(o.style.display="none",c.style.display="block")):(n.style.display="none",a.disabled=!1,r.style.display="none",o.style.display="none",c.style.display="none")}function ae(e){var t=document.getElementById("fuuga_multiprompt-loading"),n=document.getElementById("fuuga_process-multiprompt-text"),a=document.getElementById("fuuga_cancel-multiprompt-process"),r=document.getElementById("fuuga_multiprompt-progress-container"),o=document.getElementById("fuuga_multiprompt-spinner");e?(t.style.display="block",n.disabled=!0,a.style.display="inline-block",r.style.display="block",o.style.display="none"):(t.style.display="none",n.disabled=!1,a.style.display="none",r.style.display="none",o.style.display="none")}function re(){var e=$("#fuuga_preset-select");e.empty();var t=new Option("Текущие настройки","current",!1,!1);e.append(t);var n=JSON.parse(localStorage.getItem("homePresets")||"[]"),a=localStorage.getItem("homeLastSelectedPreset")||null;n.forEach((function(t){var n=new Option(t.name,t.name,!1,!1);e.append(n)})),a&&"current"!==a?e.val(a).trigger("change"):e.val("current").trigger("change")}function oe(){window.isLoadingPreset=!0;var e=$("#fuuga_preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("homePresets")||"[]").find((function(t){return t.name===e}));if(t){var n=t.settings;document.getElementById("fuuga_apply-formatting").checked=n.applyFormatting,document.getElementById("fuuga_split-into-chunks-checkbox").checked=n.splitIntoChunks,document.getElementById("fuuga_chunk-size").value=n.chunkSize,document.getElementById("fuuga_max-chars").value=n.maxChars,document.getElementById("fuuga_temperature").value=n.temperature,document.getElementById("fuuga_max-tokens").value=n.maxTokens,document.getElementById("fuuga_formatting-temperature").value=n.formattingTemperature,document.getElementById("fuuga_formatting-max-tokens").value=n.formattingMaxTokens,document.getElementById("fuuga_enable-logger").checked=n.enableLogger,document.getElementById("fuuga_logger-level").value=n.loggerLevel,document.getElementById("fuuga_custom-logger-prompt").value=n.customLoggerPrompt,document.getElementById("fuuga_logger-temperature").value=n.loggerTemperature,document.getElementById("fuuga_logger-max-tokens").value=n.loggerMaxTokens,document.getElementById("fuuga_edit-logger-prompts").checked=n.editLoggerPrompts,$("#fuuga_formatting-model").val(n.formattingModel).trigger("change"),$("#fuuga_logger-model").val(n.loggerModel).trigger("change"),document.getElementById("fuuga_logger-prompt-minimal").value=n.loggerPrompts.minimal||"",document.getElementById("fuuga_logger-prompt-medium").value=n.loggerPrompts.medium||"",document.getElementById("fuuga_logger-prompt-maximal").value=n.loggerPrompts.maximal||"","custom"===n.loggerLevel?document.getElementById("fuuga_custom-logger-prompt-container").style.display="block":document.getElementById("fuuga_custom-logger-prompt-container").style.display="none";var a=document.getElementById("fuuga_edit-logger-prompts").checked;document.getElementById("fuuga_logger-prompts-accordion").style.display=a?"block":"none",L(),localStorage.setItem("homeLastSelectedPreset",e),se(),window.isLoadingPreset=!1}else window.isLoadingPreset=!1}else window.isLoadingPreset=!1}function ce(){var e=document.getElementById("fuuga_preset-name"),t=e.value.trim();if(t)if("current"!==t.toLowerCase()&&"Текущие настройки"!==t){var n={name:t,settings:de()},a=JSON.parse(localStorage.getItem("homePresets")||"[]"),r=a.findIndex((function(e){return e.name===t}));-1!==r?pe('Пресет с названием "'.concat(t,'" уже существует. Перезаписать его?'),(function(){a[r]=n,localStorage.setItem("homePresets",JSON.stringify(a)),re(),$("#fuuga_preset-select").val(n.name).trigger("change"),localStorage.setItem("homeLastSelectedPreset",n.name),me("Пресет сохранен.","success"),e.value="",se()})):(a.push(n),localStorage.setItem("homePresets",JSON.stringify(a)),re(),$("#fuuga_preset-select").val(n.name).trigger("change"),localStorage.setItem("homeLastSelectedPreset",n.name),me("Пресет сохранен.","success"),e.value="",se())}else me('Название пресета не может быть "Текущие настройки".',"danger");else me("Название пресета не может быть пустым.","danger")}function le(){var e=$("#fuuga_preset-select").val();e&&"current"!==e?pe('Вы уверены, что хотите удалить пресет "'.concat(e,'"?'),(function(){var t=JSON.parse(localStorage.getItem("homePresets")||"[]");t=t.filter((function(t){return t.name!==e})),localStorage.setItem("homePresets",JSON.stringify(t)),$("#fuuga_preset-select").val("current").trigger("change"),localStorage.removeItem("homeLastSelectedPreset"),re(),me("Пресет удален.","success"),document.getElementById("fuuga_preset-json").value=""})):me("Нет выбранного пресета для удаления.","danger")}function se(){var e=$("#fuuga_preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("homePresets")||"[]").find((function(t){return t.name===e}));if(t){var n=JSON.stringify(t,null,2);document.getElementById("fuuga_preset-json").value=n}else document.getElementById("fuuga_preset-json").value=""}else document.getElementById("fuuga_preset-json").value=""}function ie(){document.getElementById("fuuga_preset-json").select(),document.execCommand("copy"),me("JSON пресета скопирован в буфер обмена.","success")}function ue(){var e=document.getElementById("fuuga_preset-json-import").value;if(e)try{var t=JSON.parse(e);if(!t.name||!t.settings)return void me("Некорректный формат пресета.","danger");if("current"===t.name.toLowerCase()||"Текущие настройки"===t.name)return void me('Название пресета не может быть "Текущие настройки".',"danger");var n=JSON.parse(localStorage.getItem("homePresets")||"[]"),a=n.findIndex((function(e){return e.name===t.name}));-1!==a?pe('Пресет с названием "'.concat(t.name,'" уже существует. Перезаписать его?'),(function(){n[a]=t,localStorage.setItem("homePresets",JSON.stringify(n)),re(),$("#fuuga_preset-select").val(t.name).trigger("change"),localStorage.setItem("homeLastSelectedPreset",t.name),me("Пресет импортирован.","success"),se()})):(n.push(t),localStorage.setItem("homePresets",JSON.stringify(n)),re(),$("#fuuga_preset-select").val(t.name).trigger("change"),localStorage.setItem("homeLastSelectedPreset",t.name),me("Пресет импортирован.","success"),se())}catch(e){console.error("Ошибка при импорте пресета:",e),me("Ошибка при импорте пресета. Проверьте формат JSON.","danger")}else me("Поле JSON пустое.","danger")}function de(){var t=JSON.parse(localStorage.getItem("mainSettings")||"{}");return t.lastSelectedPromptIndex,t.lastSelectedMultipromptIndices,function(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.includes(a))continue;n[a]=e[a]}return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.includes(n)||{}.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(t,e)}function me(e,t){var n=document.getElementById("fuuga_preset-message");n.innerHTML='<div class="alert alert-'.concat(t,'">').concat(e,"</div>"),setTimeout((function(){n.innerHTML=""}),3e3)}function pe(e,t){var n=document.getElementById("fuuga_preset-confirmation"),a=document.getElementById("fuuga_preset-confirmation-message"),r=document.getElementById("fuuga_preset-confirm-yes"),o=document.getElementById("fuuga_preset-confirm-no");a.textContent=e,n.style.display="block",r.onclick=null,o.onclick=null,r.onclick=function(){n.style.display="none",t()},o.onclick=function(){n.style.display="none"}}function ge(){return fe.apply(this,arguments)}function fe(){return fe=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o,c,l,s,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.getSelection(),e.next=3,f(t,n);case 3:(a=e.sent).length>0?(r={},o={},c={},a.forEach((function(e){var t=e.color||"default",n=e.fontName||"default",a=e.size||"default";r[t]=(r[t]||0)+1,o[n]=(o[n]||0)+1,c[a]=(c[a]||0)+1})),l=ve(r),s=ve(o),u=ve(c),y(a,l,s,u)):document.getElementById("fuuga_selected-text-info").innerHTML='<p class="text-warning">Пожалуйста, выделите текст для получения информации.</p>';case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=10;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Error in showSelectedTextInfo:",e.t0),document.getElementById("fuuga_selected-text-info").innerHTML='<p class="text-danger">Произошла ошибка при получении информации о выделенном тексте. Пожалуйста, попробуйте еще раз.</p>';case 10:case"end":return e.stop()}}),e,null,[[0,5]])}))),fe.apply(this,arguments)}function ve(e){return Object.entries(e).reduce((function(e,t){return e[1]>=t[1]?e:t}))[0]}function he(){var e;document.getElementById("prompts").innerHTML='\n        <div class="mt-3">\n            \x3c!-- Навигация по основным табам --\x3e\n            <ul class="nav nav-tabs" id="crocodile_promptsMainTab" role="tablist">\n                <li class="nav-item">\n                    <a class="nav-link active" id="crocodile_prompts-main-tab" data-toggle="tab" href="#crocodile_promptsMainContent" role="tab" aria-controls="crocodile_promptsMainContent" aria-selected="true">Промпты</a>\n                </li>\n                <li class="nav-item">\n                    <a class="nav-link" id="crocodile_presets-main-tab" data-toggle="tab" href="#crocodile_presetsMainContent" role="tab" aria-controls="crocodile_presetsMainContent" aria-selected="false">Пресеты</a>\n                </li>\n                <li class="nav-item">\n                    <a class="nav-link" id="crocodile_settings-main-tab" data-toggle="tab" href="#crocodile_settingsMainContent" role="tab" aria-controls="crocodile_settingsMainContent" aria-selected="false">Настройки</a>\n                </li>\n            </ul>\n            \x3c!-- Содержимое основных табов --\x3e\n            <div class="tab-content" id="crocodile_promptsMainTabContent">\n                \x3c!-- Промпты --\x3e\n                <div class="tab-pane fade show active" id="crocodile_promptsMainContent" role="tabpanel" aria-labelledby="crocodile_prompts-main-tab">\n                    \x3c!-- Навигация по подтабам в Промптах --\x3e\n                    <ul class="nav nav-tabs mt-3" id="crocodile_promptsSubTab" role="tablist">\n                        <li class="nav-item">\n                            <a class="nav-link active" id="crocodile_view-prompt-tab" data-toggle="tab" href="#crocodile_viewPromptTabContent" role="tab" aria-controls="crocodile_viewPromptTabContent" aria-selected="true">Просмотр</a>\n                        </li>\n                        <li class="nav-item">\n                            <a class="nav-link" id="crocodile_create-prompt-tab" data-toggle="tab" href="#crocodile_createPromptTabContent" role="tab" aria-controls="crocodile_createPromptTabContent" aria-selected="false">Создать</a>\n                        </li>\n                    </ul>\n                    \x3c!-- Содержимое подтабов в Промптах --\x3e\n                    <div class="tab-content" id="crocodile_promptsSubTabContent">\n                        \x3c!-- Просмотр Промптов --\x3e\n                        <div class="tab-pane fade show active" id="crocodile_viewPromptTabContent" role="tabpanel" aria-labelledby="crocodile_view-prompt-tab">\n                            \x3c!-- Инструкция для Просмотра Промптов --\x3e\n                            <div class="alert alert-info mt-3">\n                                <strong>Инструкция:</strong>\n                                <p>Просматривайте и управляйте сохранёнными промптами. Вы можете фильтровать и сортировать промпты.</p>\n                            </div>\n                            \x3c!-- Фильтр по тегам и сортировка --\x3e\n                            <div class="mt-3 row">\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="crocodile_filter-tags-select">Фильтр по тегам</label>\n                                        <select id="crocodile_filter-tags-select" class="form-control" multiple></select>\n                                    </div>\n                                </div>\n                                <div class="col-md-6">\n                                    <div class="form-group">\n                                        <label for="crocodile_sort-prompts-select">Сортировка</label>\n                                        <select id="crocodile_sort-prompts-select" class="form-control">\n                                            <option value="name_asc">По названию (A-Z)</option>\n                                            <option value="name_desc">По названию (Z-A)</option>\n                                            <option value="length_asc">По длине промпта (кратчайшие)</option>\n                                            <option value="length_desc">По длине промпта (длиннейшие)</option>\n                                            <option value="model_asc">По модели (A-Z)</option>\n                                            <option value="model_desc">По модели (Z-A)</option>\n                                        </select>\n                                    </div>\n                                </div>\n                            </div>\n                            \x3c!-- Список промптов --\x3e\n                            <div id=\'crocodile_prompt-list-container\' class=\'mt-4\'>\n                                \x3c!-- Здесь будет список промптов --\x3e\n                                <div id="crocodile_prompt-list"></div>\n                            </div>\n                        </div>\n                        \x3c!-- Создать Промпт --\x3e\n                        <div class="tab-pane fade" id="crocodile_createPromptTabContent" role="tabpanel" aria-labelledby="crocodile_create-prompt-tab">\n                            \x3c!-- Инструкция для Создания Промптов --\x3e\n                            <div class="alert alert-info mt-3">\n                                <strong>Инструкция:</strong>\n                                <p>Создавайте новые промпты, указывая название, модель, текст промпта и теги. Вы можете выбрать существующие теги или добавить новые.</p>\n                            </div>\n                            \x3c!-- Форма для добавления/редактирования промптов --\x3e\n                            <div class="mt-3">\n                                <div class="form-group">\n                                    <label for="crocodile_prompt-name-input">Название промпта</label>\n                                    <input type="text" id="crocodile_prompt-name-input" class="form-control" placeholder="Введите название промпта" title="Введите название промпта">\n                                </div>\n                                <div class="form-group">\n                                    <label for="crocodile_prompt-model-select">Модель</label>\n                                    <select id="crocodile_prompt-model-select" class="form-control mt-2 select2-init-prompt-models"></select>\n                                </div>\n                                <div class="form-group">\n                                    <label for="crocodile_prompt-textarea-input">Текст промпта</label>\n                                    <textarea id="crocodile_prompt-textarea-input" class="form-control mt-2" rows="5" placeholder="Текст промпта"></textarea>\n                                </div>\n                                <div class="form-group">\n                                    <label for="crocodile_prompt-tags-input">Теги</label>\n                                    <select id="crocodile_prompt-tags-input" class="form-control mt-2" multiple></select>\n                                </div>\n                                \x3c!-- Новые кнопки --\x3e\n                                <div class="mt-2">\n                                    <button id="crocodile_save-prompt-btn" class="btn btn-primary">Сохранить промпт</button>\n                                    <button id="crocodile_clear-input-btn" class="btn btn-secondary ml-2">Очистить ввод</button>\n                                    <button id="crocodile_cancel-edit-btn" class="btn btn-warning ml-2" style="display: none;">Отменить редактирование</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div> \x3c!-- crocodile_promptsSubTabContent --\x3e\n                </div> \x3c!-- crocodile_promptsMainContent --\x3e\n                \x3c!-- Пресеты --\x3e\n                <div class=\'tab-pane fade\' id=\'crocodile_presetsMainContent\' role=\'tabpanel\' aria-labelledby=\'crocodile_presets-main-tab\'>\n                    \x3c!-- Навигация по подтабам в Пресетах --\x3e\n                    <ul class="nav nav-tabs mt-3" id="crocodile_presetsSubTab" role="tablist">\n                        <li class="nav-item">\n                            <a class="nav-link active" id="crocodile_view-preset-tab" data-toggle="tab" href="#crocodile_viewPresetTabContent" role="tab" aria-controls="crocodile_viewPresetTabContent" aria-selected="true">Просмотр</a>\n                        </li>\n                        <li class="nav-item">\n                            <a class="nav-link" id="crocodile_manage-preset-tab" data-toggle="tab" href="#crocodile_managePresetTabContent" role="tab" aria-controls="crocodile_managePresetTabContent" aria-selected="false">Управление</a>\n                        </li>\n                    </ul>\n                    \x3c!-- Содержимое подтабов в Пресетах --\x3e\n                    <div class="tab-content" id="crocodile_presetsSubTabContent">\n                        \x3c!-- Просмотр Пресетов --\x3e\n                        <div class="tab-pane fade show active" id="crocodile_viewPresetTabContent" role="tabpanel" aria-labelledby="crocodile_view-preset-tab">\n                            \x3c!-- Инструкция для Просмотра Пресетов --\x3e\n                            <div class="alert alert-info mt-3">\n                                <strong>Инструкция:</strong>\n                                <p>Управляйте пресетами ваших промптов. Вы можете просматривать содержимое пресетов и добавлять их к текущим или заменять текущие.</p>\n                            </div>\n                            <div class="mt-3">\n                                <div class="form-group">\n                                    <label for="crocodile_preset-select-prompts">Выберите пресет:</label>\n                                    <select id="crocodile_preset-select-prompts" class="form-control" title="Выберите пресет для просмотра"></select>\n                                </div>\n                                <div class="mt-2">\n                                    <button id="crocodile_add-preset-to-prompts-btn" class="btn btn-success mr-2">Добавить к текущим промптам</button>\n                                    <button id="crocodile_replace-prompts-with-preset-btn" class="btn btn-warning mr-2">Заменить текущие промпты</button>\n                                    <button id="crocodile_delete-preset-btn" class="btn btn-danger">Удалить выбранный пресет</button>\n                                </div>\n                                \x3c!-- Предпросмотр пресета --\x3e\n                                <div class="mt-4">\n                                    <h5>Предпросмотр пресета (<span id="crocodile_preset-count">0</span> промптов):</h5>\n                                    <div id="crocodile_preset-preview"></div>\n                                </div>\n                            </div>\n                        </div>\n                        \x3c!-- Управление Пресетами --\x3e\n                        <div class="tab-pane fade" id="crocodile_managePresetTabContent" role="tabpanel" aria-labelledby="crocodile_manage-preset-tab">\n                            \x3c!-- Инструкция для Управления Пресетов --\x3e\n                            <div class="alert alert-info mt-3">\n                                <strong>Инструкция:</strong>\n                                <p>Создавайте новые пресеты, экспортируйте и импортируйте их в формате JSON.</p>\n                            </div>\n                            \x3c!-- Форма для добавления пресета --\x3e\n                            <div class="mt-3">\n                                <div class="form-group">\n                                    <label for="crocodile_preset-name-input">Название пресета</label>\n                                    <input type="text" id="crocodile_preset-name-input" class="form-control" placeholder="Введите название пресета">\n                                </div>\n                                <button id="crocodile_save-preset-btn" class="btn btn-primary">Сохранить текущие промпты как пресет</button>\n                            </div>\n                            \x3c!-- Выбор пресета для экспорта --\x3e\n                            <div class="mt-4">\n                                <div class="form-group">\n                                    <label for="crocodile_preset-select-in-manage">Выберите пресет для экспорта:</label>\n                                    <select id="crocodile_preset-select-in-manage" class="form-control" title="Выберите пресет для управления"></select>\n                                </div>\n                            </div>\n                            \x3c!-- Экспорт/Импорт пресета --\x3e\n                            <div class="mt-4">\n                                <div class="form-group">\n                                    <label for="crocodile_preset-json-input">JSON Пресета</label>\n                                    <textarea id="crocodile_preset-json-input" class="form-control" rows="5"></textarea>\n                                </div>\n                                <button id="crocodile_-preset-btn" class="btn btn-secondary mr-2">Экспортировать выбранный пресет</button>\n                                <button id="crocodile_clear-preset-json-btn" class="btn btn-secondary mr-2">Очистить поле JSON</button>\n                                <button id="crocodile_import-preset-btn" class="btn btn-secondary">Импортировать пресет из JSON</button>\n                            </div>\n                        </div>\n                    </div> \x3c!-- crocodile_presetsSubTabContent --\x3e\n                </div> \x3c!-- crocodile_presetsMainContent --\x3e\n                \x3c!-- Настройки --\x3e\n                <div class=\'tab-pane fade\' id=\'crocodile_settingsMainContent\' role=\'tabpanel\' aria-labelledby=\'crocodile_settings-main-tab\'>\n                    <div class="mt-3">\n                        <h4>Настройки</h4>\n                        <button id="crocodile_delete-all-prompts-btn" class="btn btn-danger mt-2">Удалить все текущие промпты</button>\n                        <button id="crocodile_delete-all-presets-btn" class="btn btn-danger mt-2">Удалить все текущие пресеты</button>\n                    </div>\n                </div>\n            </div> \x3c!-- crocodile_promptsMainTabContent end --\x3e\n        </div> \x3c!-- main container end --\x3e\n    ',document.getElementById("crocodile_alertModal")||document.body.insertAdjacentHTML("beforeend",'\n            \x3c!-- Alert Modal --\x3e\n            <div class="modal fade" id="crocodile_alertModal" tabindex="-1" role="dialog" aria-labelledby="crocodile_alertModalTitle" aria-hidden="true">\n              <div class="modal-dialog modal-dialog-centered" role="document">\n                <div class="modal-content">\n                  <div class="modal-header">\n                    <h5 id="crocodile_alertModalTitle" class="modal-title">Сообщение</h5>\n                    <button type="button" class="close btn" data-dismiss="modal" aria-label="Закрыть">\n                      <span aria-hidden="true">&times;</span>\n                    </button>\n                  </div>\n                  <div id="crocodile_alertModalBody" class="modal-body">\n                    ...\n                  </div>\n                  <div class="modal-footer">\n                    <button type="button" class="btn btn-primary" data-dismiss="modal">ОК</button>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            \x3c!-- Confirm Modal --\x3e\n            <div class="modal fade" id="crocodile_confirmModal" tabindex="-1" role="dialog" aria-labelledby="crocodile_confirmModalTitle" aria-hidden="true">\n              <div class="modal-dialog modal-dialog-centered" role="document">\n                <div class="modal-content">\n                  <div class="modal-header">\n                    <h5 id="crocodile_confirmModalTitle" class="modal-title">Подтверждение</h5>\n                    <button type="button" class="close btn" data-dismiss="modal" aria-label="Закрыть">\n                      <span aria-hidden="true">&times;</span>\n                    </button>\n                  </div>\n                  <div id="crocodile_confirmModalBody" class="modal-body">\n                    ...\n                  </div>\n                  <div class="modal-footer">\n                    <button id="crocodile_confirmModalCancel" type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>\n                    <button id="crocodile_confirmModalOk" type="button" class="btn btn-primary">ОК</button>\n                  </div>\n                </div>\n              </div>\n            </div>\n        '),$('#crocodile_promptsMainTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$("#crocodile_prompt-model-select").select2({width:"100%",placeholder:"Выберите модель"}),$("#crocodile_filter-tags-select").select2({width:"100%",placeholder:"Выберите теги для фильтрации",allowClear:!0}),$("#crocodile_prompt-tags-input").select2({width:"100%",placeholder:"Выберите или введите теги",tags:!0,tokenSeparators:[","," "],createTag:function(e){return{id:e.term,text:e.term,newTag:!0}}}),$("#crocodile_sort-prompts-select").select2({width:"100%",minimumResultsForSearch:1/0}),(e=$("#crocodile_prompt-model-select")).empty(),JSON.parse(localStorage.getItem("models")||"[]").forEach((function(t){var n=new Option(t.name,t.id,!1,!1);e.append(n)})),e.trigger("change"),xe(),_e(),Ee(),document.getElementById("crocodile_save-prompt-btn").onclick=Se,document.getElementById("crocodile_add-preset-to-prompts-btn").onclick=Fe,document.getElementById("crocodile_replace-prompts-with-preset-btn").onclick=Re,document.getElementById("crocodile_delete-preset-btn").onclick=Ge,document.getElementById("crocodile_delete-all-prompts-btn").onclick=Oe,document.getElementById("crocodile_delete-all-presets-btn").onclick=Ne,document.getElementById("crocodile_save-preset-btn").onclick=Ae,document.getElementById("crocodile_-preset-btn").onclick=Je,document.getElementById("crocodile_import-preset-btn").onclick=ze,document.getElementById("crocodile_clear-preset-json-btn").onclick=He,document.getElementById("crocodile_clear-input-btn").onclick=ke,document.getElementById("crocodile_cancel-edit-btn").onclick=Ie,$("#crocodile_preset-select-prompts").on("change",qe),$('#crocodile_promptsSubTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),$("#crocodile_filter-tags-select").on("change",(function(){Me()})),$("#crocodile_sort-prompts-select").on("change",(function(){Me()})),$('#crocodile_presetsSubTab a[data-toggle="tab"]').on("click",(function(e){e.preventDefault(),$(this).tab("show")})),we()}function be(e){$("#crocodile_alertModalBody").text(e),$("#crocodile_alertModal").modal("show")}function ye(e){return new Promise((function(t,n){$("#crocodile_confirmModalBody").text(e),$("#crocodile_confirmModal").modal("show"),$("#crocodile_confirmModalOk").off("click").on("click",(function(){$("#crocodile_confirmModal").modal("hide"),t(!0)})),$("#crocodile_confirmModalCancel").off("click").on("click",(function(){$("#crocodile_confirmModal").modal("hide"),t(!1)})),$("#crocodile_confirmModal").off("hidden.bs.modal").on("hidden.bs.modal",(function(){t(!1)}))}))}function xe(){var e=$("#crocodile_filter-tags-select"),t=$("#crocodile_prompt-tags-input");e.empty(),t.empty();var n=p(),a=new Map;n.forEach((function(e){e.tags&&e.tags.forEach((function(e){a.has(e)?a.set(e,a.get(e)+1):a.set(e,1)}))})),Array.from(a.entries()).sort().forEach((function(n){var a=c(n,2),r=a[0],o=a[1],l="".concat(r," (").concat(o,")"),s=new Option(l,r,!1,!1),i=new Option(r,r,!1,!1);e.append(s),t.append(i)})),e.trigger("change"),t.trigger("change")}function _e(){var e=$("#crocodile_preset-select-prompts");e.empty();var t=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]");0===t.length?e.append(new Option("Нет сохранённых пресетов","",!1,!1)):(e.append(new Option("Выберите пресет","",!1,!1)),t.forEach((function(t){e.append(new Option(t.name,t.name,!1,!1))}))),e.trigger("change")}function ke(){document.getElementById("crocodile_prompt-name-input").value="",$("#crocodile_prompt-model-select").val(null).trigger("change"),document.getElementById("crocodile_prompt-textarea-input").value="",$("#crocodile_prompt-tags-input").val(null).trigger("change");var e=document.getElementById("crocodile_save-prompt-btn");"Обновить промпт"===e.textContent&&(e.textContent="Сохранить промпт",e.onclick=Se,document.getElementById("crocodile_cancel-edit-btn").style.display="none")}function Ie(){ke(),be("Редактирование отменено.")}function Ee(){var e=$("#crocodile_preset-select-in-manage");e.empty();var t=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]");0===t.length?e.append(new Option("Нет сохранённых пресетов","",!1,!1)):(e.append(new Option("Выберите пресет","",!1,!1)),t.forEach((function(t){e.append(new Option(t.name,t.name,!1,!1))}))),e.trigger("change")}function Se(){return Be.apply(this,arguments)}function Be(){return(Be=d(i().mark((function e(){var t,n,a,r,o,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("crocodile_prompt-name-input").value.trim(),n=$("#crocodile_prompt-model-select").val(),a=document.getElementById("crocodile_prompt-textarea-input").value.trim(),r=$("#crocodile_prompt-tags-input").val(),!(t&&n&&a)){e.next=29;break}if(o=new Date,c=p(),-1===(l=c.findIndex((function(e){return e.name===t})))){e.next=17;break}return e.next=11,ye('Промпт с названием "'.concat(t,'" уже существует. Перезаписать его?'));case 11:if(e.sent){e.next=14;break}return e.abrupt("return");case 14:c[l]={name:t,model:n,text:a,tags:r,createdAt:c[l].createdAt||o.toISOString(),updatedAt:o.toISOString()},e.next=18;break;case 17:c.push({name:t,model:n,text:a,tags:r,createdAt:o.toISOString(),updatedAt:o.toISOString()});case 18:g(c),we(),B(),xe(),document.getElementById("crocodile_prompt-name-input").value="",$("#crocodile_prompt-model-select").val(null).trigger("change"),document.getElementById("crocodile_prompt-textarea-input").value="",$("#crocodile_prompt-tags-input").val(null).trigger("change"),be("Промпт успешно сохранён."),e.next=30;break;case 29:be("Пожалуйста, заполните все поля.");case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function we(){var e=document.getElementById("crocodile_prompt-list"),t=p(),n=$("#crocodile_filter-tags-select").val()||[],a=$("#crocodile_sort-prompts-select").val()||"name_asc";e.innerHTML="";var r=(new Date).toISOString();t.forEach((function(e){e.createdAt||(e.createdAt=r),e.updatedAt||(e.updatedAt=e.createdAt)})),g(t);var o=t.map((function(e,t){return{prompt:e,originalIndex:t}}));n.length>0&&(o=o.filter((function(e){var t=e.prompt;return!!(t.tags&&t.tags.length>0)&&n.every((function(e){return t.tags.includes(e)}))}))),o.sort((function(e,t){var n=e.prompt,r=t.prompt;switch(a){case"name_asc":return n.name.localeCompare(r.name);case"name_desc":return r.name.localeCompare(n.name);case"length_asc":return n.text.length-r.text.length;case"length_desc":return r.text.length-n.text.length;case"model_asc":return n.model.localeCompare(r.model);case"model_desc":return r.model.localeCompare(n.model);default:return 0}})),0!==o.length?o.forEach((function(t){var n=t.prompt,a=t.originalIndex,r=Te(n,a,{buttons:[{text:"Редактировать",className:"btn-primary edit-prompt",data:{index:a}},{text:"Дублировать",className:"btn-info duplicate-prompt",data:{index:a}},{text:"Удалить",className:"btn-danger delete-prompt",data:{index:a}}],eventHandlers:{".edit-prompt":function(e){return function(e){e=Number(e);var t=p()[e];document.getElementById("crocodile_prompt-name-input").value=t.name,$("#crocodile_prompt-model-select").val(t.model).trigger("change"),document.getElementById("crocodile_prompt-textarea-input").value=t.text,$("#crocodile_prompt-tags-input").val(t.tags).trigger("change");var n=document.getElementById("crocodile_save-prompt-btn");n.textContent="Обновить промпт",n.onclick=function(){!function(e){Pe.apply(this,arguments)}(e),n.textContent="Сохранить промпт",n.onclick=Se,document.getElementById("crocodile_cancel-edit-btn").style.display="none"},document.getElementById("crocodile_cancel-edit-btn").style.display="inline-block",$('#crocodile_promptsSubTab a[href="#crocodile_createPromptTabContent"]').tab("show")}(e.target.dataset.index)},".duplicate-prompt":function(e){return function(e){var t=p()[e];document.getElementById("crocodile_prompt-name-input").value=t.name+" (копия)",$("#crocodile_prompt-model-select").val(t.model).trigger("change"),document.getElementById("crocodile_prompt-textarea-input").value=t.text,$("#crocodile_prompt-tags-input").val(t.tags).trigger("change"),document.getElementById("crocodile_save-prompt-btn").textContent="Сохранить промпт",document.getElementById("crocodile_save-prompt-btn").onclick=Se,$('#crocodile_promptsSubTab a[href="#crocodile_createPromptTabContent"]').tab("show")}(e.target.dataset.index)},".delete-prompt":function(e){return function(e){return Ce.apply(this,arguments)}(e.target.dataset.index)}}});e.appendChild(r)})):e.innerHTML='<p class="text-muted">Промпты не найдены.</p>'}function Te(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=document.createElement("div");a.className="card mt-2";var r=e.text.length,o=new Date(e.createdAt).toLocaleString(),l=e.updatedAt?new Date(e.updatedAt).toLocaleString():o,s='<small class="text-muted">Создано: '.concat(o);e.updatedAt&&e.updatedAt!==e.createdAt&&(s+=" | Изменено: ".concat(l)),s+="</small>";var i="";return n.buttons&&n.buttons.length>0&&(i=n.buttons.map((function(e){var t=Object.entries(e.data||{}).map((function(e){var t=c(e,2),n=t[0],a=t[1];return"data-".concat(n,'="').concat(a,'"')})).join(" ");return'<button class="btn btn-sm '.concat(e.className,' mr-2" ').concat(t,">").concat(e.text,"</button>")})).join("")),a.innerHTML='\n        <div class="card-body">\n            <p><strong>Название:</strong> '.concat(e.name,"</p>\n            <p><strong>Модель:</strong> ").concat(e.model,"</p>\n            <p><strong>Промпт (").concat(r,"):</strong> ").concat(e.text,"</p>\n            ").concat(e.tags&&e.tags.length>0?"<p><strong>Теги:</strong> ".concat(e.tags.join(", "),"</p>"):"","\n            <p>").concat(s,"</p>\n            ").concat(i,"\n        </div>\n    "),n.eventHandlers&&Object.entries(n.eventHandlers).forEach((function(e){var t=c(e,2),n=t[0],r=t[1];a.querySelectorAll(n).forEach((function(e){e.addEventListener("click",r)}))})),a}function Ce(){return(Ce=d(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye("Вы уверены, что хотите удалить этот промпт?");case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:(n=p()).splice(t,1),g(n),we(),B(),xe(),be("Промпт удалён.");case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pe(){return(Pe=d(i().mark((function e(t){var n,a,r,o,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("crocodile_prompt-name-input").value.trim(),a=$("#crocodile_prompt-model-select").val(),r=document.getElementById("crocodile_prompt-textarea-input").value.trim(),o=$("#crocodile_prompt-tags-input").val(),n&&a&&r?(c=new Date,(l=p())[t]={name:n,model:a,text:r,tags:o,createdAt:l[t].createdAt||c.toISOString(),updatedAt:c.toISOString()},g(l),we(),B(),xe(),document.getElementById("crocodile_prompt-name-input").value="",$("#crocodile_prompt-model-select").val(null).trigger("change"),document.getElementById("crocodile_prompt-textarea-input").value="",$("#crocodile_prompt-tags-input").val(null).trigger("change"),be("Промпт обновлён.")):be("Пожалуйста, заполните все поля.");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(){we()}function Oe(){return Le.apply(this,arguments)}function Le(){return(Le=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye("Вы уверены, что хотите удалить все текущие промпты? Это действие нельзя будет отменить.");case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:g([]),we(),B(),xe(),be("Все промпты удалены.");case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(){return $e.apply(this,arguments)}function $e(){return($e=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ye("Вы уверены, что хотите удалить все текущие пресеты? Это действие нельзя будет отменить.");case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:localStorage.removeItem("promptPresetsAkula"),_e(),Ee(),document.getElementById("crocodile_preset-preview").innerHTML="",document.getElementById("crocodile_preset-count").textContent="0",be("Все пресеты удалены.");case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(){return je.apply(this,arguments)}function je(){return(je=d(i().mark((function e(){var t,n,a,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("crocodile_preset-name-input").value.trim()){e.next=4;break}return be("Пожалуйста, введите название пресета."),e.abrupt("return");case 4:if(0!==(n=p()).length){e.next=8;break}return be("Нет промптов для сохранения в пресет."),e.abrupt("return");case 8:if(a=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]"),-1===(r=a.findIndex((function(e){return e.name===t})))){e.next=19;break}return e.next=13,ye('Пресет с названием "'.concat(t,'" уже существует. Перезаписать его?'));case 13:if(e.sent){e.next=16;break}return e.abrupt("return");case 16:a[r]={name:t,prompts:n},e.next=20;break;case 19:a.push({name:t,prompts:n});case 20:localStorage.setItem("promptPresetsAkula",JSON.stringify(a)),_e(),Ee(),$("#crocodile_preset-select-prompts").val(t).trigger("change"),$("#crocodile_preset-select-in-manage").val(t).trigger("change"),be("Пресет успешно сохранён.");case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(){var e=$("#crocodile_preset-select-in-manage").val();if(e){var t=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]").find((function(t){return t.name===e}));if(t){var n=JSON.stringify(t,null,2);navigator.clipboard.writeText(n).then((function(){document.getElementById("crocodile_preset-json-input").value=n,be("JSON выбранного пресета скопирован в буфер обмена.")})).catch((function(e){console.error("Ошибка при копировании в буфер обмена:",e),be("Ошибка при копировании в буфер обмена.")}))}else be("Выбранный пресет не найден.")}else be("Нет выбранного пресета для экспорта.")}function He(){document.getElementById("crocodile_preset-json-input").value=""}function ze(){var e=document.getElementById("crocodile_preset-json-input").value;if(e)try{var t=JSON.parse(e);if(!t.name||!t.prompts)return void be("Некорректный формат пресета.");var n=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]"),a=n.findIndex((function(e){return e.name===t.name}));-1!==a?ye('Пресет с названием "'.concat(t.name,'" уже существует. Перезаписать его?')).then((function(e){e&&(n[a]=t,localStorage.setItem("promptPresetsAkula",JSON.stringify(n)),_e(),Ee(),$("#crocodile_preset-select-prompts").val(t.name).trigger("change"),$("#crocodile_preset-select-in-manage").val(t.name).trigger("change"),be("Пресет успешно импортирован."))})):(n.push(t),localStorage.setItem("promptPresetsAkula",JSON.stringify(n)),_e(),Ee(),$("#crocodile_preset-select-prompts").val(t.name).trigger("change"),$("#crocodile_preset-select-in-manage").val(t.name).trigger("change"),be("Пресет успешно импортирован."))}catch(e){console.error("Ошибка при импорте пресета:",e),be("Ошибка при импорте пресета. Проверьте формат JSON.")}else be("Поле JSON Пресета пустое.")}function Fe(){var e=$("#crocodile_preset-select-prompts").val();if(e){var t=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]").find((function(t){return t.name===e}));if(t){var n=p();t.prompts.forEach((function(e){if(n.some((function(t){return t.name===e.name}))){var t=n.findIndex((function(t){return t.name===e.name}));n[t]=e}else n.push(e)})),g(n),we(),B(),xe(),be("Промпты из пресета добавлены к текущим промптам.")}}else be("Нет выбранного пресета для добавления.")}function Re(){return We.apply(this,arguments)}function We(){return(We=d(i().mark((function e(){var t,n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#crocodile_preset-select-prompts").val()){e.next=4;break}return be("Нет выбранного пресета для замены."),e.abrupt("return");case 4:return e.next=6,ye("Вы уверены, что хотите заменить текущие промпты на выбранный пресет? Это действие нельзя будет отменить.");case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:if(n=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]"),a=n.find((function(e){return e.name===t}))){e.next=13;break}return e.abrupt("return");case 13:g(a.prompts),we(),B(),xe(),be("Текущие промпты заменены на промпты из пресета.");case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(){return De.apply(this,arguments)}function De(){return(De=d(i().mark((function e(){var t,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=$("#crocodile_preset-select-prompts").val()){e.next=4;break}return be("Нет выбранного пресета для удаления."),e.abrupt("return");case 4:return e.next=6,ye('Вы уверены, что хотите удалить пресет "'.concat(t,'"?'));case 6:if(e.sent){e.next=9;break}return e.abrupt("return");case 9:n=(n=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]")).filter((function(e){return e.name!==t})),localStorage.setItem("promptPresetsAkula",JSON.stringify(n)),_e(),document.getElementById("crocodile_preset-preview").innerHTML="",document.getElementById("crocodile_preset-count").textContent="0",be("Пресет удалён.");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qe(){var e=$("#crocodile_preset-select-prompts").val(),t=document.getElementById("crocodile_preset-preview"),n=document.getElementById("crocodile_preset-count");if(t.innerHTML="",n.textContent="0",e){var a=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]").find((function(t){return t.name===e}));a&&(n.textContent=a.prompts.length,0===a.prompts.length?t.innerHTML='<p class="text-muted">Пресет пуст.</p>':(t.innerHTML="",a.prompts.forEach((function(e,n){var a=Te(e,n,{buttons:[{text:"Добавить этот промпт",className:"btn-primary add-single-prompt",data:{"prompt-index":n}}],eventHandlers:{".add-single-prompt":function(e){return function(e){var t=$("#crocodile_preset-select-prompts").val();if(t){var n=JSON.parse(localStorage.getItem("promptPresetsAkula")||"[]").find((function(e){return e.name===t}));if(n){var a=n.prompts[e],r=p();if(r.some((function(e){return e.name===a.name}))){var o=r.findIndex((function(e){return e.name===a.name}));r[o]=a}else r.push(a);g(r),we(),B(),xe(),be('Промпт "'.concat(a.name,'" добавлен к текущим промптам.'))}}}(e.target.dataset.promptIndex)}}});t.appendChild(a)}))))}}function Ke(){var e;document.getElementById("settings").innerHTML='\n        <div class="mt-3">\n            \x3c!-- Инструкция --\x3e\n            <div class="alert alert-info">\n                <strong>Настройки:</strong>\n                <p>Здесь вы можете ввести ваш API-ключ для доступа к сервисам OpenRouter.</p>\n            </div>\n            <div class="form-group">\n                <label for="api-key" class="form-label">API Ключ:</label>\n                <input type="password" id="api-key" class="form-control" placeholder="Введите ваш API ключ" title="Введите ваш API ключ для доступа к сервисам OpenRouter">\n            </div>\n        </div>\n    ',document.getElementById("api-key").onchange=Ue,e=localStorage.getItem("apiKey")||"",document.getElementById("api-key").value=e}function Ue(){var e=document.getElementById("api-key").value;localStorage.setItem("apiKey",e)}function Ve(){document.getElementById("grammar").innerHTML='\n    <div class="mt-3">\n        \x3c!-- Навигация по табам --\x3e\n        <ul class="nav nav-tabs" id="grammarTab" role="tablist">\n            <li class="nav-item">\n                <a class="nav-link active" id="main-tab" data-toggle="tab" href="#mainContent" role="tab" aria-controls="mainContent" aria-selected="true">Основное</a>\n            </li>\n            <li class="nav-item">\n                <a class="nav-link" id="settings-tab" data-toggle="tab" href="#settingsContent" role="tab" aria-controls="settingsContent" aria-selected="false">Настройки</a>\n            </li>\n            <li class="nav-item">\n                <a class="nav-link" id="presets-tab" data-toggle="tab" href="#presetsContent" role="tab" aria-controls="presetsContent" aria-selected="false">Пресеты</a>\n            </li>\n        </ul>\n\n        \x3c!-- Содержимое табов --\x3e\n        <div class="tab-content" id="grammarTabContent">\n            \x3c!-- Основное --\x3e\n            <div class="tab-pane fade show active" id="mainContent" role="tabpanel" aria-labelledby="main-tab">\n                \x3c!-- Инструкция по использованию --\x3e\n                <div class="alert alert-info mt-3">\n                    <strong>Инструкция:</strong>\n                    <ul>\n                        <li>Выберите модель и типы проверок, которые вы хотите применить к тексту.</li>\n                        <li>Выделите текст, который хотите проверить (от 1 до 4 абзацев).</li>\n                        <li>Нажмите кнопку "Проверить".</li>\n                    </ul>\n                </div>\n\n                \x3c!-- Аккордеон для модели и типов проверок --\x3e\n                <div class="accordion mt-3" id="mainAccordion">\n                    <div class="card">\n                        <div class="card-header" id="mainSettingsHeading">\n                            <h2 class="mb-0">\n                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#mainSettingsCollapse" aria-expanded="true" aria-controls="mainSettingsCollapse">\n                                    Настройки модели и проверок\n                                </button>\n                            </h2>\n                        </div>\n                        <div id="mainSettingsCollapse" class="collapse show" aria-labelledby="mainSettingsHeading" data-parent="#mainAccordion">\n                            <div class="card-body">\n                                \x3c!-- Модель для проверки --\x3e\n                                <div class="form-group">\n                                    <label for="grammar-model">Модель для проверки:</label>\n                                    <select id="grammar-model" class="form-control" title="Выберите модель нейросети для проверки текста"></select>\n                                </div>\n                                \x3c!-- Типы проверок --\x3e\n                                <div class="form-group">\n                                    <label>Типы проверок:</label>\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="checkbox" id="check-grammatical">\n                                        <label class="form-check-label" for="check-grammatical" title="Проверка на грамматические ошибки">\n                                            Грамматические (Beta)\n                                        </label>\n                                    </div>\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="checkbox" id="check-syntactic">\n                                        <label class="form-check-label" for="check-syntactic" title="Проверка на синтаксические ошибки">\n                                            Синтаксические (Beta)\n                                        </label>\n                                    </div>\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="checkbox" id="check-stylistic" checked>\n                                        <label class="form-check-label" for="check-stylistic" title="Проверка на стилистические ошибки">\n                                            Стилистические\n                                        </label>\n                                    </div>\n                                    <div class="form-check">\n                                        <input class="form-check-input" type="checkbox" id="check-logical" checked>\n                                        <label class="form-check-label" for="check-logical" title="Проверка на логические ошибки">\n                                            Логические\n                                        </label>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Кнопки управления --\x3e\n                <div class="form-group mt-3" id="grammar-btn-group">\n                    <div class="btn-group" role="group" id="buttonGroup">\n                        <button id="check-grammar" class="btn btn-primary">Проверить</button>\n                        <button id="select-current-text" class="btn btn-info" style="display: none;">Выделить текущий текст</button>\n                        <button id="finish-current-fragment" class="btn btn-warning" style="display: none;">Завершить работу с фрагментом</button>\n                    </div>\n                </div>\n\n                <div id="kuga_selection-info" class="mt-3" style="display: none;"></div>\n\n                \x3c!-- Загрузчик и кнопка Отменить --\x3e\n                <div id="loading" class="mt-3 text-center" style="display: none;">\n                    <div id="progress-container" style="display: none;">\n                        <div class="progress">\n                            <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;">0%</div>\n                        </div>\n                        <div id="progress-text" class="mt-2">Обработано 0 из 0 чанков</div>\n                    </div>\n                    <div id="spinner" style="display: none;">\n                        <div class="spinner-border text-primary" role="status">\n                            <span class="sr-only">Загрузка...</span>\n                        </div>\n                    </div>\n                    <div class="mt-3">\n                        <button id="cancel-check" class="btn btn-secondary">Отменить</button>\n                    </div>\n                </div>\n\n                \x3c!-- Фильтр результатов --\x3e\n                <div id="filter-container" class="mt-3" style="display: none;">\n                    <label for="filter-select">Фильтр результатов:</label>\n                    <select id="filter-select" class="form-control">\n                        <option value="all">Все ошибки</option>\n                        <option value="can_edit">Только исправляемые</option>\n                        <option value="cannot_edit">Только не исправляемые</option>\n                    </select>\n                </div>\n\n                \x3c!-- Вкладки для текущих ошибок и истории исправлений --\x3e\n                <ul class="nav nav-tabs mt-3" id="grammarTabs" role="tablist">\n                    <li class="nav-item">\n                        <a class="nav-link active" id="current-tab" data-toggle="tab" href="#current" role="tab">Текущие ошибки</a>\n                    </li>\n\n    <li class="nav-item">\n        <a class="nav-link" id="history-tab" data-toggle="tab" href="#history" role="tab">История исправлений</a>\n    </li>\n</ul>\n<div class="tab-content" id="grammarTabContent">\n    <div class="tab-pane fade show active" id="current" role="tabpanel">\n        <div id="grammar-results"></div>\n    </div>\n    <div class="tab-pane fade" id="history" role="tabpanel">\n        <div id="grammar-history"></div>\n    </div>\n</div>\n            </div>\n\n            \x3c!-- Настройки --\x3e\n            <div class="tab-pane fade" id="settingsContent" role="tabpanel" aria-labelledby="settings-tab">\n                \x3c!-- Инструкция для Настроек --\x3e\n                <div class="alert alert-info mt-3">\n                    <strong>Инструкция:</strong>\n                    <p>Здесь вы можете настроить параметры обработки текста, модели, ошибки и промпты.</p>\n                </div>\n\n                \x3c!-- Навигация по подтабам Настроек --\x3e\n                <ul class="nav nav-tabs mt-3" id="settingsSubTab" role="tablist">\n                    <li class="nav-item">\n                        <a class="nav-link active" id="text-processing-tab" data-toggle="tab" href="#textProcessingContent" role="tab" aria-controls="textProcessingContent" aria-selected="true">Настройки обработки текста</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="model-settings-tab" data-toggle="tab" href="#modelSettingsContent" role="tab" aria-controls="modelSettingsContent" aria-selected="false">Настройки модели</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="error-settings-tab" data-toggle="tab" href="#errorSettingsContent" role="tab" aria-controls="errorSettingsContent" aria-selected="false">Настройки ошибок</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="prompt-settings-tab" data-toggle="tab" href="#promptSettingsContent" role="tab" aria-controls="promptSettingsContent" aria-selected="false">Настройки промптов</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="additional-options-tab" data-toggle="tab" href="#additionalOptionsContent" role="tab" aria-controls="additionalOptionsContent" aria-selected="false">Дополнительные опции</a>\n                    </li>\n                </ul>\n\n                \x3c!-- Содержимое подтабов Настроек --\x3e\n                <div class="tab-content" id="settingsSubTabContent">\n                    \x3c!-- Настройки обработки текста --\x3e\n                    <div class="tab-pane fade show active" id="textProcessingContent" role="tabpanel" aria-labelledby="text-processing-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете настроить параметры обработки текста, такие как максимальное количество символов и разбивка на чанки.</p>\n                        </div>\n                        \x3c!-- Максимальное количество символов --\x3e\n                        <div class="form-group">\n                            <label for="max-chars">Максимальное количество символов для проверки (0 для без лимита):</label>\n                            <input type="number" id="max-chars" class="form-control" value="2000" min="0">\n                        </div>\n                        \x3c!-- Опция разбивать текст на чанки --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="split-into-chunks-checkbox">\n                            <label class="form-check-label" for="split-into-chunks-checkbox" title="Разбивать текст на небольшие части для обработки">\n                                Разбивать текст на чанки\n                            </label>\n                        </div>\n                        \x3c!-- Размер чанка --\x3e\n                        <div class="form-group mt-2">\n                            <label for="chunk-size">Размер чанка (в предложениях):</label>\n                            <input type="number" id="chunk-size" class="form-control" value="8" min="1">\n                        </div>\n                    </div>\n                    \x3c!-- Настройки модели --\x3e\n                    <div class="tab-pane fade" id="modelSettingsContent" role="tabpanel" aria-labelledby="model-settings-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете настроить параметры модели, такие как температура и максимальное количество токенов.</p>\n                        </div>\n                        \x3c!-- Температура --\x3e\n                        <div class="form-group">\n                            <label for="temperature">Температура (0.0 - 1.0):</label>\n                            <input type="number" id="temperature" class="form-control" value="0.1" min="0.0" max="1.0" step="0.1" title="Контролирует степень случайности модели. Низкие значения делают ответы более детерминированными">\n                        </div>\n                        \x3c!-- Максимальное количество токенов --\x3e\n                        <div class="form-group">\n                            <label for="max-tokens">Максимальное количество токенов:</label>\n                            <input type="number" id="max-tokens" class="form-control" value="4000" min="1" title="Максимальное количество токенов в ответе модели">\n                        </div>\n                        \x3c!-- Опция включения response_format --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="response-format-checkbox">\n                            <label class="form-check-label" for="response-format-checkbox" title="Использовать определенный формат ответа от модели">\n                                Использовать response_format: {"type": "json_object"}\n                            </label>\n                        </div>\n                    </div>\n                    \x3c!-- Настройки ошибок --\x3e\n                    <div class="tab-pane fade" id="errorSettingsContent" role="tabpanel" aria-labelledby="error-settings-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете настроить параметры обработки ошибок, такие как повтор запроса при ошибке.</p>\n                        </div>\n                        \x3c!-- Повторить в случае ошибки --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="retry-on-error-checkbox" checked>\n                            <label class="form-check-label" for="retry-on-error-checkbox" title="Автоматически повторить запрос при возникновении ошибки">\n                                Повторить в случае ошибки\n                            </label>\n                        </div>\n                        \x3c!-- Количество повторов --\x3e\n                        <div class="form-group mt-2">\n                            <label for="retry-count">Количество повторов при ошибке:</label>\n                            <input type="number" id="retry-count" class="form-control" value="3" min="1" title="Сколько раз повторять запрос при ошибке">\n                        </div>\n                    </div>\n                    \x3c!-- Настройки промптов --\x3e\n                    <div class="tab-pane fade" id="promptSettingsContent" role="tabpanel" aria-labelledby="prompt-settings-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете настроить промпты для модели.</p>\n                        </div>\n                        \x3c!-- Опция редактирования промптов --\x3e\n                        <div class="form-check mt-3">\n                            <input class="form-check-input" type="checkbox" id="edit-prompts-checkbox" checked>\n                            <label class="form-check-label" for="edit-prompts-checkbox" title="Позволяет редактировать системные промпты">\n                                Редактировать системные промпты\n                            </label>\n                        </div>\n                        \x3c!-- Аккордеон для редактирования промптов --\x3e\n                        <div id="prompts-accordion" class="mt-3">\n                            <div class="accordion" id="promptsAccordion">\n                                \x3c!-- Промпт роли --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingRolePrompt">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseRolePrompt" aria-expanded="true" aria-controls="collapseRolePrompt">\n                                                Промпт роли\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseRolePrompt" class="collapse" aria-labelledby="headingRolePrompt" data-parent="#promptsAccordion">\n                                        <div class="card-body">\n                                            <textarea id="prompt-role" class="form-control" rows="3" placeholder="Например: Ты - опытный редактор и лингвист." title="Устанавливает роль для модели"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Грамматические ошибки --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingGrammar">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseGrammar" aria-expanded="false" aria-controls="collapseGrammar">\n                                                Грамматические ошибки\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseGrammar" class="collapse" aria-labelledby="headingGrammar" data-parent="#promptsAccordion">\n                                        <div class="card-body"> <textarea id="prompt-grammatical" class="form-control" rows="5" title="Инструкции для поиска грамматических ошибок"></textarea>\n</div>\n                                    </div>\n                                </div>\n                                \x3c!-- Синтаксические ошибки --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingSyntactic">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseSyntactic" aria-expanded="false" aria-controls="collapseSyntactic">\n                                                Синтаксические ошибки\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseSyntactic" class="collapse" aria-labelledby="headingSyntactic" data-parent="#promptsAccordion">\n                                        <div class="card-body">\n                                            <textarea id="prompt-syntactic" class="form-control" rows="5" title="Инструкции для поиска синтаксических ошибок"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Стилистические ошибки --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingStylistic">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseStylistic" aria-expanded="false" aria-controls="collapseStylistic">\n                                                Стилистические ошибки\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseStylistic" class="collapse" aria-labelledby="headingStylistic" data-parent="#promptsAccordion">\n                                        <div class="card-body">\n                                            <textarea id="prompt-stylistic" class="form-control" rows="5" title="Инструкции для поиска стилистических ошибок"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Логические ошибки --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingLogical">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseLogical" aria-expanded="false" aria-controls="collapseLogical">\n                                                Логические ошибки\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseLogical" class="collapse" aria-labelledby="headingLogical" data-parent="#promptsAccordion">\n                                        <div class="card-body">\n                                            <textarea id="prompt-logical" class="form-control" rows="5" title="Инструкции для поиска логических ошибок"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                                \x3c!-- Примечание о проверяемом тексте --\x3e\n                                <div class="card">\n                                    <div class="card-header" id="headingTextNote">\n                                        <h2 class="mb-0">\n                                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTextNote" aria-expanded="false" aria-controls="collapseTextNote">\n                                                Примечание о проверяемом тексте\n                                            </button>\n                                        </h2>\n                                    </div>\n                                    <div id="collapseTextNote" class="collapse" aria-labelledby="headingTextNote" data-parent="#promptsAccordion">\n                                        <div class="card-body">\n                                            <textarea id="prompt-text-note" class="form-control" rows="3" placeholder="Например: Текст является научной статьей по физике." title="Дополнительная информация о тексте для модели"></textarea>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                            \x3c!-- Кнопка сброса промптов --\x3e\n                            <button id="reset-prompts" class="btn btn-secondary mt-3">Сбросить промпты</button>\n                            <div id="prompt-message" class="mt-2"></div>\n                        </div>\n                    </div>\n                    \x3c!-- Дополнительные опции --\x3e\n                    <div class="tab-pane fade" id="additionalOptionsContent" role="tabpanel" aria-labelledby="additional-options-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете настроить дополнительные опции для отображения результатов.</p>\n                        </div>\n                        \x3c!-- Выделение проблемного текста --\x3e\n                        <div class="form-check">\n                            <input class="form-check-input" type="checkbox" id="highlight-checkbox" checked>\n                            <label class="form-check-label" for="highlight-checkbox" title="Выделить проблемный текст в документе">\n                                Выделять проблемный текст\n                            </label>\n                        </div>\n                        \x3c!-- Добавление комментариев --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="comment-checkbox">\n                            <label class="form-check-label" for="comment-checkbox" title="Добавить комментарии к проблемному тексту">\n                                Добавлять комментарии к проблемному тексту\n                            </label>\n                        </div>\n                        \x3c!-- Изменение цвета исправленного текста --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="highlight-corrected-checkbox" checked>\n                            <label class="form-check-label" for="highlight-corrected-checkbox" title="Изменять цвет исправленного текста">\n                                Изменять цвет исправленного текста\n                            </label>\n                        </div>\n                        \x3c!-- Удалять подсветку при завершении работы с фрагментом --\x3e\n                        <div class="form-check mt-2">\n                            <input class="form-check-input" type="checkbox" id="remove-highlight-on-finish-checkbox">\n                            <label class="form-check-label" for="remove-highlight-on-finish-checkbox" title="Удалять подсветку при завершении работы с фрагментом">\n                                Удалять подсветку при завершении работы с фрагментом\n                            </label>\n                        </div>\n                        <button id="remove-all-markers" class="btn btn-danger">Удалить все маркеры из текста</button>\n                        \x3c!-- Message area --\x3e\n                        <div id="message" class="mt-3"></div>\n                    </div>\n                </div>\n            </div>\n            \x3c!-- Пресеты --\x3e\n            <div class="tab-pane fade" id="presetsContent" role="tabpanel" aria-labelledby="presets-tab">\n                \x3c!-- Инструкция для Пресетов --\x3e\n                <div class="alert alert-info mt-3">\n                    <strong>Инструкция:</strong>\n                    <p>Здесь вы можете сохранять, экспортировать и импортировать ваши настройки в виде пресетов.</p>\n                </div>\n                \x3c!-- Навигация по подтабам Пресетов --\x3e\n                <ul class="nav nav-tabs mt-3" id="presetsSubTab" role="tablist">\n                    <li class="nav-item">\n                        <a class="nav-link active" id="save-preset-tab" data-toggle="tab" href="#savePresetContent" role="tab" aria-controls="savePresetContent" aria-selected="true">Сохранить</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="-preset-tab" data-toggle="tab" href="#PresetContent" role="tab" aria-controls="PresetContent" aria-selected="false">Экспорт</a>\n                    </li>\n                    <li class="nav-item">\n                        <a class="nav-link" id="import-preset-tab" data-toggle="tab" href="#importPresetContent" role="tab" aria-controls="importPresetContent" aria-selected="false">Импорт</a>\n                    </li>\n                </ul>\n                \x3c!-- Содержимое подтабов Пресетов --\x3e\n                <div class="tab-content" id="presetsSubTabContent">\n                    \x3c!-- Сохранить пресет --\x3e\n                    <div class="tab-pane fade show active" id="savePresetContent" role="tabpanel" aria-labelledby="save-preset-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете сохранить текущие настройки как пресет.</p>\n                        </div>\n                        \x3c!-- Выбор пресета --\x3e\n                        <div class="form-group">\n                            <label for="preset-select">Выберите пресет:</label>\n                            <select id="preset-select" class="form-control" title="Выберите сохраненный пресет настроек"></select>\n                        </div>\n                        \x3c!-- Имя пресета для сохранения --\x3e\n                        <div class="form-group">\n                            <label for="preset-name">Название пресета для сохранения:</label>\n                            <input type="text" id="preset-name" class="form-control" placeholder="Введите название пресета" title="Введите название для сохранения текущих настроек как пресет">\n                        </div>\n                        \x3c!-- Кнопки для управления пресетами --\x3e\n                        <div class="form-group mt-3">\n                            <button id="save-preset" class="btn btn-primary">Сохранить текущие настройки как пресет</button>\n                            <button id="delete-preset" class="btn btn-danger">Удалить выбранный пресет</button>\n                        </div>\n                    </div>\n                    \x3c!-- Экспорт пресета --\x3e\n                    <div class="tab-pane fade" id="PresetContent" role="tabpanel" aria-labelledby="-preset-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете экспортировать выбранный пресет в формате JSON.</p>\n                        </div>\n                        <label for="preset-json">Экспорт пресета (JSON):</label>\n                        <textarea id="preset-json" class="form-control" rows="5" readonly title="Скопируйте этот JSON для экспорта пресета"></textarea>\n                        <button id="copy-preset-json" class="btn btn-secondary mt-2">Скопировать JSON</button>\n                    </div>\n                    \x3c!-- Импорт пресета --\x3e\n                    <div class="tab-pane fade" id="importPresetContent" role="tabpanel" aria-labelledby="import-preset-tab">\n                        <div class="alert alert-info mt-3">\n                            <p>Здесь вы можете импортировать пресет из JSON.</p>\n                        </div>\n                        <label for="preset-json-import">Импорт пресета (JSON):</label>\n                        <textarea id="preset-json-import" class="form-control" rows="5" title="Вставьте JSON для импорта пресета"></textarea>\n                        <button id="import-preset" class="btn btn-secondary mt-2">Импортировать пресет</button>\n                    </div>\n                </div>\n                \x3c!-- Сообщения о действиях с пресетами --\x3e\n                        <div id="preset-message" class="mt-2"></div>\n                <div id="preset-confirmation" class="mt-2" style="display:none;">\n                            <div class="alert alert-warning">\n                                <p id="preset-confirmation-message"></p>\n                                <button id="preset-confirm-yes" class="btn btn-danger">Да</button>\n                                <button id="preset-confirm-no" class="btn btn-secondary">Нет</button>\n                            </div>\n                        </div>\n                \x3c!-- Кнопка сброса настроек --\x3e\n                <button id="reset-settings" class="btn btn-secondary mt-3">Сбросить настройки</button>\n                <div id="reset-message" class="mt-2"></div>\n            </div>\n        </div>\n    </div>\n',$("#grammar-model").select2({width:"100%",placeholder:"Выберите модель для проверки"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)})).on("change",(function(){var e=$(this).val();localStorage.setItem("grammarModel",e),Et()})),ct(),lt(),$("#preset-select").select2({width:"100%",placeholder:"Выберите пресет"}).on("select2:opening",(function(){setTimeout((function(){$(".select2-search__field").get(0).focus()}),0)})),ut(),gt(),document.getElementById("check-grammar").onclick=Ct,document.getElementById("highlight-checkbox").onchange=function(){dt(),Et()},document.getElementById("comment-checkbox").onchange=function(){dt(),Et()},document.getElementById("highlight-corrected-checkbox").onchange=function(){dt(),Et()},document.getElementById("check-grammatical").onchange=function(){dt(),Et()},document.getElementById("check-syntactic").onchange=function(){dt(),Et()},document.getElementById("check-stylistic").onchange=function(){dt(),Et()},document.getElementById("check-logical").onchange=function(){dt(),Et()},document.getElementById("split-into-chunks-checkbox").onchange=function(){dt(),Et()},document.getElementById("chunk-size").onchange=function(){dt(),Et()},document.getElementById("max-chars").onchange=function(){dt(),Et()},document.getElementById("temperature").onchange=function(){dt(),Et()},document.getElementById("max-tokens").onchange=function(){dt(),Et()},document.getElementById("response-format-checkbox").onchange=function(){dt(),Et()},document.getElementById("retry-on-error-checkbox").onchange=function(){dt(),Et()},document.getElementById("retry-count").onchange=function(){dt(),Et()},document.getElementById("edit-prompts-checkbox").onchange=function(){pt(),Et()},document.getElementById("prompt-role").addEventListener("input",(function(){ft(),Et()})),document.getElementById("prompt-grammatical").addEventListener("input",(function(){ft(),Et()})),document.getElementById("prompt-syntactic").addEventListener("input",(function(){ft(),Et()})),document.getElementById("prompt-stylistic").addEventListener("input",(function(){ft(),Et()})),document.getElementById("prompt-logical").addEventListener("input",(function(){ft(),Et()})),document.getElementById("prompt-text-note").addEventListener("input",(function(){ft(),Et()})),document.getElementById("reset-prompts").onclick=function(){var e;e={role:"Ты - опытный редактор и лингвист.","грамматическая":"- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.","синтаксическая":"- Ищи синтаксические ошибки, связанные с неправильным построением предложений.","стилистическая":"- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.","логическая":"- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте."},document.getElementById("prompt-role").value=e.role,document.getElementById("prompt-grammatical").value=e["грамматическая"],document.getElementById("prompt-syntactic").value=e["синтаксическая"],document.getElementById("prompt-stylistic").value=e["стилистическая"],document.getElementById("prompt-logical").value=e["логическая"],document.getElementById("prompt-text-note").value="",ft(),vt("Промпты сброшены к значениям по умолчанию."),Et()},document.getElementById("reset-settings").onclick=mt,document.getElementById("preset-select").onchange=kt,document.getElementById("save-preset").onclick=yt,document.getElementById("delete-preset").onclick=It,document.getElementById("copy-preset-json").onclick=St,document.getElementById("import-preset").onclick=Xt,document.getElementById("cancel-check").onclick=Mt,document.getElementById("filter-select").onchange=function(){return Ft(window.grammarResults)},document.getElementById("select-current-text").onclick=Xe,document.getElementById("finish-current-fragment").onclick=et,document.getElementById("remove-all-markers").onclick=wt,window.abortController=null,window.isLoadingPreset=!1,window.currentSelectionTimestamp=null,window.isGrammarCheckCompleted=!1,window.appliedCorrections=[],window.savedSelection=null,function(){function e(){if(!window.isLoadingPreset){dt(),ft();var e,t=ht(),n=bt(),a=null,r=o(JSON.parse(localStorage.getItem("grammarPresets")||"[]"));try{for(r.s();!(e=r.n()).done;){var c=e.value;if(_t(c.settings,t)&&_t(c.prompts,n)){a=c.name;break}}}catch(e){r.e(e)}finally{r.f()}a?($("#preset-select").val(a).trigger("change"),localStorage.setItem("lastSelectedPreset",a)):($("#preset-select").val("current").trigger("change"),localStorage.removeItem("lastSelectedPreset")),Et()}}["highlight-checkbox","comment-checkbox","highlight-corrected-checkbox","check-grammatical","check-syntactic","check-stylistic","check-logical","split-into-chunks-checkbox","chunk-size","max-chars","temperature","max-tokens","response-format-checkbox","retry-on-error-checkbox","retry-count","edit-prompts-checkbox"].forEach((function(t){var n=document.getElementById(t);n&&n.addEventListener("change",e)})),["prompt-role","prompt-grammatical","prompt-syntactic","prompt-stylistic","prompt-logical","prompt-text-note"].forEach((function(t){var n=document.getElementById(t);n&&n.addEventListener("input",e)})),$("#grammar-model").on("change",e)}()}function Xe(){return Ze.apply(this,arguments)}function Ze(){return Ze=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.body,(a=n.search("START_TIMESTAMP",{matchCase:!0})).load("items"),e.next=5,t.sync();case 5:return(r=n.search("END_TIMESTAMP",{matchCase:!0})).load("items"),e.next=9,t.sync();case 9:console.log(a,r),a.items.length>0&&r.items.length>0?(o=a.items[0],c=r.items[0],o.expandTo(c).select(),console.log("Текущий текст выделен"),document.getElementById("kuga_selection-info").textContent="Текст между маркерами выделен"):(console.log("Маркеры не найдены"),document.getElementById("kuga_selection-info").textContent="Маркеры не найдены");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Ошибка при выделении текущего текста:",e.t0),document.getElementById("kuga_selection-info").textContent="Ошибка: ".concat(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),Ze.apply(this,arguments)}function Ye(e){return Qe.apply(this,arguments)}function Qe(){return(Qe=d(i().mark((function e(t){var n,a,r,o,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.document.body,a=n.search("START_TIMESTAMP",{matchCase:!0}),r=n.search("END_TIMESTAMP",{matchCase:!0}),t.load(a,"items"),t.load(r,"items"),e.next=9,t.sync();case 9:if(!(a.items.length>0&&r.items.length>0)){e.next=16;break}return o=a.items[0],c=r.items[0],l=o.expandTo(c),e.abrupt("return",l);case 16:return e.abrupt("return",null);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function et(){return tt.apply(this,arguments)}function tt(){return(tt=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wt();case 3:if(!settings.removeHighlightOnFinish){e.next=6;break}return e.next=6,nt();case 6:window.appliedCorrections=[],window.grammarResults=[],document.getElementById("grammar-results").innerHTML="",document.getElementById("grammar-history").innerHTML="",document.getElementById("filter-container").style.display="none",document.getElementById("select-current-text").style.display="none",document.getElementById("finish-current-fragment").style.display="none",console.log("Работа с текущим фрагментом завершена"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Ошибка при завершении работы с фрагментом:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})))).apply(this,arguments)}function nt(){return at.apply(this,arguments)}function at(){return at=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,c,l,s,u,d,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.body.getRange()).load("text"),e.next=4,t.sync();case 4:a=qt(n.text,250),r=o(a),e.prev=6,r.s();case 8:if((c=r.n()).done){e.next=39;break}return l=c.value,(s=n.search(l,{matchCase:!0,matchWholeWord:!1})).load("items"),e.next=14,t.sync();case 14:u=o(s.items),e.prev=15,u.s();case 17:if((d=u.n()).done){e.next=27;break}return(m=d.value).font.load("highlightColor"),e.next=22,t.sync();case 22:console.log(m.font.highlightColor),m.font.highlightColor=null,"yellow"!==m.font.highlightColor&&"green"!==m.font.highlightColor&&"lightGreen"!==m.font.highlightColor||(m.font.highlightColor="noHighlight");case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),u.e(e.t0);case 32:return e.prev=32,u.f(),e.finish(32);case 35:return e.next=37,t.sync();case 37:e.next=8;break;case 39:e.next=44;break;case 41:e.prev=41,e.t1=e.catch(6),r.e(e.t1);case 44:return e.prev=44,r.f(),e.finish(44);case 47:console.log("Все выделения удалены");case 48:case"end":return e.stop()}}),e,null,[[6,41,44,47],[15,29,32,35]])})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Ошибка при удалении выделений:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),at.apply(this,arguments)}function rt(e){e.resolvedManually=!e.can_edit,appliedCorrections.push(e)}function ot(e,t,n){var a=t[e];a&&(rt(a),t.splice(e,1),Ft(t),tn(),nn())}function ct(){var e=$("#grammar-model"),t=JSON.parse(localStorage.getItem("models")||"[]");console.log("Loaded models:",t),e.empty();var n=null;t.forEach((function(t,a){var r=new Option(t.name,t.id,!1,!1);e.append(r),n||(n=t.id),"anthropic/claude-3.5-sonnet:beta"===t.id&&(n=t.id)})),console.log("Default model ID:",n);var a=localStorage.getItem("grammarModel");console.log("Saved model:",a),a&&t.some((function(e){return e.id===a}))?(e.val(a).trigger("change"),console.log("Selected saved model: ".concat(a))):n?(e.val(n).trigger("change"),console.log("Selected default model: ".concat(n))):console.log("No models available to select")}function lt(){var e=$("#preset-select");e.empty();var t=new Option("Текущие настройки","current",!1,!1);e.append(t);var n=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),a=localStorage.getItem("lastSelectedPreset")||null;n.forEach((function(t){var n=new Option(t.name,t.name,!1,!1);e.append(n)})),a&&"current"!==a?e.val(a).trigger("change"):e.val("current").trigger("change")}function st(e,t){var n=localStorage.getItem(e);return null==n?t:"true"===n}function it(e,t){var n=localStorage.getItem(e);if(null==n)return t;var a=parseFloat(n);return isNaN(a)?t:a}function ut(){var e=localStorage.getItem("lastSelectedPreset");if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t)return $("#preset-select").val(t.name).trigger("change"),void kt();localStorage.removeItem("lastSelectedPreset"),$("#preset-select").val("current").trigger("change")}else $("#preset-select").val("current").trigger("change");var n=st("highlightErrors",!0);document.getElementById("highlight-checkbox").checked=n;var a=st("addComments",!1);document.getElementById("comment-checkbox").checked=a;var r=st("highlightCorrected",!0);document.getElementById("highlight-corrected-checkbox").checked=r;var o=st("checkGrammatical",!1),c=st("checkSyntactic",!1),l=st("checkStylistic",!0),s=st("checkLogical",!0);document.getElementById("check-grammatical").checked=o,document.getElementById("check-syntactic").checked=c,document.getElementById("check-stylistic").checked=l,document.getElementById("check-logical").checked=s;var i=st("splitIntoChunks",!1);document.getElementById("split-into-chunks-checkbox").checked=i;var u=it("chunkSize",8);document.getElementById("chunk-size").value=u;var d=it("maxChars",2e3);document.getElementById("max-chars").value=d;var m=it("temperature",.1);document.getElementById("temperature").value=m;var p=it("maxTokens",4e3);document.getElementById("max-tokens").value=p;var g=st("responseFormat",!1);document.getElementById("response-format-checkbox").checked=g;var f=st("retryOnError",!0);document.getElementById("retry-on-error-checkbox").checked=f;var v=it("retryCount",3);document.getElementById("retry-count").value=v;var h=st("editPrompts",!0);document.getElementById("edit-prompts-checkbox").checked=h;var b=st("removeHighlightOnFinish",!1);document.getElementById("remove-highlight-on-finish-checkbox").checked=b,pt()}function dt(){var e=document.getElementById("highlight-checkbox").checked;localStorage.setItem("highlightErrors",e);var t=document.getElementById("comment-checkbox").checked;localStorage.setItem("addComments",t);var n=document.getElementById("highlight-corrected-checkbox").checked;localStorage.setItem("highlightCorrected",n);var a=document.getElementById("check-grammatical").checked,r=document.getElementById("check-syntactic").checked,o=document.getElementById("check-stylistic").checked,c=document.getElementById("check-logical").checked;localStorage.setItem("checkGrammatical",a),localStorage.setItem("checkSyntactic",r),localStorage.setItem("checkStylistic",o),localStorage.setItem("checkLogical",c);var l=document.getElementById("split-into-chunks-checkbox").checked;localStorage.setItem("splitIntoChunks",l);var s=document.getElementById("chunk-size").value;localStorage.setItem("chunkSize",s);var i=document.getElementById("max-chars").value;localStorage.setItem("maxChars",i);var u=parseFloat(document.getElementById("temperature").value);localStorage.setItem("temperature",u);var d=parseInt(document.getElementById("max-tokens").value,10);localStorage.setItem("maxTokens",d);var m=document.getElementById("response-format-checkbox").checked;localStorage.setItem("responseFormat",m);var p=document.getElementById("retry-on-error-checkbox").checked;localStorage.setItem("retryOnError",p);var g=parseInt(document.getElementById("retry-count").value,10);localStorage.setItem("retryCount",g);var f=document.getElementById("edit-prompts-checkbox").checked;localStorage.setItem("editPrompts",f);var v=document.getElementById("remove-highlight-on-finish-checkbox").checked;localStorage.setItem("removeHighlightOnFinish",v),pt()}function mt(){var e;localStorage.removeItem("highlightErrors"),localStorage.removeItem("addComments"),localStorage.removeItem("highlightCorrected"),localStorage.removeItem("checkGrammatical"),localStorage.removeItem("checkSyntactic"),localStorage.removeItem("checkStylistic"),localStorage.removeItem("checkLogical"),localStorage.removeItem("splitIntoChunks"),localStorage.removeItem("chunkSize"),localStorage.removeItem("maxChars"),localStorage.removeItem("temperature"),localStorage.removeItem("maxTokens"),localStorage.removeItem("responseFormat"),localStorage.removeItem("retryOnError"),localStorage.removeItem("retryCount"),localStorage.removeItem("editPrompts"),localStorage.removeItem("promptRole"),localStorage.removeItem("promptGrammatical"),localStorage.removeItem("promptSyntactic"),localStorage.removeItem("promptStylistic"),localStorage.removeItem("promptLogical"),localStorage.removeItem("promptTextNote"),localStorage.removeItem("grammarModel"),localStorage.removeItem("lastSelectedPreset"),$("#preset-select").val(null).trigger("change"),ut(),gt(),ct(),document.getElementById("preset-json").value="",(e=document.getElementById("reset-message")).innerHTML='<div class="alert alert-info">'.concat("Настройки сброшены к значениям по умолчанию.","</div>"),setTimeout((function(){e.innerHTML=""}),3e3)}function pt(){var e=document.getElementById("edit-prompts-checkbox").checked;document.getElementById("prompts-accordion").style.display=e?"block":"none"}function gt(){var e="Ты - опытный редактор и лингвист.",t="- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.",n="- Ищи синтаксические ошибки, связанные с неправильным построением предложений.",a="- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.",r="- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте.",o=localStorage.getItem("promptRole")||e,c=localStorage.getItem("promptGrammatical")||t,l=localStorage.getItem("promptSyntactic")||n,s=localStorage.getItem("promptStylistic")||a,i=localStorage.getItem("promptLogical")||r,u=localStorage.getItem("promptTextNote")||"";document.getElementById("prompt-role").value=o,document.getElementById("prompt-grammatical").value=c,document.getElementById("prompt-syntactic").value=l,document.getElementById("prompt-stylistic").value=s,document.getElementById("prompt-logical").value=i,document.getElementById("prompt-text-note").value=u}function ft(){var e=document.getElementById("prompt-role").value,t=document.getElementById("prompt-grammatical").value,n=document.getElementById("prompt-syntactic").value,a=document.getElementById("prompt-stylistic").value,r=document.getElementById("prompt-logical").value,o=document.getElementById("prompt-text-note").value;localStorage.setItem("promptRole",e),localStorage.setItem("promptGrammatical",t),localStorage.setItem("promptSyntactic",n),localStorage.setItem("promptStylistic",a),localStorage.setItem("promptLogical",r),localStorage.setItem("promptTextNote",o),vt("Промпты сохранены и будут применены при следующей проверке.")}function vt(e){var t=document.getElementById("prompt-message");t.innerHTML='<div class="alert alert-info">'.concat(e,"</div>"),setTimeout((function(){t.innerHTML=""}),3e3)}function ht(){return{highlightErrors:document.getElementById("highlight-checkbox").checked,addComments:document.getElementById("comment-checkbox").checked,highlightCorrected:document.getElementById("highlight-corrected-checkbox").checked,checkGrammatical:document.getElementById("check-grammatical").checked,checkSyntactic:document.getElementById("check-syntactic").checked,checkStylistic:document.getElementById("check-stylistic").checked,checkLogical:document.getElementById("check-logical").checked,splitIntoChunks:document.getElementById("split-into-chunks-checkbox").checked,chunkSize:document.getElementById("chunk-size").value,maxChars:document.getElementById("max-chars").value,temperature:document.getElementById("temperature").value,maxTokens:document.getElementById("max-tokens").value,responseFormat:document.getElementById("response-format-checkbox").checked,retryOnError:document.getElementById("retry-on-error-checkbox").checked,retryCount:document.getElementById("retry-count").value,editPrompts:document.getElementById("edit-prompts-checkbox").checked,removeHighlightOnFinish:document.getElementById("remove-highlight-on-finish-checkbox").checked,grammarModel:$("#grammar-model").val()}}function bt(){return{promptRole:document.getElementById("prompt-role").value,promptGrammatical:document.getElementById("prompt-grammatical").value,promptSyntactic:document.getElementById("prompt-syntactic").value,promptStylistic:document.getElementById("prompt-stylistic").value,promptLogical:document.getElementById("prompt-logical").value,promptTextNote:document.getElementById("prompt-text-note").value}}function yt(){var e=document.getElementById("preset-name"),t=e.value.trim();if(t)if("current"!==t.toLowerCase()&&"Текущие настройки"!==t){var n={name:t,settings:ht(),prompts:bt()},a=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),r=a.findIndex((function(e){return e.name===t}));-1!==r?xt('Пресет с названием "'.concat(t,'" уже существует. Перезаписать его?'),(function(){a[r]=n,localStorage.setItem("grammarPresets",JSON.stringify(a)),lt(),$("#preset-select").val(n.name).trigger("change"),localStorage.setItem("lastSelectedPreset",n.name),Bt("Пресет сохранен.","success"),e.value="",Et()})):(a.push(n),localStorage.setItem("grammarPresets",JSON.stringify(a)),lt(),$("#preset-select").val(n.name).trigger("change"),localStorage.setItem("lastSelectedPreset",n.name),Bt("Пресет сохранен.","success"),e.value="",Et())}else Bt('Название пресета не может быть "Текущие настройки".',"danger");else Bt("Название пресета не может быть пустым.","danger")}function xt(e,t){var n=document.getElementById("preset-confirmation"),a=document.getElementById("preset-confirmation-message"),r=document.getElementById("preset-confirm-yes"),o=document.getElementById("preset-confirm-no");a.textContent=e,n.style.display="block",r.onclick=null,o.onclick=null,r.onclick=function(){n.style.display="none",t()},o.onclick=function(){n.style.display="none"}}function _t(e,t){var n=Object.keys(e).sort(),a=Object.keys(t).sort();if(n.length!==a.length)return!1;for(var o=0;o<n.length;o++){var c=n[o];if(c!==a[o])return!1;var l=e[c],s=t[c];if("object"===r(l)&&"object"===r(s)){if(!_t(l,s))return!1}else if(l!==s)return!1}return!0}function kt(){window.isLoadingPreset=!0;var e=$("#preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t){var n=t.settings;document.getElementById("highlight-checkbox").checked=n.highlightErrors,document.getElementById("comment-checkbox").checked=n.addComments,document.getElementById("highlight-corrected-checkbox").checked=n.highlightCorrected,document.getElementById("check-grammatical").checked=n.checkGrammatical,document.getElementById("check-syntactic").checked=n.checkSyntactic,document.getElementById("check-stylistic").checked=n.checkStylistic,document.getElementById("check-logical").checked=n.checkLogical,document.getElementById("split-into-chunks-checkbox").checked=n.splitIntoChunks,document.getElementById("chunk-size").value=n.chunkSize,document.getElementById("max-chars").value=n.maxChars,document.getElementById("temperature").value=n.temperature,document.getElementById("max-tokens").value=n.maxTokens,document.getElementById("response-format-checkbox").checked=n.responseFormat,document.getElementById("retry-on-error-checkbox").checked=n.retryOnError,document.getElementById("retry-count").value=n.retryCount,document.getElementById("edit-prompts-checkbox").checked=n.editPrompts,document.getElementById("remove-highlight-on-finish-checkbox").checked=n.removeHighlightOnFinish,pt();var a=t.prompts;document.getElementById("prompt-role").value=a.promptRole,document.getElementById("prompt-grammatical").value=a.promptGrammatical,document.getElementById("prompt-syntactic").value=a.promptSyntactic,document.getElementById("prompt-stylistic").value=a.promptStylistic,document.getElementById("prompt-logical").value=a.promptLogical,document.getElementById("prompt-text-note").value=a.promptTextNote,n.grammarModel&&($("#grammar-model").val(n.grammarModel).trigger("change"),ct()),localStorage.setItem("lastSelectedPreset",e),dt(),ft(),Bt("Пресет загружен.","success"),Et(),window.isLoadingPreset=!1}else window.isLoadingPreset=!1}else window.isLoadingPreset=!1}function It(){var e=$("#preset-select").val();e&&"current"!==e?xt('Вы уверены, что хотите удалить пресет "'.concat(e,'"?'),(function(){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]");t=t.filter((function(t){return t.name!==e})),localStorage.setItem("grammarPresets",JSON.stringify(t)),$("#preset-select").val("current").trigger("change"),localStorage.removeItem("lastSelectedPreset"),lt(),Bt("Пресет удален.","success"),document.getElementById("preset-json").value=""})):Bt("Нет выбранного пресета для удаления.","danger")}function Et(){var e=$("#preset-select").val();if(e&&"current"!==e){var t=JSON.parse(localStorage.getItem("grammarPresets")||"[]").find((function(t){return t.name===e}));if(t){var n=JSON.stringify(t,null,2);document.getElementById("preset-json").value=n}else document.getElementById("preset-json").value=""}else document.getElementById("preset-json").value=""}function St(){document.getElementById("preset-json").select(),document.execCommand("copy"),Bt("JSON пресета скопирован в буфер обмена.","success")}function Bt(e,t){var n=document.getElementById("preset-message");n.innerHTML='<div class="alert alert-'.concat(t,'">').concat(e,"</div>"),setTimeout((function(){n.innerHTML=""}),5e3)}function wt(){return Tt.apply(this,arguments)}function Tt(){return Tt=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(){return(r=d(i().mark((function e(a){var r,c,l,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(a,"*"),(c=n.search(r,{matchWildcards:!0})).load("items"),e.next=5,t.sync();case 5:l=o(c.items);try{for(l.s();!(s=l.n()).done;)s.value.insertText("",Word.InsertLocation.replace)}catch(e){l.e(e)}finally{l.f()}return e.next=9,t.sync();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)},a=function(e){return r.apply(this,arguments)},n=t.document.body,e.next=5,a("START_TIMESTAMP");case 5:return e.next=7,a("END_TIMESTAMP");case 7:console.log("Все маркеры timestamp и связанные с ними цифры успешно удалены."),document.getElementById("message").innerHTML='<div class="alert alert-success">Все маркеры удалены</div>',setTimeout((function(){document.getElementById("message").innerHTML=""}),3e3);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Ошибка при удалении маркеров:",e.t0),document.getElementById("message").innerHTML='<div class="alert alert-danger">Ошибка: '.concat(e.t0.message,"</div>");case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),Tt.apply(this,arguments)}function Ct(){return Pt.apply(this,arguments)}function Pt(){return(Pt=d(i().mark((function e(){var t,n,a,r,o,c,l,s,u,d,m,p,g,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wt();case 3:return e.next=5,Gt();case 5:if(t=e.sent,n=document.getElementById("split-into-chunks-checkbox").checked,a=parseInt(document.getElementById("chunk-size").value,10)||5,document.getElementById("grammar-results").innerHTML="",Lt(),window.appliedCorrections=[],tn(),Kt(!0,n),document.getElementById("filter-container").style.display="none",window.abortController=new AbortController,r=parseInt(document.getElementById("max-chars").value,10)||100,!(t.text.length>0)){e.next=60;break}if(!(!n&&r>0&&t.text.length>r)){e.next=23;break}return document.getElementById("grammar-results").innerHTML='<p class="text-warning">Выделенный текст слишком длинный ('.concat(t.text.length," символов). Пожалуйста, выделите меньше ").concat(r," символов или измените ограничение в настройках.</p>"),Kt(!1),document.getElementById("select-current-text").style.display="inline-block",document.getElementById("finish-current-fragment").style.display="inline-block",e.abrupt("return");case 23:if(o=$("#grammar-model").val(),c=[],!n){e.next=46;break}l=Nt(t.text,a),s=l.length,u=document.getElementById("progress-bar"),(d=document.getElementById("progress-text")).innerText="Обработано 0 из ".concat(s," чанков"),m=0;case 32:if(!(m<l.length)){e.next=44;break}return e.next=35,$t(l[m],o,window.abortController.signal);case 35:p=e.sent,c=c.concat(p),g=Math.round((m+1)/s*100),u.style.width="".concat(g,"%"),u.innerText="".concat(g,"%"),d.innerText="Обработано ".concat(m+1," из ").concat(s," чанков");case 41:m++,e.next=32;break;case 44:e.next=50;break;case 46:return e.next=48,$t(t.text,o,window.abortController.signal);case 48:f=e.sent,c=c.concat(f);case 50:return window.grammarResults=c,Ft(c),e.next=54,Rt(c,t);case 54:c.length>0&&(document.getElementById("filter-container").style.display="block"),isGrammarCheckCompleted=!0,document.getElementById("select-current-text").style.display="inline-block",document.getElementById("finish-current-fragment").style.display="inline-block",e.next=63;break;case 60:console.log("Текст не выделен"),document.getElementById("grammar-results").innerHTML='<p class="text-warning">Пожалуйста, выделите текст для проверки.</p>',Kt(!1);case 63:e.next=68;break;case 65:e.prev=65,e.t0=e.catch(0),"AbortError"===e.t0.name?(console.log("Проверка отменена пользователем."),document.getElementById("grammar-results").innerHTML='<p class="text-info">Проверка отменена.</p>'):(console.error("Error in checkGrammarGrammar:",e.t0),document.getElementById("grammar-results").innerHTML='<p class="text-danger">Произошла ошибка при проверке. Пожалуйста, попробуйте еще раз.</p>');case 68:return e.prev=68,Kt(!1),window.abortController=null,e.finish(68);case 72:case"end":return e.stop()}}),e,null,[[0,65,68,72]])})))).apply(this,arguments)}function Mt(){return Ot.apply(this,arguments)}function Ot(){return(Ot=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.abortController){e.next=8;break}return window.abortController.abort(),Kt(!1),window.abortController=null,e.next=6,Lt();case 6:return e.next=8,wt();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lt(){var e=document.getElementById("progress-bar"),t=document.getElementById("progress-text");e&&(e.style.width="0%",e.innerText="0%"),t&&(t.innerText="Обработано 0 из 0 чанков")}function Nt(e,t){for(var n=e.match(/[^.!?]+[.!?]+(\s|$)|[^.!?]+$/g)||[e],a=[],r=0;r<n.length;r+=t){var o=n.slice(r,r+t).join(" ").trim();a.push(o)}return a}function $t(e,t,n){return At.apply(this,arguments)}function At(){return(At=d(i().mark((function e(t,n,a){var r,o,c,l,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=document.getElementById("retry-on-error-checkbox").checked,o=parseInt(document.getElementById("retry-count").value,10)||1,c=0,l=null;case 4:if(!(c<o)){e.next=23;break}return e.prev=5,e.next=8,jt(t,n,a);case 8:return s=e.sent,e.abrupt("return",s);case 12:if(e.prev=12,e.t0=e.catch(5),l=e.t0,c++,r&&!(c>=o)){e.next=20;break}throw e.t0;case 20:console.warn("Попытка ".concat(c," не удалась. Повторяем..."));case 21:e.next=4;break;case 23:throw l;case 24:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function jt(e,t,n){return Jt.apply(this,arguments)}function Jt(){return(Jt=d(i().mark((function e(t,n,a){var r,o,c,l,s,u,d,m,p,g,f,v,h,b,y,x,_;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=localStorage.getItem("apiKey"),o=[],c={},l={},s={role:"Ты - опытный редактор и лингвист.","грамматическая":"- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.","синтаксическая":"- Ищи синтаксические ошибки, связанные с неправильным построением предложений.","стилистическая":"- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.","логическая":"- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте."},document.getElementById("check-grammatical").checked&&(o.push("грамматические"),c["грамматическая"]=!0,l["грамматическая"]=document.getElementById("prompt-grammatical").value||s["грамматическая"]),document.getElementById("check-syntactic").checked&&(o.push("синтаксические"),c["синтаксическая"]=!0,l["синтаксическая"]=document.getElementById("prompt-syntactic").value||s["синтаксическая"]),document.getElementById("check-stylistic").checked&&(o.push("стилистические"),c["стилистическая"]=!0,l["стилистическая"]=document.getElementById("prompt-stylistic").value||s["стилистическая"]),document.getElementById("check-logical").checked&&(o.push("логические"),c["логическая"]=!0,l["логическая"]=document.getElementById("prompt-logical").value||s["логическая"]),0!==o.length){e.next=11;break}throw new Error("Не выбраны типы проверок");case 11:return u=o.join(", "),d=document.getElementById("prompt-text-note").value||"",m=document.getElementById("prompt-role").value||s.role,p=parseFloat(document.getElementById("temperature").value)||.1,g=parseInt(document.getElementById("max-tokens").value,10)||8e3,f=document.getElementById("response-format-checkbox").checked,v="".concat(m," Твоя задача - проанализировать предоставленный текст и найти только следующие типы ошибок: ").concat(u,".\n\n").concat(d?"Дополнительная информация о тексте: ".concat(d,"\n"):"","\n\n").concat(Object.keys(l).map((function(e){return'Инструкция для "'.concat(e,'" ошибок:\n').concat(l[e],"\n")})).join("\n"),'\n\nТвои инструкции:\n\n- Анализируй текст на уровне предложений и отдельных слов.\n\n- Ищи только указанные типы ошибок.\n\n- Игнорируй другие типы ошибок.\n\n- Если исправление можно внести напрямую в текст и оно не добавляет новой информации, установи "can_edit": true и предоставь поле "text_to_change" с исправленным текстом.\n\n- Если исправление невозможно внести напрямую в текст или добавляет новую информацию, установи "can_edit": false, предоставь поле "suggestion" с рекомендациями по улучшению и добавь поле "example" с примером улучшенного текста.\n\n- Возвращай результат в формате JSON-массива, где каждый элемент содержит:\n  1. "text": проблемный фрагмент текста (слово, фраза или предложение).\n  2. "comment": объяснение проблемы.\n  3. "errorType": тип ошибки (').concat(Object.keys(c).map((function(e){return'"'.concat(e,'"')})).join(", "),').\n  4. "can_edit": true или false (указывает, можно ли внести исправление напрямую в текст).\n  5. Если "can_edit" равно true, добавь поле "text_to_change" с исправленным текстом.\n  6. Если "can_edit" равно false, добавь поле "suggestion" с рекомендациями по улучшению и поле "example" с примером улучшенного текста.\n\nПример ответа:\n\n').concat((i=Object.keys(c),k=void 0,k=[],i.includes("грамматическая")&&(k.push('{\n    "text": "Она сказал",\n    "comment": "Неправильное согласование рода в глаголе.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала"\n}'),k.push('{\n    "text": "Я иду в школу завтра.",\n    "comment": "Неправильное использование времени глагола.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "Я пойду в школу завтра."\n}'),k.push('{\n    "text": "У него есть две собаки и три кошка.",\n    "comment": "Неправильное согласование числительного и существительного.",\n    "errorType": "грамматическая",\n    "can_edit": true,\n    "text_to_change": "У него есть две собаки и три кошки."\n}'),k.push('{\n    "text": "Бегу по дороге быстро.",\n    "comment": "Отсутствует подлежащее в предложении.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Добавить подлежащее для ясности.",\n    "example": "Я бегу по дороге быстро."\n}'),k.push('{\n    "text": "Придя домой, было тихо.",\n    "comment": "Неправильное употребление деепричастного оборота без подлежащего.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Переписать предложение, указав, кто пришел домой.",\n    "example": "Когда я пришёл домой, было тихо."\n}'),k.push('{\n    "text": "Книга, которую я читаю интересная.",\n    "comment": "Отсутствует запятая перед придаточным предложением.",\n    "errorType": "грамматическая",\n    "can_edit": false,\n    "suggestion": "Добавить запятую для правильной пунктуации.",\n    "example": "Книга, которую я читаю, интересная."\n}')),i.includes("синтаксическая")&&(k.push('{\n    "text": "Я люблю читать книги смотреть фильмы.",\n    "comment": "Отсутствует союз между однородными членами предложения.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "Я люблю читать книги и смотреть фильмы."\n}'),k.push('{\n    "text": "Она сказала что придет позже.",\n    "comment": "Отсутствует запятая перед придаточным предложением.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала, что придет позже."\n}'),k.push('{\n    "text": "После дождя дорога была скользкая она упала.",\n    "comment": "Отсутствует разделение на предложения или союз.",\n    "errorType": "синтаксическая",\n    "can_edit": true,\n    "text_to_change": "После дождя дорога была скользкая, и она упала."\n}'),k.push('{\n    "text": "Мы приносим свои искренние извинения всем,кого могли забыть упомянуть здесь.",\n    "comment": "Синтаксическая ошибка: отсутствует пробел после запятой.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Добавить пробел после запятой.",\n    "example": "Мы приносим свои искренние извинения всем, кого могли забыть упомянуть здесь."\n}'),k.push('{\n    "text": "Из-за того что шел дождь.",\n    "comment": "Неполное предложение: отсутствует главная часть.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Добавить главную часть предложения для завершенности.",\n    "example": "Из-за того что шел дождь, мы остались дома."\n}'),k.push('{\n    "text": "Планируя поездку, была куплена карта.",\n    "comment": "Неясно, кто планировал поездку; неправильно построен деепричастный оборот.",\n    "errorType": "синтаксическая",\n    "can_edit": false,\n    "suggestion": "Переписать предложение для ясности.",\n    "example": "Планируя поездку, мы купили карту."\n}')),i.includes("стилистическая")&&(k.push('{\n    "text": "Он встал рано утром, чтобы пойти на работку.",\n    "comment": "Нежелательное использование уменьшительно-ласкательного суффикса.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "Он встал рано утром, чтобы пойти на работу."\n}'),k.push('{\n    "text": "Она сказала ему, что это офигенно.",\n    "comment": "Нежелательное использование разговорного выражения.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "Она сказала ему, что это великолепно."\n}'),k.push('{\n    "text": "В результате он потерпел фиаско.",\n    "comment": "Стилистическая неточность: использование заимствованного слова, которое может быть заменено более подходящим.",\n    "errorType": "стилистическая",\n    "can_edit": true,\n    "text_to_change": "В результате он потерпел неудачу."\n}'),k.push('{\n    "text": "Нам повезло, что мы получили отличную поддержку.",\n    "comment": "Стилистическая неточность: слово \'повезло\' может преуменьшать усилия тех, кто оказал поддержку.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Заменить выражение на более признательное.",\n    "example": "Мы благодарны за отличную поддержку, которую получили."\n}'),k.push('{\n    "text": "Доклад был ничего так, слушатели остались довольны.",\n    "comment": "Неофициальный стиль изложения в формальном контексте.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Исправить выражение на более формальное.",\n    "example": "Доклад был информативным, и слушатели остались довольны."\n}'),k.push('{\n    "text": "Он сделал это быстрее всех, потому что он крутой.",\n    "comment": "Использование жаргонного слова в официальном тексте.",\n    "errorType": "стилистическая",\n    "can_edit": false,\n    "suggestion": "Заменить жаргонное слово на более подходящее.",\n    "example": "Он сделал это быстрее всех благодаря своим навыкам."\n}')),i.includes("логическая")&&(k.push('{\n    "text": "Она родилась в 2000 году и в 1990 году окончила университет.",\n    "comment": "Логическая ошибка: невозможно окончить университет до рождения.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Она родилась в 1970 году и в 1990 году окончила университет."\n}'),k.push('{\n    "text": "Он съел обед перед завтраком.",\n    "comment": "Логическая несостыковка во времени приема пищи.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Он съел завтрак перед обедом."\n}'),k.push('{\n    "text": "Вода замерзает при 100 градусах Цельсия.",\n    "comment": "Неправильная температура замерзания воды.",\n    "errorType": "логическая",\n    "can_edit": true,\n    "text_to_change": "Вода замерзает при 0 градусах Цельсия."\n}'),k.push('{\n    "text": "Этот квадрат имеет три стороны.",\n    "comment": "Логическое противоречие: квадрат не может иметь три стороны.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Уточнить форму или количество сторон фигуры.",\n    "example": "Этот треугольник имеет три стороны."\n}'),k.push('{\n    "text": "Он продал больше книг, чем любой другой автор, включая себя.",\n    "comment": "Логическая ошибка: некорректное сравнение с самим собой.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Пересмотреть формулировку сравнения.",\n    "example": "Он продал больше книг, чем любой другой автор."\n}'),k.push('{\n    "text": "Она всегда говорит правду, но ей нельзя доверять.",\n    "comment": "Логическое противоречие в характеристике.",\n    "errorType": "логическая",\n    "can_edit": false,\n    "suggestion": "Уточнить описание для устранения противоречия.",\n    "example": "Она часто обманывает, поэтому ей нельзя доверять."\n}')),"[\n  ".concat(k.join(",\n  "),"\n]")),'\n\nВажно:\n\n- Возвращай *только* JSON-массив без дополнительных пояснений или предисловий.\n\n- Если ошибок нет, верни пустой массив: [];\n\n- Убедись, что все строки в JSON корректно экранированы. В частности, любые двойные кавычки внутри значений строк должны быть экранированы обратным слешем (\\"").\n'),h='Пожалуйста, проанализируй следующий текст:\n\n"'.concat(t,'";\n'),e.prev=19,b={model:n,messages:[{role:"system",content:v},{role:"user",content:h}],temperature:p,max_tokens:g},f&&(b.response_format={type:"json_object"}),e.next=24,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json","HTTP-Referer":"https://www.office.com","X-Title":"Word Grammar Checker"},body:JSON.stringify(b),signal:a});case 24:if((y=e.sent).ok){e.next=27;break}throw new Error("HTTP error! status: ".concat(y.status));case 27:return e.next=29,y.json();case 29:return x=e.sent,console.log("Ответ от сервера:",x.choices[0].message.content.trim()),_=Ht(x.choices[0].message.content.trim()),e.abrupt("return",_);case 35:if(e.prev=35,e.t0=e.catch(19),"AbortError"!==e.t0.name){e.next=42;break}throw console.log("Запрос был отменен."),e.t0;case 42:throw console.error("Error in analyzeTextGrammar:",e.t0),e.t0;case 44:case"end":return e.stop()}var i,k}),e,null,[[19,35]])})))).apply(this,arguments)}function Ht(e){return zt.apply(this,arguments)}function zt(){return(zt=d(i().mark((function e(t){var n,a,r,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",JSON.parse(t));case 4:return e.prev=4,e.t0=e.catch(0),console.warn("Первая попытка парсинга не удалась:",e.t0),n=localStorage.getItem("apiKey"),a='\nИсправь этот JSON и верни только исправленную версию. Следуй этим правилам:\n1. Все строковые значения должны быть в двойных кавычках.\n2. Все ключи объектов должны быть в двойных кавычках.\n3. Внутри строковых значений двойные кавычки должны быть экранированы обратным слешем.\n4. Не должно быть лишних запятых в конце массивов или объектов.\n5. Верни только исправленный JSON, без дополнительных комментариев.\n\nПример входных данных:\n[\n  {\n    text: \'Пример текста с "кавычками"\',\n    errorType: \'синтаксическая\',\n    can_edit: true,\n  },\n]\n\nПример ожидаемого вывода:\n[\n  {\n    "text": "Пример текста с \\"кавычками\\"",\n    "errorType": "синтаксическая",\n    "can_edit": true\n  }\n]\n\nИсправь следующий JSON:\n'.concat(t,"\n"),e.next=11,fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:"Bearer ".concat(n),"Content-Type":"application/json"},body:JSON.stringify({model:"openai/gpt-4o-mini",messages:[{role:"user",content:a}],max_tokens:16e3,temperature:.2})});case 11:return r=e.sent,e.next=14,r.json();case 14:return o=e.sent,c=o.choices[0].message.content.trim(),e.prev=16,e.abrupt("return",JSON.parse(c));case 20:throw e.prev=20,e.t1=e.catch(16),console.error("Не удалось распарсить JSON даже после исправления GPT:",e.t1),e.t1;case 24:case"end":return e.stop()}}),e,null,[[0,4],[16,20]])})))).apply(this,arguments)}function Ft(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=document.getElementById("grammar-results");if(n.innerHTML="",0!==e.length){0===t&&(t=window.pageYOffset);var a=document.getElementById("filter-select").value,r={};if(e.forEach((function(e,t){var n=e.errorType||"Другие";r[n]||(r[n]=[]),e.index=t,("can_edit"!==a||e.can_edit)&&("cannot_edit"===a&&e.can_edit||r[n].push(e))})),Object.keys(r).forEach((function(e){0===r[e].length&&delete r[e]})),0!==Object.keys(r).length){var c="grammarAccordion",l='<div class="accordion" id="'.concat(c,'">');Object.keys(r).forEach((function(e,t){var n=r[e],a="collapse".concat(t);l+='\n            <div class="card">\n                <div class="card-header" id="heading'.concat(t,'">\n                    <h2 class="mb-0">\n                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#').concat(a,'" aria-expanded="true" aria-controls="').concat(a,'">\n                            ').concat(e.charAt(0).toUpperCase()+e.slice(1),' ошибки (<span class="error-count">').concat(n.length,'</span>)\n                        </button>\n                    </h2>\n                </div>\n                <div id="').concat(a,'" class="collapse show" aria-labelledby="heading').concat(t,'" data-parent="#').concat(c,'">\n                    <div class="card-body">\n                        ').concat(n.map((function(t,a){return'\n                            <div class="mb-3 p-3 border error-card '.concat(a<n.length-1?"border-bottom":"",'" data-error-index="').concat(t.index,'" data-error-type="').concat(e,'">\n                                <p><strong>Проблемный текст:</strong> <span class="text-danger">').concat(t.text,"</span></p>\n                                <p><strong>Комментарий:</strong> ").concat(t.comment,"</p>\n                                ").concat(t.can_edit?'<p><strong>Исправление:</strong> <span class="text-success">'.concat(t.text_to_change,'</span></p>\n                                <div class="btn-group" role="group">\n                                    <button class="btn btn-sm btn-primary apply-suggestion" data-error-index="').concat(t.index,'">Применить исправление</button>\n                                    <button class="btn btn-sm btn-secondary mark-as-resolved" data-error-index="').concat(t.index,'">Отметить как решенную</button>\n                                </div>'):"<p><strong>Рекомендации:</strong> ".concat(t.originalComment||t.suggestion,'</p>\n                                <p><strong>Пример улучшенного текста:</strong> <span class="text-info">').concat(t.example||"","</span></p>\n                                ").concat(t.originalComment?'<p class="text-warning"><em>Исправление невозможно, т.к. исходный текст был изменен другим исправлением.</em></p>':"<p><em>Исправление невозможно применить напрямую.</em></p>",'\n                                <button class="btn btn-sm btn-secondary mark-as-resolved" data-error-index="').concat(t.index,'">Отметить как решенную</button>'),"\n                            </div>\n                        ")})).join(""),"\n                    </div>\n                </div>\n            </div>\n        ")})),l+="</div>",n.innerHTML=l;var s,i=o(document.getElementsByClassName("apply-suggestion"));try{for(i.s();!(s=i.n()).done;)s.value.addEventListener("click",(function(){Zt(parseInt(this.dataset.errorIndex,10),e,this)}))}catch(e){i.e(e)}finally{i.f()}var u,d=o(document.getElementsByClassName("mark-as-resolved"));try{for(d.s();!(u=d.n()).done;)u.value.addEventListener("click",(function(){ot(parseInt(this.dataset.errorIndex,10),e)}))}catch(e){d.e(e)}finally{d.f()}var m=document.querySelector(".error-card:last-child");m&&m.scrollIntoView({behavior:"smooth",block:"center"})}else n.innerHTML='<p class="text-info">Нет ошибок для отображения по выбранному фильтру.</p>'}else n.innerHTML='<p class="text-success">Ошибок не найдено. Текст выглядит хорошо!</p>'}function Rt(e,t){return Wt.apply(this,arguments)}function Wt(){return Wt=d(i().mark((function e(t,n){var a,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=document.getElementById("highlight-checkbox").checked,r=document.getElementById("comment-checkbox").checked,a||r){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Word.run(function(){var e=d(i().mark((function e(c){var l,s,u,d,m,p,g,f,v,h,b,y,x;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye(c,n.timestamp);case 2:if(l=e.sent){e.next=6;break}return console.error("Не удалось найти выделенный текст"),e.abrupt("return");case 6:s=o(t),e.prev=7,s.s();case 9:if((u=s.n()).done){e.next=44;break}d=u.value,e.prev=11,m=qt(d.text,250),p=o(m),e.prev=14,p.s();case 16:if((g=p.n()).done){e.next=25;break}return f=g.value,(v=l.search(f,{matchCase:!0,matchWholeWord:!1})).load("items"),e.next=22,c.sync();case 22:if(v.items.length>0){h=o(v.items);try{for(h.s();!(b=h.n()).done;)y=b.value,a&&(y.font.highlightColor="yellow"),r&&f===m[0]&&(x="Тип ошибки: ".concat(d.errorType,"\nКомментарий: ").concat(d.comment),d.can_edit?x+="\nИсправление: ".concat(d.text_to_change):x+="\nРекомендации: ".concat(d.suggestion,"\nПример улучшенного текста: ").concat(d.example),y.insertComment(x))}catch(e){h.e(e)}finally{h.f()}}case 23:e.next=16;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(14),p.e(e.t0);case 30:return e.prev=30,p.f(),e.finish(30);case 33:return e.next=35,c.sync();case 35:e.next=40;break;case 37:e.prev=37,e.t1=e.catch(11),console.log("Error processing result: ".concat(d.text),e.t1);case 40:return e.next=42,new Promise((function(e){return setTimeout(e,100)}));case 42:e.next=9;break;case 44:e.next=49;break;case 46:e.prev=46,e.t2=e.catch(7),s.e(e.t2);case 49:return e.prev=49,s.f(),e.finish(49);case 52:case"end":return e.stop()}}),e,null,[[7,46,49,52],[11,37],[14,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Error in highlightTextGrammar:",e)}));case 6:case"end":return e.stop()}}),e)}))),Wt.apply(this,arguments)}function Gt(){return Dt.apply(this,arguments)}function Dt(){return Dt=d(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Word.run(function(){var e=d(i().mark((function e(t){var n,a,r,o,c,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.document.getSelection()).load("text"),e.next=4,t.sync();case 4:if(0!==(a=n.text.trim()).length){e.next=7;break}throw new Error("Нет выделенного текста");case 7:return r="START_TIMESTAMP",o="END_TIMESTAMP",n.insertText(r,Word.InsertLocation.before),n.insertText(o,Word.InsertLocation.after),c=t.document.body.search(r,{matchCase:!0}).getFirst(),l=t.document.body.search(o,{matchCase:!0}).getFirst(),c.font.size=1,l.font.size=1,c.font.color="white",l.font.color="white",e.next=19,t.sync();case 19:return e.abrupt("return",{text:a});case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:return e.abrupt("return",e.sent);case 6:throw e.prev=6,e.t0=e.catch(0),console.error("Ошибка при создании маркеров выделения:",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),Dt.apply(this,arguments)}function qt(e,t){var n,a=[],r="",c=o(e.split(" "));try{for(c.s();!(n=c.n()).done;){var l=n.value;(r+" "+l).length>t&&r.length>0&&(a.push(r.trim()),r=""),r+=(r?" ":"")+l}}catch(e){c.e(e)}finally{c.f()}return r.length>0&&a.push(r.trim()),a}function Kt(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=document.getElementById("loading"),a=document.getElementById("check-grammar"),r=document.getElementById("progress-container"),o=document.getElementById("spinner");e?(n.style.display="block",a.disabled=!0,t?(r.style.display="block",o.style.display="none"):(r.style.display="none",o.style.display="block")):(n.style.display="none",a.disabled=!1,r.style.display="none",o.style.display="none")}function Ut(){var e=document.getElementById("fuuga_logger-prompt-minimal").value,t=document.getElementById("fuuga_logger-prompt-medium").value,n=document.getElementById("fuuga_logger-prompt-maximal").value,a=document.getElementById("fuuga_custom-logger-prompt").value;localStorage.setItem("loggerPromptMinimal",e),localStorage.setItem("loggerPromptMedium",t),localStorage.setItem("loggerPromptMaximal",n),localStorage.setItem("loggerPromptCustom",a),Vt("Промпты логера сохранены.")}function Vt(e){var t=document.getElementById("fuuga_logger-prompt-message");t.innerHTML='<div class="alert alert-info">'.concat(e,"</div>"),setTimeout((function(){t.innerHTML=""}),3e3)}function Xt(){var e=document.getElementById("preset-json-import").value;if(e)try{var t=JSON.parse(e);if(!t.name||!t.settings||!t.prompts)return void Bt("Некорректный формат пресета.","danger");if("current"===t.name.toLowerCase()||"Текущие настройки"===t.name)return void Bt('Название пресета не может быть "Текущие настройки".',"danger");t.settings=n(n({},{highlightErrors:!0,addComments:!1,highlightCorrected:!0,checkGrammatical:!1,checkSyntactic:!1,checkStylistic:!0,checkLogical:!0,splitIntoChunks:!1,chunkSize:8,maxChars:2e3,temperature:.1,maxTokens:4e3,responseFormat:!1,retryOnError:!0,retryCount:3,editPrompts:!0,grammarModel:"anthropic/claude-3.5-sonnet:beta",removeHighlightOnFinish:!1}),t.settings),t.prompts=n(n({},{role:"Ты - опытный редактор и лингвист.","грамматическая":"- Ищи грамматические ошибки, связанные с неправильным употреблением частей речи, склонений и спряжений.","синтаксическая":"- Ищи синтаксические ошибки, связанные с неправильным построением предложений.","стилистическая":"- Ищи стилистические ошибки, связанные с использованием некорректных или неуместных выражений.","логическая":"- Ищи логические ошибки, связанные с противоречиями и несоответствиями в тексте."}),t.prompts);var a=JSON.parse(localStorage.getItem("grammarPresets")||"[]"),r=a.findIndex((function(e){return e.name===t.name}));-1!==r?xt('Пресет с названием "'.concat(t.name,'" уже существует. Перезаписать его?'),(function(){a[r]=t,localStorage.setItem("grammarPresets",JSON.stringify(a)),lt(),$("#preset-select").val(t.name).trigger("change"),localStorage.setItem("lastSelectedPreset",t.name),Bt("Пресет импортирован.","success"),Et()})):(a.push(t),localStorage.setItem("grammarPresets",JSON.stringify(a)),lt(),$("#preset-select").val(t.name).trigger("change"),localStorage.setItem("lastSelectedPreset",t.name),Bt("Пресет импортирован.","success"),Et())}catch(e){console.error("Ошибка при импорте пресета:",e),Bt("Ошибка при импорте пресета. Проверьте формат JSON.","danger")}else Bt("Поле JSON пустое.","danger")}function Zt(e,t,n){return Yt.apply(this,arguments)}function Yt(){return Yt=d(i().mark((function e(t,n,a){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n[t]){e.next=3;break}return e.abrupt("return");case 3:if(r.can_edit){e.next=6;break}return an(a,"Это исправление не может быть применено напрямую."),e.abrupt("return");case 6:return e.next=8,Word.run(function(){var e=d(i().mark((function e(c){var l,s,u,d,m;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=c.document.body,(s=l.search(r.text,{matchCase:!0,matchWholeWord:!1})).load("items"),e.next=5,c.sync();case 5:if(!(s.items.length>0)){e.next=19;break}u=o(s.items);try{for(u.s();!(d=u.n()).done;)(m=d.value).insertText(r.text_to_change,Word.InsertLocation.replace),document.getElementById("highlight-corrected-checkbox").checked&&(m.font.highlightColor="lightgreen")}catch(e){u.e(e)}finally{u.f()}return e.next=10,c.sync();case 10:return rt(r),n.splice(t,1),Ft(n),tn(),e.next=16,Qt(n);case 16:nn(),e.next=20;break;case 19:an(a,"Не удалось найти текст для замены. Убедитесь, что текст не был изменен.");case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Error:",e),an(a,"Произошла ошибка при применении исправления. Пожалуйста, попробуйте еще раз.")}));case 8:case"end":return e.stop()}}),e)}))),Yt.apply(this,arguments)}function Qt(e){return en.apply(this,arguments)}function en(){return en=d(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Word.run(function(){var e=d(i().mark((function e(n){var a,r,c,l,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=n.document.body).load("text"),e.next=4,n.sync();case 4:a.text,r=o(t),e.prev=6,r.s();case 8:if((c=r.n()).done){e.next=18;break}if(!(l=c.value).can_edit){e.next=16;break}return(s=a.search(l.text,{matchCase:!0,matchWholeWord:!1})).load("items"),e.next=15,n.sync();case 15:0===s.items.length&&(l.can_edit=!1,l.originalComment||(l.originalComment=l.comment,l.originalSuggestion=l.suggestion,l.originalExample=l.example),l.comment="Исправление невозможно, так как исходный текст был изменен другим исправлением.");case 16:e.next=8;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(6),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:Ft(t);case 27:case"end":return e.stop()}}),e,null,[[6,20,23,26]])})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),en.apply(this,arguments)}function tn(){var e=document.getElementById("grammar-history");if(e.innerHTML="",0!==appliedCorrections.length){var t=appliedCorrections.reduce((function(e,t){var n=t.errorType||"Другие";return e[n]||(e[n]=[]),e[n].push(t),e}),{}),n='<div class="accordion" id="historyAccordion">';Object.keys(t).forEach((function(e,a){var r=t[e],o="historyCollapse".concat(a);n+='\n            <div class="card">\n                <div class="card-header" id="historyHeading'.concat(a,'">\n                    <h2 class="mb-0">\n                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#').concat(o,'" aria-expanded="true" aria-controls="').concat(o,'">\n                            ').concat(e.charAt(0).toUpperCase()+e.slice(1),' исправления (<span class="correction-count">').concat(r.length,'</span>)\n                        </button>\n                    </h2>\n                </div>\n                <div id="').concat(o,'" class="collapse show" aria-labelledby="historyHeading').concat(a,'" data-parent="#historyAccordion">\n                    <div class="card-body">\n                        ').concat(r.map((function(e,t){return'\n                            <div class="mb-3 p-3 border correction-card '.concat(t<r.length-1?"border-bottom":"",'">\n                                <p><strong>Проблемный текст:</strong> <span class="text-danger">').concat(e.text,"</span></p>\n                                <p><strong>Комментарий:</strong> ").concat(e.comment,"</p>\n                                ").concat(e.can_edit?'<p><strong>Исправление:</strong> <span class="text-success">'.concat(e.text_to_change,"</span></p>"):"<p><strong>Рекомендации:</strong> ".concat(e.suggestion,'</p>\n                                     <p><strong>Пример улучшенного текста:</strong> <span class="text-info">').concat(e.example,"</span></p>"),"\n                                ").concat(e.resolvedManually?'<p class="text-info"><em>Отмечено как решенное вручную</em></p>':'<p class="text-success"><em>Применено автоматически</em></p>',"\n                            </div>\n                        ")})).join(""),"\n                    </div>\n                </div>\n            </div>\n        ")})),n+="</div>",e.innerHTML=n;var a=document.querySelector(".correction-card:last-child");a&&a.scrollIntoView({behavior:"smooth",block:"center"})}else e.innerHTML='<p class="text-info">История исправлений пуста.</p>'}function nn(){var e=document.getElementById("grammarAccordion");e&&e.children.length||(document.getElementById("grammar-results").innerHTML='<p class="text-success">Все ошибки исправлены!</p>',document.getElementById("filter-container").style.display="none")}function an(e,t){if(e){var n=e.parentElement.querySelector(".error-message");n&&n.remove();var a=document.createElement("div");a.className="error-message text-danger mt-2",a.textContent=t,e.parentElement.insertBefore(a,e.nextSibling)}}window.abortController=null,window.isLoadingPreset=!1,Office.onReady((function(e){e.host===Office.HostType.Word&&(S(),he(),Ke(),Ve())})),document.addEventListener("DOMContentLoaded",(function(){S(),he(),Ke(),Ve()}))}(),function(){"use strict";var e=n(14385),t=n.n(e),a=new URL(n(54058),n.b);t()(a)}()}();
//# sourceMappingURL=taskpane.js.map